(this["webpackJsonpcra-admin-starter"]=this["webpackJsonpcra-admin-starter"]||[]).push([[10],{1107:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1108);Object.defineProperty(e,"Map",{enumerable:!0,get:function(){return L(n).default}});var i=r(637);Object.defineProperty(e,"Marker",{enumerable:!0,get:function(){return L(i).default}});var o=r(638);Object.defineProperty(e,"MarkerOrderTip",{enumerable:!0,get:function(){return L(o).default}});var a=r(1121);Object.defineProperty(e,"InfoWindow",{enumerable:!0,get:function(){return L(a).default}});var s=r(1122);Object.defineProperty(e,"NavigationControl",{enumerable:!0,get:function(){return L(s).default}});var u=r(1123);Object.defineProperty(e,"OverviewMapControl",{enumerable:!0,get:function(){return L(u).default}});var l=r(1124);Object.defineProperty(e,"ScaleControl",{enumerable:!0,get:function(){return L(l).default}});var h=r(1125);Object.defineProperty(e,"MapTypeControl",{enumerable:!0,get:function(){return L(h).default}});var c=r(1126);Object.defineProperty(e,"PanoramaControl",{enumerable:!0,get:function(){return L(c).default}});var f=r(1127);Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return L(f).default}});var p=r(1128);Object.defineProperty(e,"Polyline",{enumerable:!0,get:function(){return L(p).default}});var d=r(1129);Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return L(d).default}});var v=r(1130);Object.defineProperty(e,"Road",{enumerable:!0,get:function(){return L(v).default}});var g=r(1133);Object.defineProperty(e,"Boundary",{enumerable:!0,get:function(){return L(g).default}});var m=r(1134);Object.defineProperty(e,"MarkerList",{enumerable:!0,get:function(){return L(m).default}});var y=r(1136);Object.defineProperty(e,"MapvMarkerList",{enumerable:!0,get:function(){return L(y).default}});var b=r(1137);Object.defineProperty(e,"TrafficLayer",{enumerable:!0,get:function(){return L(b).default}});var x=r(1138);Object.defineProperty(e,"Merge",{enumerable:!0,get:function(){return L(x).default}});var _=r(1139);Object.defineProperty(e,"MapvLayer",{enumerable:!0,get:function(){return L(_).default}});var w=r(1140);Object.defineProperty(e,"MapvglLayer",{enumerable:!0,get:function(){return L(w).default}});var M=r(1141);Object.defineProperty(e,"MapvglView",{enumerable:!0,get:function(){return L(M).default}});var E=r(1142);Object.defineProperty(e,"DrivingRoute",{enumerable:!0,get:function(){return L(E).default}});var T=r(1143);Object.defineProperty(e,"PointLabel",{enumerable:!0,get:function(){return L(T).default}});var P=r(1146);Object.defineProperty(e,"Arc",{enumerable:!0,get:function(){return L(P).default}});var A=r(1147);Object.defineProperty(e,"ThickRay",{enumerable:!0,get:function(){return L(A).default}});var S=r(1148);function L(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"MapListener",{enumerable:!0,get:function(){return L(S).default}})},1108:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=s(r(0)),o=s(r(311)),a=r(1109);function s(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidMount",value:function(){this.initMap(),this.forceUpdate()}},{key:"componentDidUpdate",value:function(t){var e=t.center,r=this.props.center;if((0,a.isString)(r))e!=r&&this.map.centerAndZoom(r);else{var n=e&&r&&(e.lng!=r.lng||e.lat!=r.lat||this.props.forceUpdate),i=t.zoom!==this.props.zoom&&(this.props.zoom||this.props.forceUpdate);r=new BMap.Point(r.lng,r.lat);n&&i?this.map.centerAndZoom(r,this.props.zoom):n?this.map.setCenter(r):i&&this.map.zoomTo(this.props.zoom)}}},{key:"initMap",value:function(){var t=this,e=this.options;e=this.getOptions(e),!0!==this.props.enableMapClick&&(e.enableMapClick=!1);var r=new BMap.Map(this.refs.map,e);this.map=r;var n=this.props.zoom;if(this.bindEvent(r,this.events),(0,a.isString)(this.props.center))r.centerAndZoom(this.props.center);else{var i=new BMap.Point(this.props.center.lng,this.props.center.lat);r.centerAndZoom(i,n)}this.props.mapStyleV2?r.setMapStyleV2(this.props.mapStyleV2):this.props.mapStyle&&r.setMapStyle(this.props.mapStyle),this.bindToggleMeghods(r,this.toggleMethods);var o=n;r.addEventListener("zoomend",(function(){var e=r.getZoom();t.props.zoom_changed&&t.props.zoom_changed(e,o),o=e}))}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map)return i.default.Children.map(e,(function(e){if(e)return"string"===typeof e.type?e:i.default.cloneElement(e,{map:t.map})}))}},{key:"onRender",value:function(){if(this.props.render&&this.map)return this.props.render(this.map)}},{key:"render",value:function(){var t={height:"100%",position:"relative"};for(var e in this.props.style)t[e]=this.props.style[e];return i.default.createElement("div",{style:t,key:this.props.keys},i.default.createElement("div",{ref:"map",className:this.props.className,style:{height:"100%"}},"\u52a0\u8f7d\u5730\u56fe\u4e2d..."),this.renderChildren(),this.onRender())}},{key:"events",get:function(){return["click","dblclick","rightclick","rightdblclick","maptypechange","mousemove","mouseover","mouseout","movestart","moving","moveend","zoomstart","zoomend","addoverlay","addcontrol","removecontrol","removeoverlay","clearoverlays","dragstart","dragging","dragend","addtilelayer","removetilelayer","load","resize","hotspotclick","hotspotover","hotspotout","tilesloaded","touchstart","touchmove","touchend","longpress"]}},{key:"toggleMethods",get:function(){return{enableScrollWheelZoom:["enableScrollWheelZoom","disableScrollWheelZoom"],enableDragging:["enableDragging","disableDragging"],enableDoubleClickZoom:["enableDoubleClickZoom","disableDoubleClickZoom"],enableKeyboard:["enableKeyboard","disableKeyboard"],enableInertialDragging:["enableInertialDragging","disableInertialDragging"],enableContinuousZoom:["enableContinuousZoom","disableContinuousZoom"],enablePinchToZoom:["enablePinchToZoom","disablePinchToZoom"],enableAutoResize:["enableAutoResize","disableAutoResize"]}}},{key:"options",get:function(){return["minZoom","maxZoom","mapType","enableMapClick"]}}],[{key:"defaultProps",get:function(){return{style:{height:"350px"}}}}]),e}(o.default);e.default=u},1109:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)}},1110:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1111);Object.defineProperty(e,"obj",{enumerable:!0,get:function(){return a(n).default}});var i=r(1115);Object.defineProperty(e,"bmap",{enumerable:!0,get:function(){return a(i).default}});var o=r(1117);function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"http",{enumerable:!0,get:function(){return a(o).default}})},1111:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(r(1112)),i=a(r(1113)),o=a(r(1114));function a(t){return t&&t.__esModule?t:{default:t}}var s={deepClone:n.default,merge:i.default,diff:o.default};e.default=s},1112:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t){return("object"===("undefined"===typeof t?"undefined":n(t))||"function"===typeof t)&&null!==t}e.default=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap,n=void 0,o=e.constructor;switch(o){case RegExp:n=new o(e);break;case Date:n=new o(e.getTime());break;default:if(r.has(e))return r.get(e);n=new o,r.set(e,n)}for(var a in e)n[a]=i(e[a])?t(e[a],r):e[a];return n}},1113:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(t,e){var r=function t(e,r){for(var i in r)"[object Object]"==Object.prototype.toString.call(r[i])?("object"!==n(e[i])&&(e[i]={}),t(e[i],r[i])):e[i]=r[i]},i=JSON.parse(JSON.stringify(t));return r(i,e),i}},1114:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){var r={};return function t(e,r,n){var i={};for(var o in e&&Object.keys(e).map((function(t){i[t]=!0})),r&&Object.keys(r).map((function(t){i[t]=!0})),i)if(e[o]&&"[object Object]"==Object.prototype.toString.call(e[o])&&r[o]&&"[object Object]"==Object.prototype.toString.call(r[o]))if(JSON.stringify(e[o])!==JSON.stringify(r[o])){n[o]||(n[o]={});var a=n[o];t(e[o],r[o],a)}else n[o]=r[o];else n[o]=r[o]}(t,e,r),0==Object.keys(r).length&&(r=null),r}},1115:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(r(639)),i=o(r(1116));function o(t){return t&&t.__esModule?t:{default:t}}var a={createPoint:n.default,getPoints:i.default};e.default=a},1116:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(639),o=(n=i)&&n.__esModule?n:{default:n};e.default=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[],n=t.split("|");return n.forEach((function(t){for(var n=t?t.split(","):[],i=[],a=0;a<n.length-1;){var s={lng:parseFloat(n[a]),lat:parseFloat(n[a+1])};if(e)i.push(s);else{var u=(0,o.default)(s);i.push(u)}a+=2}r.push(i)})),1==r.length&&(r=r[0]),r}},1117:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(r(1118)),i=o(r(1119));function o(t){return t&&t.__esModule?t:{default:t}}n.default.download=i.default,e.default=n.default},1118:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={fetch:function(t){var e=null;if(/^http(s{0,1}):\/\//.test(t.url)){var r=location.href.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/),n=t.url.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/);e=2===r.length&&2===n.length&&n[1]===r[1]?this.ajax(t):this.jsonp(t)}else e=this.ajax(t);return e},ajax:function(t){var e=this,r=new XMLHttpRequest,n=t.method||"GET",i=!1;if(r.open(n,t.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!0,"GET"===n)r.send();else{r.withCredentials=!0,r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var o=Object.keys(t.data).map((function(e){return e+"="+t.data[e]}));r.send(o.join("&"))}var a=setTimeout((function(){r.abort(),t.fail&&t.fail("timeout")}),1e4);return r.onload=function(){this.status>=200&&this.status<300?t.success&&t.success(JSON.parse(this.response)):t.fail&&t.fail(this.statusText),t.complete&&t.complete(JSON.parse(this.response)),clearTimeout(a)},r.onerror=function(){t.fail&&t.fail(e.statusText),clearTimeout(a)},{abort:function(){i||(i=!0,r.abort())},params:t}},jsonp:function(t){var e="jsonp_"+ +new Date+"_"+parseInt(1e7*Math.random(),10),r=document.createElement("script"),n=!1;t.url+="-1"===t.url.indexOf("?")?"?":"&",t.url+="callback="+e,r.src=t.url,document.head.appendChild(r);var i=setTimeout((function(){null!==window[e]&&(window[e]=null,r.parentElement.removeChild(r),t.fail&&t.fail({error:null,msg:"timeout"}),t.complete&&t.complete(JSON.parse()))}),1e4);return r.addEventListener("error",(function(o){window[e]=null,r.parentElement.removeChild(r),clearTimeout(i),n||(t.fail&&t.fail({error:o,msg:"loaderror"}),t.complete&&t.complete())})),window[e]=function(o){clearTimeout(i),n||(t.success(o),t.complete&&t.complete()),window[e]=null,r.parentElement.removeChild(r)},{abort:function(){clearTimeout(i),n=!0},params:t}}};e.default=n},1119:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var r=document.createElement("a");r.style.display="none";var n=new Blob([t]);r.href=URL.createObjectURL(n),r.href=t,e&&(r.download=e),document.body.appendChild(r),r.click(),document.body.removeChild(r)}},1120:function(t,e,r){"use strict";function n(t,e,r){this.options=r||{},this._point=t,this.content=e}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.setAttribute("tag","customoverlay"),e.style.position="absolute";var r=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat);e.style.zIndex=r,e.addEventListener("touchstart",(function(t){t.stopPropagation(),console.log("touchstart")})),e.addEventListener("touchend",(function(t){t.stopPropagation(),console.log("touchend")})),"[object String]"==Object.prototype.toString.call(this.content)?e.innerHTML=this.content:e.appendChild(this.content);var n=this.options.pane||"labelPane";return t.getPanes()[n].appendChild(e),e},n.prototype.draw=function(){var t=this._map.pointToOverlayPixel(this._point),e=this.options.offset||new BMap.Size(0,0);this._div.style.left=t.x+e.width+"px",this._div.style.top=t.y+e.height+"px"},e.default=n},1121:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(3),a=r(311);var s=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.closeInfoWindow(),this.infoWindow=null}},{key:"initialize",value:function(){var t=this.props.map;if(t&&(this.destroy(),this.infoWindow=new BMap.InfoWindow(this.props.text||"",this.getOptions(this.options)),this.bindEvent(this.infoWindow,this.events),t.openInfoWindow(this.infoWindow,new BMap.Point(this.props.position.lng,this.props.position.lat)),"children"in this.props)){var e=document.createElement("div");(0,o.render)(this.props.children,e),this.infoWindow.setContent(e)}}},{key:"options",get:function(){return["width","height","maxWidth","offset","title","enableAutoPan","enableCloseOnClick","enableMessage","message"]}},{key:"events",get:function(){return["close","open","maximize","restore","clickclose"]}}]),e}(((n=a)&&n.__esModule?n:{default:n}).default);e.default=s},1122:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(400);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getControl",value:function(){return new BMap.NavigationControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","showZoomInfo","enableGeolocation"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1123:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(400);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getControl",value:function(){return new BMap.OverviewMapControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","size","isOpen"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1124:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(400);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getControl",value:function(){return new BMap.ScaleControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1125:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(400);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getControl",value:function(){return new BMap.MapTypeControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","mapTypes"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1126:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(400);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getControl",value:function(){return new BMap.PanoramaControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1127:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(520);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getOverlay",value:function(){var t=this.props.center,e=this.props.radius;return new BMap.Circle(t,e,this.getOptions(this.options))}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1128:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(520);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map((function(t){return new BMap.Point(t.lng,t.lat)})),new BMap.Polyline(t,this.getOptions(this.options))}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1129:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(520);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map((function(t){return new BMap.Point(t.lng,t.lat)})),new BMap.Polygon(t,this.getOptions(this.options))}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1130:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=u(r(311)),o=r(356),a=u(r(1131)),s=u(r(1132));function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"getRoadPoints",value:function(t){for(var e=this.props.map.getMapType().getProjection(),r=[],n=0;n<t.length;n++)for(var i=t[n].split(","),o=0;o<i.length;o+=2)"bd09mc"===this.props.coordType?r.push(e.pointToLngLat(new BMap.Pixel(i[o],i[o+1]))):r.push(new BMap.Point(i[o],i[o+1]));return r}},{key:"updateViewport",value:function(){var t=this,e=(this.props.roadPath,[]);this.props.roadPaths?this.props.roadPaths.forEach((function(r){e=e.concat(t.getRoadPoints(r))})):this.props.roadPath&&(e=e.concat(this.getRoadPoints(this.props.roadPath))),e.length>0&&!1!==this.props.autoViewport&&this.props.map.setViewport(e,this.props.viewportOptions)}},{key:"getRoadGroup",value:function(t,e,r){t=t,r=r;var n={},i=[];if(e=e)for(var o=0;o<e.length;o++)n[e[o]]||(n[e[o]]={roadPath:[],color:r[e[o]]}),i.push(t[o]),n[e[o]].roadPath.push(t[o]);else n[0]={roadPath:t,color:this.props.color||"#1495ff"};return{group:n,allPath:s.default.mergeRoadPath(t)}}},{key:"isClick",value:function(t,e,r){var n=this.canvasLayer.canvas.getContext("2d"),i=this.getRoadGroup(r);n.beginPath();var o=this.props.lineWidth||10;return a.default.drawRoads(t,n,i.allPath,{color:this.props.bgColor||"#fff",lineWidth:o+4,lineCap:"butt",arrow:!1,line:!1}),n.lineWidth=o+6,n.isPointInStroke(e.x*window.devicePixelRatio,e.y*window.devicePixelRatio)}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){var r=this.canvasLayerUpdate.bind(this);this.canvasLayer?this.canvasLayer.draw():(this.canvasLayer=new o.baiduMapCanvasLayer({zIndex:this.props.zIndex,map:e,update:function(){r(this)}}),this.props.onClick&&e.addEventListener("click",(function(r){if(t.props.roadPaths)for(var n=0;n<t.props.roadPaths.length;n++){var i=t.props.roadPaths[n];t.isClick(e,r.pixel,i)&&t.props.onClick(n)}else t.props.roadPath&&t.isClick(e,r.pixel,t.props.roadPath)&&t.props.onClick()}))),this.updateViewport()}}},{key:"canvasLayerUpdate",value:function(t){var e=this,r=t.canvas.getContext("2d");if(!r)return!1;r.clearRect(0,0,r.canvas.width,r.canvas.height);var n=this.props.roadPath,i=this.props.roadPaths,o=this.props.lineWidth||10;i?i.forEach((function(t,n){e.props.lineWidths&&(o=e.props.lineWidths[n]),e.drawRoad(r,t,e.props.category,e.props.splitList,o)})):n&&this.drawRoad(r,this.props.roadPath,this.props.category,this.props.splitList,o)}},{key:"drawRoad",value:function(t,e,r,n,i){var o=this.getRoadGroup(e,r,n),u=o.group;for(var l in a.default.drawRoads(this.props.map,t,o.allPath,{color:this.props.bgColor||"#fff",coordType:this.props.coordType,lineWidth:i+4,lineCap:"butt",arrow:!1,line:!0}),u){var h=u[l];e=s.default.mergeRoadPath(h.roadPath);a.default.drawRoads(this.props.map,t,e,{color:h.color,coordType:this.props.coordType,line:!0,lineWidth:i,lineCap:"butt",arrow:!1})}a.default.drawRoads(this.props.map,t,o.allPath,{color:h.color,coordType:this.props.coordType,lineWidth:i,border:{},lineCap:"butt",arrow:!1!==this.props.isShowArrow&&{width:5,height:3,color:this.props.arrowColor}})}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.canvasLayer.hide()}}]),e}(i.default);e.default=l},1131:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={0:"#fff",1:"#00dc35",2:"#f3e032",3:"#ff6c6c",4:"#900000"},i={drawRoads:function(t,e,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=t.getZoom(),s=o.lineWidth||5,u=void 0===o.level?1:o.level,l=null,h=0,c=0,f=[],p=[],d=[],v=0,g=0;e.beginPath();var m=Math.pow(2,18-t.getZoom()),y=t.getMapType().getProjection(),b=y.lngLatToPoint(t.getCenter()),x=new BMap.Pixel(b.x-t.getSize().width/2*m,b.y+t.getSize().height/2*m);return r.forEach((function(r,n){var a=null;l=null;for(var s=r.split(","),u=0;u<s.length;u+=2){var y=new BMap.Point(s[u],s[u+1]);p.push(y),i="bd09mc"===o.coordType?{x:(y.lng-x.x)/m,y:(x.y-y.lat)/m}:t.pointToPixel(y);var b=void 0;if(l){var _=i.x-l.x,w=i.y-l.y;h=Math.sqrt(_*_+w*w),c+=h,o.arrow&&(b={start:l,end:i,offset:50-((v+=h)-h),depth:h,totalDepth:g+=h},f.push(b),v>=50&&(d.push(b),v%=50))}l=i,0===u?(a=a||i,e.moveTo(i.x,i.y)):(c>15||u>=s.length-2)&&(c=0,e.lineTo(i.x,i.y))}if(o.arrow&&n===r.length-1&&g<100){var M=f[Math.ceil(f.length/2)];for(var E in f)if(f[E].totalDepth>=g/2){M=f[E+1]?f[E+1]:f[E];break}var T=f[f.length-1];M.end=T.end,(d=[]).push(M)}})),o.line&&(e.lineCap=o.lineCap||"round",e.lineJoin="round",o.border&&(e.strokeStyle=o.border.color||"white",e.lineWidth=(a<=13?s-2:s)+(2*o.border.lineWidth||4),e.stroke()),e.strokeStyle=o.color||n[u]||"#fc2c2b",e.lineWidth=a<=13?s-2:s,e.stroke()),o.arrow&&this.drawArrow(e,d,o),p},drawArrow:function(t,e,r){t.beginPath(),e.forEach((function(n){var i=n.start.x,o=n.start.y,a=n.end.x-i,s=n.end.y-o,u=[0,-1],l=[n.end.x-n.start.x,n.end.y-n.start.y],h=u[0]*l[0]+u[1]*l[1],c=Math.sqrt(u[0]*u[0]+u[1]*u[1]),f=Math.sqrt(l[0]*l[0]+l[1]*l[1]),p=Math.acos(h/(c*f));l[0]<0&&(p=2*Math.PI-p);for(var d=r.arrow.width/2||2,v=r.arrow.height||d,g=0;n.offset+50*g<=n.depth;){var m=(n.offset+50*g)/n.depth;t.save(),t.translate(i+a*m,o+s*m),t.rotate(p),t.moveTo(1.618*-d,v),t.lineTo(0,0),t.lineTo(1.618*d,v),t.restore(),g+=1}1===e.length&&n.offset>n.depth&&(t.save(),t.translate(i,o),t.rotate(p),t.moveTo(1.618*-d,v),t.lineTo(0,0),t.lineTo(1.618*d,v),t.restore())})),t.strokeStyle=r.arrow.color||"#fff",t.lineWidth=3,t.stroke()}};e.default=i},1132:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={mergeRoadPath:function(t,e){for(var r=[],n=0;n<t.length;n++)if(0==r.length)r.push(t[n]);else{var i=t[n].split(","),o=r[r.length-1].split(",");if(i[0]===o[o.length-2]&&i[1]===o[o.length-1]){var a=i.slice(2);r[r.length-1]+=","+a.join(",")}else r.push(t[n])}return r},uniqueRoadPath:function(t){for(var e=0;e<t.length-1;e++)if(t[e])for(var r=t[e].split(","),n=e+1;n<t.length;n++)if(t[n]){for(var i=t[n].split(","),o=!0,a=0;a<i.length;a+=2){0==this.isPointOnPolyline({lng:i[a],lat:i[a+1]},r)&&(o=!1)}o&&delete t[n]}return t},isPointOnPolyline:function(t,e){for(var r=e,n=0;n<r.length-2;n++){var i={lng:r[n],lat:r[n+1]},o={lng:r[n+2],lat:r[n+3]};if(t.lng>=Math.min(i.lng,o.lng)&&t.lng<=Math.max(i.lng,o.lng)&&t.lat>=Math.min(i.lat,o.lat)&&t.lat<=Math.max(i.lat,o.lat)){var a=(i.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(i.lat-t.lat);if(2e-9,a<2e-9&&a>-2e-9)return!0}}return!1}};e.default=n},1133:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311),a=(n=o)&&n.__esModule?n:{default:n},s=r(356);var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this._allRequest={},this._backData={},this.initialize()}},{key:"componentWillUnmount",value:function(){this.mapvLayer&&(this.mapvLayer.destroy(),this.mapvLayer=null)}},{key:"getPointArrayByDataSetData",value:function(t){for(var e=[],r=0;r<t.length;r++){t[r].geometry.coordinates[0].forEach((function(t){e.push(new BMap.Point(t[0],t[1]))}))}return e}},{key:"getBoundaryData",value:function(){var t=this.props.data,e=this.props.map;if(t){this._request={};var r=this,n=new BMap.Boundary,i=[];t.forEach((function(t,e){r._request[t.name]=!1,r._backData[t.name]&&(i=i.concat(r._backData[t.name]),r._request[t.name]=!0)})),o(),t.forEach((function(t,e){r._request[t.name]||r._allRequest[t.name]||(r._allRequest[t.name]=!0,n.get(t.name,(function(e){for(var n=[],a=0;a<e.boundaries.length;a++){for(var s=[],u=e.boundaries[a].split(";"),l=0;l<u.length;l++)s.push(u[l].split(","));n.push({geometry:{type:"Polygon",coordinates:[s]},count:t.count})}r._backData[t.name]=n,i=i.concat(n),r._request[t.name]=!0,o()})))}))}function o(){var t=!0;for(var n in r._request)r._request[n]||(t=!1);if(t){r.dataSet.set(i);var o=r.getPointArrayByDataSetData(i);o.length>0&&!1!==r.props.autoViewport&&e.setViewport(o,r.props.viewportOptions)}}}},{key:"initialize",value:function(){var t=this.props.map;if(t){if(!this.mapvLayer){this.dataSet=new s.DataSet([]);var e=this.props.layerOptions||{gradient:{0:"yellow",1:"red"},max:100,globalAlpha:.8,draw:"intensity"};this.mapvLayer=new s.baiduMapLayer(t,this.dataSet,e)}this.getBoundaryData()}}}]),e}(a.default);e.default=u},1134:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=s(r(311)),o=r(356),a=s(r(1135));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)==JSON.stringify(this.props.data)&&this.map?this.setViewport():this.initialize()}},{key:"componentDidMount",value:function(){this.markers=[],this.initialize()}},{key:"componentWillUnmount",value:function(){this.clearMarkers(),this.textLayer&&(this.textLayer.destroy(),this.textLayer=null),this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"clearMarkers",value:function(){for(var t=0;t<this.markers.length;t++)this.map.removeOverlay(this.markers[t]),this.markers[t]=null;this.markers.length=0}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this.clearMarkers(),!this.textLayer){this.dataSet=new o.DataSet([]);var r=this.props.textOptions||{fillStyle:"#666666",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 0.1)",globalAlpha:"0.9",textAlign:"left",offset:{x:this.props.mini?10:15,y:0},coordType:this.props.coordType,avoid:!0,size:12,textKey:"text",draw:"text"};!1!==this.props.isShowText&&(this.textLayer=new o.baiduMapLayer(e,this.dataSet,r))}if(!this.animationLayer&&!0===this.props.animation){var n=this.props.splitList||{};n.other=this.props.fillStyle||"rgba(50, 50, 255, 0.5)";var i={styleType:"stroke",strokeStyle:this.props.fillStyle||"rgba(20, 249, 255, 0.5)",coordType:this.props.coordType,splitList:n,globalAlpha:.4,size:this.props.multiple||this.props.mini?20:26,minSize:this.props.multiple||this.props.mini?10:13,draw:"category"};this.animationLayer=new o.baiduMapAnimationLayer(e,this.dataSet,i)}for(var s=e.getMapType().getProjection(),u=this.props.data,l=[],h=0;h<u.length;h++)if((void 0===this.props.showIndex||this.props.showIndex==h)&&u[h].location){var c=u[h].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var f=s.pointToLngLat(new BMap.Pixel(c[0],c[1]));else f=new BMap.Point(c[0],c[1]);var p=u[h].color||this.props.fillStyle||"#1495ff";this.props.splitList&&(p=this.props.splitList[u[h].count]?this.props.splitList[u[h].count]:this.props.splitList.other);r={point:f,fillStyle:p,isShowNumber:this.props.isShowNumber,size:26,zIndex:u.length-h,number:h+1};(this.props.multiple||this.props.mini)&&(r.size=20,r.lineWidth=0,(h>=10||this.props.mini)&&(r.isShowNumber=!1,r.size=10,r.strokeStyle=p,r.lineWidth=3,r.strokeOpacity=.4));var d=new a.default(r);d.addEventListener("click",(function(e,r){t.props.onClick&&t.props.onClick(r-1)})),d.addEventListener("mouseover",(function(e,r){t.props.onMouseOver&&t.props.onMouseOver(r-1)})),d.addEventListener("mouseout",(function(e,r){t.props.onMouseOut&&t.props.onMouseOut(r-1)})),d.index=h,this.markers.push(d),l.push({geometry:{type:"Point",coordinates:[c[0],c[1]]},count:u[h].count,text:u[h].text})}for(var v=this.markers.length;v--;)e.addOverlay(this.markers[v]);this.props.mini?this.dataSet.set(l):this.dataSet.set(l.splice(0,10)),this.setViewport()}}},{key:"setViewport",value:function(){var t=this.props.map;if(t){for(var e=this.props.data,r=t.getMapType().getProjection(),n=[],i=0;i<e.length;i++)if(e[i].location){var o=e[i].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var a=r.pointToLngLat(new BMap.Pixel(o[0],o[1]));else a=new BMap.Point(o[0],o[1]);n.push(a)}n.length>0&&!1!==this.props.autoViewport&&t.setViewport(n,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(i.default);e.default=u},1135:function(t,e,r){"use strict";function n(t){this.options=t||{},this._point=t.point,this._fillColor=t.fillStyle||"#1495ff",this._size=t.size||30,this._lineWidth=void 0===t.lineWidth?2:t.lineWidth,this._strokeStyle=t.strokeStyle||"#ffffff",t.strokeOpacity&&(this._strokeStyle=function(t,e){var r=t.toLowerCase();if(r&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(r)){if(4===r.length){for(var n="#",i=1;i<4;i+=1)n+=r.slice(i,i+1).concat(r.slice(i,i+1));r=n}var o=[];for(i=1;i<7;i+=2)o.push(parseInt("0x"+r.slice(i,i+2)));return e?(o.push(e),"rgba("+o.join(",")+")"):"rgb("+o.join(",")+")"}return r}(this._strokeStyle,.4))}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div"),r=e.style;r.position="absolute",r.backgroundClip="padding-box",r.zIndex=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat),r.backgroundColor=this._fillColor,!1!==this.options.isShowShadow&&(r.boxShadow="0 0 5px rgba(0, 0, 0, 0.5)"),r.border=this._lineWidth+"px solid "+this._strokeStyle,r.color="white",r.textShadow="0px 0px 5px #fff",r.width=this._size+"px",r.boxSizing="content-box",r.borderRadius="30px",r.height=this._size+"px",r.lineHeight=this._size+"px",r.fontSize="12px",r.cursor="pointer",r.textAlign="center",r.MozUserSelect="none",this.options.number&&!1!==this.options.isShowNumber&&(e.innerHTML=this.options.number);var n=this;return e.addEventListener("mouseover",(function(){n.dispatchEvent("mouseover",n.options.number),r.backgroundColor="#1495ff"})),e.addEventListener("mouseout",(function(){n.dispatchEvent("mouseout",n.options.number),r.backgroundColor=n._fillColor})),e.addEventListener("click",(function(){n.dispatchEvent("click",n.options.number)})),e.addEventListener("touchstart",(function(t){t.stopPropagation()})),e.addEventListener("touchmove",(function(t){t.stopPropagation()})),e.addEventListener("touchend",(function(t){t.stopPropagation()})),t.getPanes().markerPane.appendChild(e),e},n.prototype.draw=function(){var t=this._map.pointToOverlayPixel(this._point);this._div.style.left=t.x-(this._size+this._lineWidth)/2-1+"px",this._div.style.top=t.y-(this._size+this._lineWidth)/2-2+"px"},e.default=n},1136:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311),a=(n=o)&&n.__esModule?n:{default:n},s=r(356);var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)==JSON.stringify(this.props.data)&&this.map||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.map=t,this._createLayer||this.createLayers(),this.showDatasets(this.props.data))}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.shadowSet=null,this.circleSet=null,this.textSet=null,this.numSet=null,this.otherSet=null,this.otherShadowSet=null;for(var t=0;t<this.layers.length;t++)this.layers[t].destroy(),this.layers[t]=null}},{key:"showDatasets",value:function(t){var e=this,r=[],n=[],i=[],o=[],a=[],s=[];t.length>0&&(t.forEach((function(t,u){var l=t.location.split(","),h=e.project.pointToLngLat(new BMap.Pixel(l[0],l[1]));s.push(h),u<10?(r.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count)}),n.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t.count),text:parseInt(u)+1}),i.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count),text:t.text})):(o.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t.count)}),a.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t.count)}))})),this.shadowSet.set(r),this.circleSet.set(n),this.textSet.set(i),this.numSet.set(n),this.otherSet.set(o),this.otherShadowSet.set(a),s.length>0&&!1!==this.props.autoViewport&&map.setViewport(s,self.props.viewportOptions))}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.project=t.getMapType().getProjection();var e=this,r=this.shadowSet=new s.DataSet([]),n=this.circleSet=new s.DataSet([]),i=this.textSet=new s.DataSet([]),o=this.numSet=new s.DataSet([]),a=this.otherSet=new s.DataSet([]),u=this.otherShadowSet=new s.DataSet([]);this.layers=[];var l={coordType:"bd09mc",splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",other:"#80db69"},shadowBlur:10,size:5,max:30,methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){a.update((function(t){t.fillStyle=null})),t?(e.isSmallPath=!0,e.props.map.setDefaultCursor("pointer"),a.update((function(t){t.fillStyle="#1495ff"}),{id:t.id})):(e.isSmallPath=!1,e.isSmallPath||e.isBigPath||e.props.map.setDefaultCursor("auto"))}},draw:"category"};if(this.layers.push(new s.baiduMapLayer(t,u,{splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"fill",globalAlpha:.4,coordType:"bd09mc",size:8,minSize:5,draw:"category"})),this.layers.push(new s.baiduMapLayer(t,a,l)),!0===this.props.animation){this.layers.push(new s.baiduMapAnimationLayer(t,r,{splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"stroke",globalAlpha:.4,coordType:"bd09mc",size:20,minSize:10,draw:"category"}))}var h={splitList:{1:"#80db69",4:"#d53938",3:"#fe6261",2:"#ffb02d"},fillStyle:"red",coordType:"bd09mc",size:10,draw:"category",methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){n.update((function(t){t.fillStyle=null})),t?(e.isBigPath=!0,e.map.setDefaultCursor("pointer"),n.update((function(t){t.fillStyle="#1495ff"}),{id:t.id})):(e.isBigPath=!1,e.isBigPath||e.isSmallPath||e.map.setDefaultCursor("auto"))}}};this.layers.push(new s.baiduMapLayer(t,n,h));this.layers.push(new s.baiduMapLayer(t,o,{coordType:"bd09mc",draw:"text",font:"13px Arial",fillStyle:"#ffffff",shadowColor:"#ffffff",shadowBlur:10}));this.layers.push(new s.baiduMapLayer(t,i,{coordType:"bd09mc",font:"13px Arial",fillStyle:"#666",shadowColor:"#ffffff",shadowBlur:10,draw:"text",avoid:!0,textAlign:"left",offset:{x:10,y:0}}))}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(a.default);e.default=u},1137:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311);var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){var t=this.props.map;t&&t.removeTileLayer&&t.removeTileLayer instanceof Function&&this.tileLayer&&(t.removeTileLayer(this.tileLayer),this.tileLayer=null)}},{key:"initialize",value:function(){var t=this.props.map,e=this.props.tilesUrl?this.props.tilesUrl:"http://its.map.baidu.com:8002/traffic/TrafficTileService";if(t){if(!this.tileLayer){this.tileLayer=new BMap.TileLayer({isTransparentPng:!0});var r=Math.round(window.devicePixelRatio||1);r=Math.min(2,r),r=Math.max(1,r),this.tileLayer.getTilesUrl=function(t,n){var i=t.x,o=t.y,a=(new Date).getTime();return e+"?level="+n+"&x="+i+"&y="+o+"&time="+a+"&v=081&scaler="+r}}t.addTileLayer(this.tileLayer)}}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1138:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={mergeRoadPath:function(t,e){if(t){for(var r=[],n=0;n<t.length;n++)if(0==r.length)r.push(t[n]);else{for(var i=t[n].split(","),o=!1,a=0;a<r.length;a++){var s=r[a].split(",");if(i[0]===s[s.length-2]&&i[1]===s[s.length-1]){var u=i.slice(2);r[a]+=","+u.join(","),o=!0}if(i[i.length-2]===s[0]&&i[i.length-1]===s[1]){u=i.slice(0,i.length-2);r[a]=u.join(",")+","+r[a],o=!0}}!1===o&&r.push(t[n])}return r=this.uniqueRoadPath(r)}},uniqueRoadPath:function(t){for(var e=t.map((function(t){return new i(t.split(","))})),r=0;r<e.length-1;r++)if(e[r])for(var n=e[r],o=r+1;o<e.length;o++){if(e[o])e[o].isInclude(n)&&delete e[o]}var a=[];return e.map((function(t){t&&a.push(t.getPoints().join(","))})),a}};function i(t){this.polyline=t;for(var e=t[0],r=t[0],n=t[1],i=t[1],o=2;o<t.length;o+=2)e=Math.min(e,t[o]),r=Math.max(r,t[o]),n=Math.min(n,t[o+1]),i=Math.max(i,t[o+1]);this.minX=e,this.maxX=r,this.minY=n,this.maxY=i}i.prototype.getPoints=function(){return this.polyline},i.prototype.isInBound=function(t){return t.lng>this.minX&&t.lat>this.minY&&t.lng<this.maxX&&t.lat<this.maxY},i.prototype.isInclude=function(t){if(!(t.minX>this.minX&&t.minY>this.minY&&t.maxX<this.maxX&&t.maxY<this.maxY))return!1;for(var e=this.getPoints(),r=!0,n=0;n<e.length;n+=2){0==this.isPointOnPolyline({lng:e[n],lat:e[n+1]},t)&&(r=!1)}return r},i.prototype.isPointOnPolyline=function(t,e){var r=e.getPoints();if(!e.isInBound(t))return!1;for(var n=0;n<r.length-2;n++){var i={lng:r[n],lat:r[n+1]},o={lng:r[n+2],lat:r[n+3]};if(t.lng>=Math.min(i.lng,o.lng)&&t.lng<=Math.max(i.lng,o.lng)&&t.lat>=Math.min(i.lat,o.lat)&&t.lat<=Math.max(i.lat,o.lat)){var a=(i.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(i.lat-t.lat);if(2e-9,a<2e-9&&a>-2e-9)return!0}}return!1},e.default=n},1139:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311),a=(n=o)&&n.__esModule?n:{default:n},s=r(356);var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),r=JSON.stringify(this.props.data),n=JSON.stringify(t.options),i=JSON.stringify(this.props.options);e==r&&this.map&&n==i||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var r=function(e){return"bd09mc"===t.props.options.coordType?n.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},n=e.getMapType().getProjection(),i=[];this.props.data.map((function(t){"Point"===t.geometry.type?i.push(r(t.geometry.coordinates)):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map((function(t){i.push(r(t))}))})),i.length>0&&e.setViewport(i,this.props.options.viewportOptions)}this.dataSet.set(this.props.data),this.layer.update({options:this.props.options})}}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer.destroy(),this.layer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map,e=this.dataSet=new s.DataSet([]);this.layer=new s.baiduMapLayer(t,e,{enableMassClear:!1})}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=u},1140:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311),a=(n=o)&&n.__esModule?n:{default:n},s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(640));var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer&&(this.props.view.removeLayer(this.layer),this.layer.destroy(),this.layer=null)}},{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),r=JSON.stringify(this.props.data),n=JSON.stringify(t.options),i=JSON.stringify(this.props.options);this.map&&e===r&&n===i||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var r=e.getMapType().getProjection(),n=function(e){return"bd09mc"===t.props.options.coordType?r.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},i=[];this.props.data.map((function(t){"Point"===t.geometry.type?i.push(n(t.geometry.coordinates)):"LineString"===t.geometry.type?t.geometry.coordinates.map((function(t){i.push(n(t))})):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map((function(t){i.push(n(t))}))})),i.length>0&&e.setViewport(i,this.props.options.viewportOptions)}this.layer.setData(this.props.data),this.layer.setOptions(this.props.options)}}},{key:"createLayers",value:function(){s[this.props.type]?(this._createLayer=!0,this.layer=new s[this.props.type](this.props.options),this.props.view.addLayer(this.layer)):console.error("mapvgl doesn't have layer "+this.props.type+"!")}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=u},1141:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=s(r(0)),o=s(r(311)),a=r(640);function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}var h=function(t){function e(){return u(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidMount",value:function(){this.initialize(),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.mapvglView&&(this.mapvglView.destroy(),this.mapvglView=null)}},{key:"componentDidUpdate",value:function(t){this.map&&this.mapvglView||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;if(t&&(this.map=t,!this.mapvglView)){var e=[],r=this.props.effects;r&&r.length&&r.forEach((function(t){"bloom"===t?e.push(new a.BloomEffect):"bright"===t?e.push(new a.BrightEffect):"blur"===t&&e.push(new a.BlurEffect)})),this.mapvglView=new a.View({mapType:"bmap",effects:e,map:t})}}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map&&this.mapvglView)return i.default.Children.map(e,(function(e){if(e)return"string"===typeof e.type?e:i.default.cloneElement(e,{map:t.map,view:t.mapvglView})}))}},{key:"render",value:function(){return i.default.createElement("div",{title:"mapvgl view"},this.renderChildren())}}]),e}(o.default);e.default=h},1142:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311);var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.driving&&this.driving.clearResults(),this.driving=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.driving||(this.driving=new BMap.DrivingRoute(t,{renderOptions:{map:t,policy:this.props.policy||BMAP_DRIVING_POLICY_LEAST_TIME,autoViewport:void 0===this.props.autoViewport||this.props.autoViewport,viewportOptions:{zoomFactor:-1}}}));var e=this.props.start,r=this.props.end;e.lng&&e.lat&&(e=new BMap.Point(e.lng,e.lat)),r.lng&&r.lat&&(r=new BMap.Point(r.lng,r.lat)),this.driving.search(e,r)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},1143:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=(a(r(0)),r(3),a(r(311))),o=a(r(1144));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r.tips=[],r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.tips.forEach((function(t){t.hide()})),this.tips=[]}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e&&(this.destroy(),this.props.data)){var r=[];this.props.data.forEach((function(n,i){var a=new o.default({isShowTipArrow:!0,changePosition:function(e){t.props.changePosition&&t.props.changePosition(e,i)},map:e,numberDirection:n.numberDirection,isShowNumber:n.isShowNumber,point:n.point,name:n.name,index:void 0!==n.index?n.index:i+1,color:n.color,change:function(){}});r.push(n.point),a.show(),t.tips.push(a)})),this.props.autoViewport&&e.setViewport(r,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(i.default);e.default=s},1144:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(1145),o=(n=i)&&n.__esModule?n:{default:n};function a(t){this.options=t;var e=t.map,r=t.point;this.point=r;t.name;this.map=e;var n=this.tip=new o.default(t),i=new BMap.Icon("//huiyan.baidu.com/github/tools/gis-drawing/static/images/drag.png",new BMap.Size(25,25),{imageSize:new BMap.Size(25,25)}),a=this.marker=new BMap.Marker(this.point);a.setIcon(i),a.setShadow(i);var s=this;a.addEventListener("dragging",(function(){s.point=a.point,n.setPosition(a.point),t.change&&t.change()})),a.addEventListener("dragend",(function(){t.changePosition&&t.changePosition(s.point)})),a.enableDragging()}a.prototype.show=function(){this.map.addOverlay(this.marker),this.map.addOverlay(this.tip),!1===this.options.isShowTipArrow&&this.tip.hideArrow()},a.prototype.hide=function(){this.map.removeOverlay(this.marker),this.map.removeOverlay(this.tip)},a.prototype.setNumberLeft=function(){this.tip.setNumberLeft()},a.prototype.setNumberRight=function(){this.tip.setNumberRight()},a.prototype.hideNumber=function(){this.tip.hideNumber()},e.default=a},1145:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={"#ee5d5b":"0 0","#ff9625":"0 -10px","#6caeca":"0 -20px"},i={"#ee5d5b":"#BC3B3A","#ff9625":"#c57f1d","#6caeca":"#5188a5"};function o(t){t=t||{},this._point=t.point,this._text=t.name,this._index=t.index,this._numberDirection=t.numberDirection||"left",this._isShowNumber=void 0===t.isShowNumber||t.isShowNumber,this.color=t.color||"#ee5d5b"}o.prototype=new BMap.Overlay,o.prototype.changeColor=function(t){this._div&&(this._div.style.backgroundColor=t,this._div.style.borderColor=i[t],this._arrow.style.backgroundPosition=n[t])},o.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.style.position="absolute",e.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),e.style.backgroundColor=this.color,e.style.border="1px solid "+i[this.color],e.style.color="white",e.style.height="38px",e.style.boxSizing="border-box",e.style.padding="5px",e.style.whiteSpace="nowrap",e.style.MozUserSelect="none",e.style.fontSize="18px",e.style.border="1px solid #a67972",e.style.color="#494947",e.style.background="#fff",e.style.borderRadius="25px",e.style.paddingLeft="30px";var r=this._span=document.createElement("span");e.appendChild(r),r.appendChild(document.createTextNode(this._text));var o=this._arrow=document.createElement("div");o.style.backgroundPosition=n[this.color],o.style.position="absolute",o.style.width="11px",o.style.height="10px",o.style.top="26px",o.style.left="10px",o.style.overflow="hidden",e.appendChild(o);var a=this._number=document.createElement("div");return a.style.background=this.color||"#f15e5c",a.style.color="#fff",a.style.position="absolute",a.style.top="3px",a.style.position="absolute",a.style.textAlign="center",a.style.height="30px",a.style.width="30px",a.style.lineHeight="30px",a.style.borderRadius="30px",!1===this._isShowNumber&&(a.style.display="none"),this.renderDirection(),a.innerHTML=this._index,e.appendChild(a),t.getPanes().labelPane.appendChild(e),e},o.prototype.setNumberLeft=function(){this._numberDirection="left",this.renderDirection()},o.prototype.setNumberRight=function(){this._numberDirection="right",this.renderDirection()},o.prototype.renderDirection=function(){"left"==this._numberDirection?(this._isShowNumber?this._div.style.paddingLeft="38px":this._div.style.paddingLeft="8px",this._div.style.paddingRight="8px",this._number.style.left="5px",this._number.style.right="initial"):(this._div.style.paddingLeft="8px",this._isShowNumber?this._div.style.paddingRight="38px":this._div.style.paddingRight="8px",this._number.style.left="initial",this._number.style.right="5px")},o.prototype.hideNumber=function(){this._isShowNumber=!1,this._number.style.display="none",this.renderDirection()},o.prototype.setPosition=function(t){this._point=t,this.draw()},o.prototype.hideArrow=function(){this._arrow.style.display="none"},o.prototype.draw=function(){var t=this._map;this._span.innerHTML=this._text;var e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x+5+"px",this._div.style.top=e.y-20+"px"},e.default=o},1146:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=(a(r(0)),a(r(311))),o=r(356);function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null,this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new o.DataSet([]),this.lineLayer=new o.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new o.DataSet([]),this.pointLayer=new o.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new o.baiduMapLayer(t,this.pointDataSet,{}),this.props.enableAnimation&&(this.animationLayer=new o.baiduMapAnimationLayer(t,this.lineDataSet,{}))}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var r=[],n=[];if(this.props.data){var i=[],a=e.getMapType().getProjection();this.props.data.forEach((function(s,u){var l=s.from.point||o.utilCityCenter.getCenterByCityName(s.from.city),h=s.to.point||o.utilCityCenter.getCenterByCityName(s.to.city),c=o.utilCurve.getPoints([l,h]);"bd09mc"===t.props.coordType?(i.push(a.pointToLngLat(new BMap.Pixel(l.lng,l.lat))),i.push(a.pointToLngLat(new BMap.Pixel(h.lng,h.lat)))):(i.push(l),i.push(h)),r.push({strokeStyle:s.color,geometry:{type:"LineString",coordinates:c}}),!1!==t.props.showToPoint&&n.push({fillStyle:s.color,text:s.to.name||s.to.city,geometry:{type:"Point",coordinates:[h.lng,h.lat]}}),!1!==t.props.showFromPoint&&n.push({fillStyle:s.color,text:s.from.name||s.from.city,geometry:{type:"Point",coordinates:[l.lng,l.lat]}}),i.length>0&&!1!==t.props.autoViewport&&e.setViewport(i,t.props.viewportOptions)}))}this.lineDataSet.set(r),this.lineLayer.update({options:this.props.lineOptions||{draw:"simple",strokeStyle:"#5E87DB",lineWidth:3}}),this.pointDataSet.set(n),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}}),this.props.enableAnimation?this.animationLayer.update({options:this.props.animationOptions||{coordType:this.props.coordType,fillStyle:"rgba(255, 250, 250, 0.9)",lineWidth:0,size:4,animateTime:50,draw:"simple"}}):this.animationLayer&&this.animationLayer.hide()}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(i.default);e.default=s},1147:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=(a(r(0)),a(r(311))),o=r(356);function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new o.DataSet([]),this.lineLayer=new o.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new o.DataSet([]),this.pointLayer=new o.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new o.baiduMapLayer(t,this.pointDataSet,{})}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var r=[],n=[],i=Boolean("curve"===this.props.type);if(this.props.data){var a=[],s=e.getMapType().getProjection();this.props.data.forEach((function(u,l){var h=u.from.point||o.utilCityCenter.getCenterByCityName(u.from.city),c=u.to.point||o.utilCityCenter.getCenterByCityName(u.to.city),f=o.utilCurve.getPoints([h,c]);"bd09mc"===t.props.coordType?(a.push(s.pointToLngLat(new BMap.Pixel(h.lng,h.lat))),a.push(s.pointToLngLat(new BMap.Pixel(c.lng,c.lat)))):(a.push(h),a.push(c));var p=new o.utilDataRangeIntensity({maxSize:10,minSize:1,min:t.props.min||0,max:t.props.max||1e3}).getSize(u.count);r.push({strokeStyle:u.color,geometry:{type:"LineString",coordinates:i?f:[[h.lng,h.lat],[c.lng,c.lat]]},count:u.count,lineWidth:p}),!1!==t.props.showToPoint&&n.push({fillStyle:u.color,text:u.to.name||u.to.city,geometry:{type:"Point",coordinates:[c.lng,c.lat]}}),!1!==t.props.showFromPoint&&n.push({fillStyle:u.color,text:u.from.name||u.from.city,geometry:{type:"Point",coordinates:[h.lng,h.lat]}}),a.length>0&&!1!==t.props.autoViewport&&e.setViewport(a,t.props.viewportOptions)}))}this.lineDataSet.set(r),this.lineLayer.update({options:this.props.lineOptions||{coordType:this.props.coordType,draw:"simple",strokeStyle:"#5E87DB",globalCompositeOperation:"lighter",shadowColor:"rgba(255, 255, 255, 0.5)",shadowBlur:60,lineWidth:2}}),this.pointDataSet.set(n),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5,shadowColor:"#5E87DB",shadowBlur:20}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}})}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(i.default);e.default=s},1148:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(0);function a(t,e){var r=null;return function(){var n=this,i=arguments;r&&clearTimeout(r),r=setTimeout((function(){t.apply(n,i)}),e)}}function s(t,e){var r=void 0,n=arguments,i=void 0;return function o(){var a=this,s=Date.now();i||(i=s),r&&clearTimeout(r),s-i>=e?(t.apply(a,n),i=s):r=setTimeout((function(){o.apply(a,n)}),50)}}var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.map=r.props.map,r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidMount",value:function(){this.props.onZoomend&&this._bindZoomendEvent(),this.props.onDragend&&this._bindDragendEvent()}},{key:"componentWillUnmount",value:function(){var t=this.map;this.props.onZoomend&&t.removeEventListener("zoomend",this.onZoomend),this.props.onDragend&&t.removeEventListener("dragend",this.onDragend)}},{key:"_bindZoomendEvent",value:function(){var t=this.map,e=this.props,r=e.onZoomend,n=e.eventType,i=e.delay;this.onZoomend="debounce"===n?a(r,i):"throttle"===n?s(r,i):r,t.addEventListener("zoomend",this.onZoomend)}},{key:"_bindDragendEvent",value:function(){var t=this.map,e=this.props,r=e.onDragend,n=e.eventType,i=e.delay;this.onDragend="debounce"===n?a(r,i):"throttle"===n?s(r,i):r,t.addEventListener("dragend",this.onDragend)}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{eventType:"debounce",delay:500}}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default.Component);e.default=u},311:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var i=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"bindEvent",value:function(t,e){var r=this;e&&e.forEach((function(e){t.addEventListener(e,(function(){r.props.events&&r.props.events[e]&&r.props.events[e].apply(r,arguments)}))}))}},{key:"bindToggleMeghods",value:function(t,e){for(var r in e)void 0!==this.props[r]&&(this.props[r]?t[e[r][0]]():t[e[r][1]]())}},{key:"getOptions",value:function(t){var e=this,r={};return t.map((function(t){void 0!==e.props[t]&&(r[t]=e.props[t])})),r}},{key:"render",value:function(){return null}}]),e}(r(0).Component);e.default=i},356:function(t,e,r){(function(t){!function(e){"use strict";var r=function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)};function n(){this._subscribers={}}n.prototype.on=function(t,e){var r=this._subscribers[t];r||(r=[],this._subscribers[t]=r),r.push({callback:e})},n.prototype.off=function(t,e){var r=this._subscribers[t];if(r)for(var n=0;n<r.length;n++)r[n].callback==e&&(r.splice(n,1),n--)},n.prototype._trigger=function(t,e,r){if("*"==t)throw new Error("Cannot trigger event *");var n=[];t in this._subscribers&&(n=n.concat(this._subscribers[t])),"*"in this._subscribers&&(n=n.concat(this._subscribers["*"]));for(var i=0,o=n.length;i<o;i++){var a=n[i];a.callback&&a.callback(t,e,r||null)}};var i={municipalities:[{n:"\u5317\u4eac",g:"116.395645,39.929986|12"},{n:"\u4e0a\u6d77",g:"121.487899,31.249162|12"},{n:"\u5929\u6d25",g:"117.210813,39.14393|12"},{n:"\u91cd\u5e86",g:"106.530635,29.544606|12"}],provinces:[{n:"\u5b89\u5fbd",g:"117.216005,31.859252|8",cities:[{n:"\u5408\u80a5",g:"117.282699,31.866942|12"},{n:"\u5b89\u5e86",g:"117.058739,30.537898|13"},{n:"\u868c\u57e0",g:"117.35708,32.929499|13"},{n:"\u4eb3\u5dde",g:"115.787928,33.871211|13"},{n:"\u5de2\u6e56",g:"117.88049,31.608733|13"},{n:"\u6c60\u5dde",g:"117.494477,30.660019|14"},{n:"\u6ec1\u5dde",g:"118.32457,32.317351|13"},{n:"\u961c\u9633",g:"115.820932,32.901211|13"},{n:"\u6dee\u5317",g:"116.791447,33.960023|13"},{n:"\u6dee\u5357",g:"117.018639,32.642812|13"},{n:"\u9ec4\u5c71",g:"118.29357,29.734435|13"},{n:"\u516d\u5b89",g:"116.505253,31.755558|13"},{n:"\u9a6c\u978d\u5c71",g:"118.515882,31.688528|13"},{n:"\u5bbf\u5dde",g:"116.988692,33.636772|13"},{n:"\u94dc\u9675",g:"117.819429,30.94093|14"},{n:"\u829c\u6e56",g:"118.384108,31.36602|12"},{n:"\u5ba3\u57ce",g:"118.752096,30.951642|13"}]},{n:"\u798f\u5efa",g:"117.984943,26.050118|8",cities:[{n:"\u798f\u5dde",g:"119.330221,26.047125|12"},{n:"\u9f99\u5ca9",g:"117.017997,25.078685|13"},{n:"\u5357\u5e73",g:"118.181883,26.643626|13"},{n:"\u5b81\u5fb7",g:"119.542082,26.656527|14"},{n:"\u8386\u7530",g:"119.077731,25.44845|13"},{n:"\u6cc9\u5dde",g:"118.600362,24.901652|12"},{n:"\u4e09\u660e",g:"117.642194,26.270835|14"},{n:"\u53a6\u95e8",g:"118.103886,24.489231|12"},{n:"\u6f33\u5dde",g:"117.676205,24.517065|12"}]},{n:"\u7518\u8083",g:"102.457625,38.103267|6",cities:[{n:"\u5170\u5dde",g:"103.823305,36.064226|12"},{n:"\u767d\u94f6",g:"104.171241,36.546682|13"},{n:"\u5b9a\u897f",g:"104.626638,35.586056|13"},{n:"\u7518\u5357\u5dde",g:"102.917442,34.992211|14"},{n:"\u5609\u5cea\u5173",g:"98.281635,39.802397|13"},{n:"\u91d1\u660c",g:"102.208126,38.516072|13"},{n:"\u9152\u6cc9",g:"98.508415,39.741474|13"},{n:"\u4e34\u590f\u5dde",g:"103.215249,35.598514|13"},{n:"\u9647\u5357",g:"104.934573,33.39448|14"},{n:"\u5e73\u51c9",g:"106.688911,35.55011|13"},{n:"\u5e86\u9633",g:"107.644227,35.726801|13"},{n:"\u5929\u6c34",g:"105.736932,34.584319|13"},{n:"\u6b66\u5a01",g:"102.640147,37.933172|13"},{n:"\u5f20\u6396",g:"100.459892,38.93932|13"}]},{n:"\u5e7f\u4e1c",g:"113.394818,23.408004|8",cities:[{n:"\u5e7f\u5dde",g:"113.30765,23.120049|12"},{n:"\u6f6e\u5dde",g:"116.630076,23.661812|13"},{n:"\u4e1c\u839e",g:"113.763434,23.043024|12"},{n:"\u4f5b\u5c71",g:"113.134026,23.035095|13"},{n:"\u6cb3\u6e90",g:"114.713721,23.757251|12"},{n:"\u60e0\u5dde",g:"114.410658,23.11354|12"},{n:"\u6c5f\u95e8",g:"113.078125,22.575117|13"},{n:"\u63ed\u9633",g:"116.379501,23.547999|13"},{n:"\u8302\u540d",g:"110.931245,21.668226|13"},{n:"\u6885\u5dde",g:"116.126403,24.304571|13"},{n:"\u6e05\u8fdc",g:"113.040773,23.698469|13"},{n:"\u6c55\u5934",g:"116.72865,23.383908|13"},{n:"\u6c55\u5c3e",g:"115.372924,22.778731|14"},{n:"\u97f6\u5173",g:"113.594461,24.80296|13"},{n:"\u6df1\u5733",g:"114.025974,22.546054|12"},{n:"\u9633\u6c5f",g:"111.97701,21.871517|14"},{n:"\u4e91\u6d6e",g:"112.050946,22.937976|13"},{n:"\u6e5b\u6c5f",g:"110.365067,21.257463|13"},{n:"\u8087\u5e86",g:"112.479653,23.078663|13"},{n:"\u4e2d\u5c71",g:"113.42206,22.545178|12"},{n:"\u73e0\u6d77",g:"113.562447,22.256915|13"}]},{n:"\u5e7f\u897f",g:"108.924274,23.552255|7",cities:[{n:"\u5357\u5b81",g:"108.297234,22.806493|12"},{n:"\u767e\u8272",g:"106.631821,23.901512|13"},{n:"\u5317\u6d77",g:"109.122628,21.472718|13"},{n:"\u5d07\u5de6",g:"107.357322,22.415455|14"},{n:"\u9632\u57ce\u6e2f",g:"108.351791,21.617398|15"},{n:"\u6842\u6797",g:"110.26092,25.262901|12"},{n:"\u8d35\u6e2f",g:"109.613708,23.103373|13"},{n:"\u6cb3\u6c60",g:"108.069948,24.699521|14"},{n:"\u8d3a\u5dde",g:"111.552594,24.411054|14"},{n:"\u6765\u5bbe",g:"109.231817,23.741166|14"},{n:"\u67f3\u5dde",g:"109.422402,24.329053|12"},{n:"\u94a6\u5dde",g:"108.638798,21.97335|13"},{n:"\u68a7\u5dde",g:"111.305472,23.485395|13"},{n:"\u7389\u6797",g:"110.151676,22.643974|14"}]},{n:"\u8d35\u5dde",g:"106.734996,26.902826|8",cities:[{n:"\u8d35\u9633",g:"106.709177,26.629907|12"},{n:"\u5b89\u987a",g:"105.92827,26.228595|13"},{n:"\u6bd5\u8282\u5730\u533a",g:"105.300492,27.302612|14"},{n:"\u516d\u76d8\u6c34",g:"104.852087,26.591866|13"},{n:"\u94dc\u4ec1\u5730\u533a",g:"109.196161,27.726271|14"},{n:"\u9075\u4e49",g:"106.93126,27.699961|13"},{n:"\u9ed4\u897f\u5357\u5dde",g:"104.900558,25.095148|11"},{n:"\u9ed4\u4e1c\u5357\u5dde",g:"107.985353,26.583992|11"},{n:"\u9ed4\u5357\u5dde",g:"107.523205,26.264536|11"}]},{n:"\u6d77\u5357",g:"109.733755,19.180501|9",cities:[{n:"\u6d77\u53e3",g:"110.330802,20.022071|13"},{n:"\u767d\u6c99",g:"109.358586,19.216056|12"},{n:"\u4fdd\u4ead",g:"109.656113,18.597592|12"},{n:"\u660c\u6c5f",g:"109.0113,19.222483|12"},{n:"\u510b\u5dde",g:"109.413973,19.571153|13"},{n:"\u6f84\u8fc8",g:"109.996736,19.693135|13"},{n:"\u4e1c\u65b9",g:"108.85101,18.998161|13"},{n:"\u5b9a\u5b89",g:"110.32009,19.490991|13"},{n:"\u743c\u6d77",g:"110.414359,19.21483|13"},{n:"\u743c\u4e2d",g:"109.861849,19.039771|12"},{n:"\u4e50\u4e1c",g:"109.062698,18.658614|12"},{n:"\u4e34\u9ad8",g:"109.724101,19.805922|13"},{n:"\u9675\u6c34",g:"109.948661,18.575985|12"},{n:"\u4e09\u4e9a",g:"109.522771,18.257776|12"},{n:"\u5c6f\u660c",g:"110.063364,19.347749|13"},{n:"\u4e07\u5b81",g:"110.292505,18.839886|13"},{n:"\u6587\u660c",g:"110.780909,19.750947|13"},{n:"\u4e94\u6307\u5c71",g:"109.51775,18.831306|13"}]},{n:"\u6cb3\u5317",g:"115.661434,38.61384|7",cities:[{n:"\u77f3\u5bb6\u5e84",g:"114.522082,38.048958|12"},{n:"\u4fdd\u5b9a",g:"115.49481,38.886565|13"},{n:"\u6ca7\u5dde",g:"116.863806,38.297615|13"},{n:"\u627f\u5fb7",g:"117.933822,40.992521|14"},{n:"\u90af\u90f8",g:"114.482694,36.609308|13"},{n:"\u8861\u6c34",g:"115.686229,37.746929|13"},{n:"\u5eca\u574a",g:"116.703602,39.518611|13"},{n:"\u79e6\u7687\u5c9b",g:"119.604368,39.945462|12"},{n:"\u5510\u5c71",g:"118.183451,39.650531|13"},{n:"\u90a2\u53f0",g:"114.520487,37.069531|13"},{n:"\u5f20\u5bb6\u53e3",g:"114.893782,40.811188|13"}]},{n:"\u6cb3\u5357",g:"113.486804,34.157184|7",cities:[{n:"\u90d1\u5dde",g:"113.649644,34.75661|12"},{n:"\u5b89\u9633",g:"114.351807,36.110267|12"},{n:"\u9e64\u58c1",g:"114.29777,35.755426|13"},{n:"\u7126\u4f5c",g:"113.211836,35.234608|13"},{n:"\u5f00\u5c01",g:"114.351642,34.801854|13"},{n:"\u6d1b\u9633",g:"112.447525,34.657368|12"},{n:"\u6f2f\u6cb3",g:"114.046061,33.576279|13"},{n:"\u5357\u9633",g:"112.542842,33.01142|13"},{n:"\u5e73\u9876\u5c71",g:"113.300849,33.745301|13"},{n:"\u6fee\u9633",g:"115.026627,35.753298|12"},{n:"\u4e09\u95e8\u5ce1",g:"111.181262,34.78332|13"},{n:"\u5546\u4e18",g:"115.641886,34.438589|13"},{n:"\u65b0\u4e61",g:"113.91269,35.307258|13"},{n:"\u4fe1\u9633",g:"114.085491,32.128582|13"},{n:"\u8bb8\u660c",g:"113.835312,34.02674|13"},{n:"\u5468\u53e3",g:"114.654102,33.623741|13"},{n:"\u9a7b\u9a6c\u5e97",g:"114.049154,32.983158|13"}]},{n:"\u9ed1\u9f99\u6c5f",g:"128.047414,47.356592|6",cities:[{n:"\u54c8\u5c14\u6ee8",g:"126.657717,45.773225|12"},{n:"\u5927\u5e86",g:"125.02184,46.596709|12"},{n:"\u5927\u5174\u5b89\u5cad\u5730\u533a",g:"124.196104,51.991789|10"},{n:"\u9e64\u5c97",g:"130.292472,47.338666|13"},{n:"\u9ed1\u6cb3",g:"127.50083,50.25069|14"},{n:"\u9e21\u897f",g:"130.941767,45.32154|13"},{n:"\u4f73\u6728\u65af",g:"130.284735,46.81378|12"},{n:"\u7261\u4e39\u6c5f",g:"129.608035,44.588521|13"},{n:"\u4e03\u53f0\u6cb3",g:"131.019048,45.775005|14"},{n:"\u9f50\u9f50\u54c8\u5c14",g:"123.987289,47.3477|13"},{n:"\u53cc\u9e2d\u5c71",g:"131.171402,46.655102|13"},{n:"\u7ee5\u5316",g:"126.989095,46.646064|13"},{n:"\u4f0a\u6625",g:"128.910766,47.734685|14"}]},{n:"\u6e56\u5317",g:"112.410562,31.209316|8",cities:[{n:"\u6b66\u6c49",g:"114.3162,30.581084|12"},{n:"\u9102\u5dde",g:"114.895594,30.384439|14"},{n:"\u6069\u65bd",g:"109.517433,30.308978|14"},{n:"\u9ec4\u5188",g:"114.906618,30.446109|14"},{n:"\u9ec4\u77f3",g:"115.050683,30.216127|13"},{n:"\u8346\u95e8",g:"112.21733,31.042611|13"},{n:"\u8346\u5dde",g:"112.241866,30.332591|12"},{n:"\u6f5c\u6c5f",g:"112.768768,30.343116|13"},{n:"\u795e\u519c\u67b6\u6797\u533a",g:"110.487231,31.595768|13"},{n:"\u5341\u5830",g:"110.801229,32.636994|13"},{n:"\u968f\u5dde",g:"113.379358,31.717858|13"},{n:"\u5929\u95e8",g:"113.12623,30.649047|13"},{n:"\u4ed9\u6843",g:"113.387448,30.293966|13"},{n:"\u54b8\u5b81",g:"114.300061,29.880657|13"},{n:"\u8944\u9633",g:"112.176326,32.094934|12"},{n:"\u5b5d\u611f",g:"113.935734,30.927955|13"},{n:"\u5b9c\u660c",g:"111.310981,30.732758|13"}]},{n:"\u6e56\u5357",g:"111.720664,27.695864|7",cities:[{n:"\u957f\u6c99",g:"112.979353,28.213478|12"},{n:"\u5e38\u5fb7",g:"111.653718,29.012149|12"},{n:"\u90f4\u5dde",g:"113.037704,25.782264|13"},{n:"\u8861\u9633",g:"112.583819,26.898164|13"},{n:"\u6000\u5316",g:"109.986959,27.557483|13"},{n:"\u5a04\u5e95",g:"111.996396,27.741073|13"},{n:"\u90b5\u9633",g:"111.461525,27.236811|13"},{n:"\u6e58\u6f6d",g:"112.935556,27.835095|13"},{n:"\u6e58\u897f\u5dde",g:"109.745746,28.317951|14"},{n:"\u76ca\u9633",g:"112.366547,28.588088|13"},{n:"\u6c38\u5dde",g:"111.614648,26.435972|13"},{n:"\u5cb3\u9633",g:"113.146196,29.378007|13"},{n:"\u5f20\u5bb6\u754c",g:"110.48162,29.124889|13"},{n:"\u682a\u6d32",g:"113.131695,27.827433|13"}]},{n:"\u6c5f\u82cf",g:"119.368489,33.013797|8",cities:[{n:"\u5357\u4eac",g:"118.778074,32.057236|12"},{n:"\u5e38\u5dde",g:"119.981861,31.771397|12"},{n:"\u6dee\u5b89",g:"119.030186,33.606513|12"},{n:"\u8fde\u4e91\u6e2f",g:"119.173872,34.601549|12"},{n:"\u5357\u901a",g:"120.873801,32.014665|12"},{n:"\u82cf\u5dde",g:"120.619907,31.317987|12"},{n:"\u5bbf\u8fc1",g:"118.296893,33.95205|13"},{n:"\u6cf0\u5dde",g:"119.919606,32.476053|13"},{n:"\u65e0\u9521",g:"120.305456,31.570037|12"},{n:"\u5f90\u5dde",g:"117.188107,34.271553|12"},{n:"\u76d0\u57ce",g:"120.148872,33.379862|12"},{n:"\u626c\u5dde",g:"119.427778,32.408505|13"},{n:"\u9547\u6c5f",g:"119.455835,32.204409|13"}]},{n:"\u6c5f\u897f",g:"115.676082,27.757258|7",cities:[{n:"\u5357\u660c",g:"115.893528,28.689578|12"},{n:"\u629a\u5dde",g:"116.360919,27.954545|13"},{n:"\u8d63\u5dde",g:"114.935909,25.845296|13"},{n:"\u5409\u5b89",g:"114.992039,27.113848|13"},{n:"\u666f\u5fb7\u9547",g:"117.186523,29.303563|12"},{n:"\u4e5d\u6c5f",g:"115.999848,29.71964|13"},{n:"\u840d\u4e61",g:"113.859917,27.639544|13"},{n:"\u4e0a\u9976",g:"117.955464,28.457623|13"},{n:"\u65b0\u4f59",g:"114.947117,27.822322|13"},{n:"\u5b9c\u6625",g:"114.400039,27.81113|13"},{n:"\u9e70\u6f6d",g:"117.03545,28.24131|13"}]},{n:"\u5409\u6797",g:"126.262876,43.678846|7",cities:[{n:"\u957f\u6625",g:"125.313642,43.898338|12"},{n:"\u767d\u57ce",g:"122.840777,45.621086|13"},{n:"\u767d\u5c71",g:"126.435798,41.945859|13"},{n:"\u5409\u6797",g:"126.564544,43.871988|12"},{n:"\u8fbd\u6e90",g:"125.133686,42.923303|13"},{n:"\u56db\u5e73",g:"124.391382,43.175525|12"},{n:"\u677e\u539f",g:"124.832995,45.136049|13"},{n:"\u901a\u5316",g:"125.94265,41.736397|13"},{n:"\u5ef6\u8fb9",g:"129.485902,42.896414|13"}]},{n:"\u8fbd\u5b81",g:"122.753592,41.6216|8",cities:[{n:"\u6c88\u9633",g:"123.432791,41.808645|12"},{n:"\u978d\u5c71",g:"123.007763,41.118744|13"},{n:"\u672c\u6eaa",g:"123.778062,41.325838|12"},{n:"\u671d\u9633",g:"120.446163,41.571828|13"},{n:"\u5927\u8fde",g:"121.593478,38.94871|12"},{n:"\u4e39\u4e1c",g:"124.338543,40.129023|12"},{n:"\u629a\u987a",g:"123.92982,41.877304|12"},{n:"\u961c\u65b0",g:"121.660822,42.01925|14"},{n:"\u846b\u82a6\u5c9b",g:"120.860758,40.74303|13"},{n:"\u9526\u5dde",g:"121.147749,41.130879|13"},{n:"\u8fbd\u9633",g:"123.172451,41.273339|14"},{n:"\u76d8\u9526",g:"122.073228,41.141248|13"},{n:"\u94c1\u5cad",g:"123.85485,42.299757|13"},{n:"\u8425\u53e3",g:"122.233391,40.668651|13"}]},{n:"\u5185\u8499\u53e4",g:"114.415868,43.468238|5",cities:[{n:"\u547c\u548c\u6d69\u7279",g:"111.660351,40.828319|12"},{n:"\u963f\u62c9\u5584\u76df",g:"105.695683,38.843075|14"},{n:"\u5305\u5934",g:"109.846239,40.647119|12"},{n:"\u5df4\u5f66\u6dd6\u5c14",g:"107.423807,40.76918|12"},{n:"\u8d64\u5cf0",g:"118.930761,42.297112|12"},{n:"\u9102\u5c14\u591a\u65af",g:"109.993706,39.81649|12"},{n:"\u547c\u4f26\u8d1d\u5c14",g:"119.760822,49.201636|12"},{n:"\u901a\u8fbd",g:"122.260363,43.633756|12"},{n:"\u4e4c\u6d77",g:"106.831999,39.683177|13"},{n:"\u4e4c\u5170\u5bdf\u5e03",g:"113.112846,41.022363|12"},{n:"\u9521\u6797\u90ed\u52d2\u76df",g:"116.02734,43.939705|11"},{n:"\u5174\u5b89\u76df",g:"122.048167,46.083757|11"}]},{n:"\u5b81\u590f",g:"106.155481,37.321323|8",cities:[{n:"\u94f6\u5ddd",g:"106.206479,38.502621|12"},{n:"\u56fa\u539f",g:"106.285268,36.021523|13"},{n:"\u77f3\u5634\u5c71",g:"106.379337,39.020223|13"},{n:"\u5434\u5fe0",g:"106.208254,37.993561|14"},{n:"\u4e2d\u536b",g:"105.196754,37.521124|14"}]},{n:"\u9752\u6d77",g:"96.202544,35.499761|7",cities:[{n:"\u897f\u5b81",g:"101.767921,36.640739|12"},{n:"\u679c\u6d1b\u5dde",g:"100.223723,34.480485|11"},{n:"\u6d77\u4e1c\u5730\u533a",g:"102.085207,36.51761|11"},{n:"\u6d77\u5317\u5dde",g:"100.879802,36.960654|11"},{n:"\u6d77\u5357\u5dde",g:"100.624066,36.284364|11"},{n:"\u6d77\u897f\u5dde",g:"97.342625,37.373799|11"},{n:"\u9ec4\u5357\u5dde",g:"102.0076,35.522852|11"},{n:"\u7389\u6811\u5dde",g:"97.013316,33.00624|14"}]},{n:"\u5c71\u4e1c",g:"118.527663,36.09929|8",cities:[{n:"\u6d4e\u5357",g:"117.024967,36.682785|12"},{n:"\u6ee8\u5dde",g:"117.968292,37.405314|12"},{n:"\u4e1c\u8425",g:"118.583926,37.487121|12"},{n:"\u5fb7\u5dde",g:"116.328161,37.460826|12"},{n:"\u83cf\u6cfd",g:"115.46336,35.26244|13"},{n:"\u6d4e\u5b81",g:"116.600798,35.402122|13"},{n:"\u83b1\u829c",g:"117.684667,36.233654|13"},{n:"\u804a\u57ce",g:"115.986869,36.455829|12"},{n:"\u4e34\u6c82",g:"118.340768,35.072409|12"},{n:"\u9752\u5c9b",g:"120.384428,36.105215|12"},{n:"\u65e5\u7167",g:"119.50718,35.420225|12"},{n:"\u6cf0\u5b89",g:"117.089415,36.188078|13"},{n:"\u5a01\u6d77",g:"122.093958,37.528787|13"},{n:"\u6f4d\u574a",g:"119.142634,36.716115|12"},{n:"\u70df\u53f0",g:"121.309555,37.536562|12"},{n:"\u67a3\u5e84",g:"117.279305,34.807883|13"},{n:"\u6dc4\u535a",g:"118.059134,36.804685|12"}]},{n:"\u5c71\u897f",g:"112.515496,37.866566|7",cities:[{n:"\u592a\u539f",g:"112.550864,37.890277|12"},{n:"\u957f\u6cbb",g:"113.120292,36.201664|12"},{n:"\u5927\u540c",g:"113.290509,40.113744|12"},{n:"\u664b\u57ce",g:"112.867333,35.499834|13"},{n:"\u664b\u4e2d",g:"112.738514,37.693362|13"},{n:"\u4e34\u6c7e",g:"111.538788,36.099745|13"},{n:"\u5415\u6881",g:"111.143157,37.527316|14"},{n:"\u6714\u5dde",g:"112.479928,39.337672|13"},{n:"\u5ffb\u5dde",g:"112.727939,38.461031|12"},{n:"\u9633\u6cc9",g:"113.569238,37.869529|13"},{n:"\u8fd0\u57ce",g:"111.006854,35.038859|13"}]},{n:"\u9655\u897f",g:"109.503789,35.860026|7",cities:[{n:"\u897f\u5b89",g:"108.953098,34.2778|12"},{n:"\u5b89\u5eb7",g:"109.038045,32.70437|13"},{n:"\u5b9d\u9e21",g:"107.170645,34.364081|12"},{n:"\u6c49\u4e2d",g:"107.045478,33.081569|13"},{n:"\u5546\u6d1b",g:"109.934208,33.873907|13"},{n:"\u94dc\u5ddd",g:"108.968067,34.908368|13"},{n:"\u6e2d\u5357",g:"109.483933,34.502358|13"},{n:"\u54b8\u9633",g:"108.707509,34.345373|13"},{n:"\u5ef6\u5b89",g:"109.50051,36.60332|13"},{n:"\u6986\u6797",g:"109.745926,38.279439|12"}]},{n:"\u56db\u5ddd",g:"102.89916,30.367481|7",cities:[{n:"\u6210\u90fd",g:"104.067923,30.679943|12"},{n:"\u963f\u575d\u5dde",g:"102.228565,31.905763|15"},{n:"\u5df4\u4e2d",g:"106.757916,31.869189|14"},{n:"\u8fbe\u5dde",g:"107.494973,31.214199|14"},{n:"\u5fb7\u9633",g:"104.402398,31.13114|13"},{n:"\u7518\u5b5c\u5dde",g:"101.969232,30.055144|15"},{n:"\u5e7f\u5b89",g:"106.63572,30.463984|13"},{n:"\u5e7f\u5143",g:"105.819687,32.44104|13"},{n:"\u4e50\u5c71",g:"103.760824,29.600958|13"},{n:"\u51c9\u5c71\u5dde",g:"102.259591,27.892393|14"},{n:"\u6cf8\u5dde",g:"105.44397,28.89593|14"},{n:"\u5357\u5145",g:"106.105554,30.800965|13"},{n:"\u7709\u5c71",g:"103.84143,30.061115|13"},{n:"\u7ef5\u9633",g:"104.705519,31.504701|12"},{n:"\u5185\u6c5f",g:"105.073056,29.599462|13"},{n:"\u6500\u679d\u82b1",g:"101.722423,26.587571|14"},{n:"\u9042\u5b81",g:"105.564888,30.557491|12"},{n:"\u96c5\u5b89",g:"103.009356,29.999716|13"},{n:"\u5b9c\u5bbe",g:"104.633019,28.769675|13"},{n:"\u8d44\u9633",g:"104.63593,30.132191|13"},{n:"\u81ea\u8d21",g:"104.776071,29.359157|13"}]},{n:"\u897f\u85cf",g:"89.137982,31.367315|6",cities:[{n:"\u62c9\u8428",g:"91.111891,29.662557|13"},{n:"\u963f\u91cc\u5730\u533a",g:"81.107669,30.404557|11"},{n:"\u660c\u90fd\u5730\u533a",g:"97.185582,31.140576|15"},{n:"\u6797\u829d\u5730\u533a",g:"94.349985,29.666941|11"},{n:"\u90a3\u66f2\u5730\u533a",g:"92.067018,31.48068|14"},{n:"\u65e5\u5580\u5219\u5730\u533a",g:"88.891486,29.269023|14"},{n:"\u5c71\u5357\u5730\u533a",g:"91.750644,29.229027|11"}]},{n:"\u65b0\u7586",g:"85.614899,42.127001|6",cities:[{n:"\u4e4c\u9c81\u6728\u9f50",g:"87.564988,43.84038|12"},{n:"\u963f\u62c9\u5c14",g:"81.291737,40.61568|13"},{n:"\u963f\u514b\u82cf\u5730\u533a",g:"80.269846,41.171731|12"},{n:"\u963f\u52d2\u6cf0\u5730\u533a",g:"88.137915,47.839744|13"},{n:"\u5df4\u97f3\u90ed\u695e",g:"86.121688,41.771362|12"},{n:"\u535a\u5c14\u5854\u62c9\u5dde",g:"82.052436,44.913651|11"},{n:"\u660c\u5409\u5dde",g:"87.296038,44.007058|13"},{n:"\u54c8\u5bc6\u5730\u533a",g:"93.528355,42.858596|13"},{n:"\u548c\u7530\u5730\u533a",g:"79.930239,37.116774|13"},{n:"\u5580\u4ec0\u5730\u533a",g:"75.992973,39.470627|12"},{n:"\u514b\u62c9\u739b\u4f9d",g:"84.88118,45.594331|13"},{n:"\u514b\u5b5c\u52d2\u82cf\u5dde",g:"76.137564,39.750346|11"},{n:"\u77f3\u6cb3\u5b50",g:"86.041865,44.308259|13"},{n:"\u5854\u57ce\u5730\u533a",g:"82.974881,46.758684|12"},{n:"\u56fe\u6728\u8212\u514b",g:"79.198155,39.889223|13"},{n:"\u5410\u9c81\u756a\u5730\u533a",g:"89.181595,42.96047|13"},{n:"\u4e94\u5bb6\u6e20",g:"87.565449,44.368899|13"},{n:"\u4f0a\u7281\u5dde",g:"81.297854,43.922248|11"}]},{n:"\u4e91\u5357",g:"101.592952,24.864213|7",cities:[{n:"\u6606\u660e",g:"102.714601,25.049153|12"},{n:"\u4fdd\u5c71",g:"99.177996,25.120489|13"},{n:"\u695a\u96c4\u5dde",g:"101.529382,25.066356|13"},{n:"\u5927\u7406\u5dde",g:"100.223675,25.5969|14"},{n:"\u5fb7\u5b8f\u5dde",g:"98.589434,24.44124|14"},{n:"\u8fea\u5e86\u5dde",g:"99.713682,27.831029|14"},{n:"\u7ea2\u6cb3\u5dde",g:"103.384065,23.367718|11"},{n:"\u4e3d\u6c5f",g:"100.229628,26.875351|13"},{n:"\u4e34\u6ca7",g:"100.092613,23.887806|14"},{n:"\u6012\u6c5f\u5dde",g:"98.859932,25.860677|14"},{n:"\u666e\u6d31",g:"100.980058,22.788778|14"},{n:"\u66f2\u9756",g:"103.782539,25.520758|12"},{n:"\u662d\u901a",g:"103.725021,27.340633|13"},{n:"\u6587\u5c71",g:"104.089112,23.401781|14"},{n:"\u897f\u53cc\u7248\u7eb3",g:"100.803038,22.009433|13"},{n:"\u7389\u6eaa",g:"102.545068,24.370447|13"}]},{n:"\u6d59\u6c5f",g:"119.957202,29.159494|8",cities:[{n:"\u676d\u5dde",g:"120.219375,30.259244|12"},{n:"\u6e56\u5dde",g:"120.137243,30.877925|12"},{n:"\u5609\u5174",g:"120.760428,30.773992|13"},{n:"\u91d1\u534e",g:"119.652576,29.102899|12"},{n:"\u4e3d\u6c34",g:"119.929576,28.4563|13"},{n:"\u5b81\u6ce2",g:"121.579006,29.885259|12"},{n:"\u8862\u5dde",g:"118.875842,28.95691|12"},{n:"\u7ecd\u5174",g:"120.592467,30.002365|13"},{n:"\u53f0\u5dde",g:"121.440613,28.668283|13"},{n:"\u6e29\u5dde",g:"120.690635,28.002838|12"},{n:"\u821f\u5c71",g:"122.169872,30.03601|13"}]}],other:[{n:"\u9999\u6e2f",g:"114.186124,22.293586|11"},{n:"\u6fb3\u95e8",g:"113.557519,22.204118|13"},{n:"\u53f0\u6e7e",g:"120.961454,23.80406|8"}]};function o(t){var e=t.split("|");return e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}var a={getProvinceNameByCityName:function(t){for(var e=i.provinces,r=0;r<e.length;r++)for(var n=e[r].n,o=e[r].cities,a=0;a<o.length;a++)if(o[a].n==t)return n;return null},getCenterByCityName:function(t){t=t.replace("\u5e02","");for(var e=0;e<i.municipalities.length;e++)if(i.municipalities[e].n==t)return o(i.municipalities[e].g);for(e=0;e<i.other.length;e++)if(i.other[e].n==t)return o(i.other[e].g);var r=i.provinces;for(e=0;e<r.length;e++){if(r[e].n==t)return o(r[e].g);for(var n=r[e].cities,a=0;a<n.length;a++)if(n[a].n==t)return o(n[a].g)}return null}},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),l=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},h=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e};function f(t,e){n.bind(this)(),this._options=e||{},this._data=[],t&&this.add(t)}function p(t,e,r){var n=60*r+30,i=Math.PI/180*n;return[t.x+e*Math.cos(i),t.y+e*Math.sin(i)]}f.prototype=n.prototype,f.prototype.add=function(t,e){if(Array.isArray(t)){for(var r=0,n=t.length;r<n;r++)if(t[r]){if(t[r].time&&14==t[r].time.length&&"20"==t[r].time.substr(0,2)){var i=t[r].time;t[r].time=new Date(i.substr(0,4)+"-"+i.substr(4,2)+"-"+i.substr(6,2)+" "+i.substr(8,2)+":"+i.substr(10,2)+":"+i.substr(12,2)).getTime()}this._data.push(t[r])}}else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},f.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},f.prototype.get=function(t){t=t||{},new Date;var e=this._data;if(new Date,t.filter){for(var r=[],n=0;n<e.length;n++)t.filter(e[n])&&r.push(e[n]);e=r}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn)),e},f.prototype.set=function(t){this._set(t),this._trigger("change")},f.prototype._set=function(t){this.clear(),this.add(t)},f.prototype.clear=function(t){this._data=[]},f.prototype.remove=function(t){},f.prototype.update=function(t,e){for(var r=this._data,n=0;n<r.length;n++)if(e){var i=!0;for(var o in e)r[n][o]!=e[o]&&(i=!1);i&&t&&t(r[n])}else t&&t(r[n]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},f.prototype.transferCoordinate=function(t,e,r,n){n=n||"_coordinates",r=r||"coordinates";for(var i=0;i<t.length;i++){var o=t[i].geometry,a=o[r];switch(o.type){case"Point":o[n]=e(a);break;case"LineString":for(var s=[],u=0;u<a.length;u++)s.push(e(a[u]));o[n]=s;break;case"MultiLineString":case"Polygon":s=c(a),o[n]=s;break;case"MultiPolygon":s=[];for(var l=0;l<a.length;l++){var h=c(h=a[l]);s.push(h)}o[n]=s}}function c(t){for(var r=[],n=0;n<t.length;n++){for(var i=t[n],o=[],a=0;a<i.length;a++)o.push(e(i[a]));r.push(o)}return r}return t},f.prototype.initGeometry=function(t){t?this._data.forEach((function(e){e.geometry=t(e)})):this._data.forEach((function(t){if(!t.geometry)if(t.lng&&t.lat)t.geometry={type:"Point",coordinates:[t.lng,t.lat]};else if(t.city){var e=a.getCenterByCityName(t.city);e&&(t.geometry={type:"Point",coordinates:[e.lng,e.lat]})}}))},f.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var r=parseFloat(e[0][t]),n=1;n<e.length;n++){var i=parseFloat(e[n][t]);i>r&&(r=i)}return r}},f.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var r=0,n=0;n<e.length;n++)e[n][t]&&(r+=parseFloat(e[n][t]));return r}},f.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var r=parseFloat(e[0][t]),n=1;n<e.length;n++){var i=parseFloat(e[n][t]);i<r&&(r=i)}return r}},f.prototype.getUnique=function(t){if((n=this._data)&&!(n.length<=0)){for(var e={},r=1;r<n.length;r++)e[n[r][t]]=!0;var n=[];for(var i in e)n.push(i);return n}};var d={drawDataSet:function(t,e,r){for(var n=e instanceof f?e.get():e,i=0,o=n.length;i<o;i++){var a=n[i];this.draw(t,a,r)}},draw:function(t,e,r){var n=e.geometry.type,i=e.geometry._coordinates||e.geometry.coordinates,o=e.symbol||r.symbol||"circle";switch(n){case"Point":var a=e._size||e.size||r._size||r.size||5;"circle"===o?("Point"===r.bigData&&t.moveTo(i[0],i[1]),t.arc(i[0],i[1],a,0,2*Math.PI)):"rect"===o?t.rect(i[0]-a/2,i[1]-a/2,a,a):"honeycomb"===o&&function(t,e,r,n){for(var i=0;i<6;i++){var o=p({x:e,y:r},n,i);t.lineTo(o[0],o[1])}}(t,i[0],i[1],a);break;case"LineString":this.drawLineString(t,i);break;case"MultiLineString":for(var s=0;s<i.length;s++){var u=i[s];this.drawLineString(t,u)}break;case"Polygon":this.drawPolygon(t,i);break;case"MultiPolygon":for(s=0;s<i.length;s++){var l=i[s];if(this.drawPolygon(t,l),r.multiPolygonDraw){var h=r.multiPolygonDraw();if(h)return h}}break;default:console.error("type"+n+"is not support now!")}},drawLineString:function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0],i=e[r][1];0==r?t.moveTo(n,i):t.lineTo(n,i)}},drawPolygon:function(t,e){t.beginPath();for(var r=0;r<e.length;r++){var n=e[r];t.moveTo(n[0][0],n[0][1]);for(var i=1;i<n.length;i++)t.lineTo(n[i][0],n[i][1]);t.lineTo(n[0][0],n[0][1]),t.closePath()}}},v={draw:function(t,e,r){var n=e instanceof f?e.get():e;for(var i in t.save(),r)t[i]=r[i];if(r.bigData){t.save(),t.beginPath();for(var o=0,a=n.length;o<a;o++){var s=n[o];d.draw(t,s,r)}"Point"==(u=r.bigData)||"Polygon"==u||"MultiPolygon"==u?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash),(s.strokeStyle||r.strokeStyle)&&r.lineWidth&&t.stroke()):"LineString"!=u&&"MultiLineString"!=u||t.stroke(),t.restore()}else for(o=0,a=n.length;o<a;o++){s=n[o],t.save(),(s.fillStyle||s._fillStyle)&&(t.fillStyle=s.fillStyle||s._fillStyle),(s.strokeStyle||s._strokeStyle)&&(t.strokeStyle=s.strokeStyle||s._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash);var u=s.geometry.type;t.beginPath(),r.multiPolygonDraw=function(){t.fill(),(s.strokeStyle||r.strokeStyle)&&r.lineWidth&&t.stroke()},d.draw(t,s,r),"Point"==u||"Polygon"==u||"MultiPolygon"==u?(t.fill(),(s.strokeStyle||r.strokeStyle)&&r.lineWidth&&t.stroke()):"LineString"!=u&&"MultiLineString"!=u||((s.lineWidth||s._lineWidth)&&(t.lineWidth=s.lineWidth||s._lineWidth),t.stroke()),t.restore()}t.restore()}};function g(t,e){if("undefined"===typeof document);else{var r=document.createElement("canvas");t&&(r.width=t),e&&(r.height=e)}return r}function m(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}m.prototype.setMax=function(t){this.max=t||100},m.prototype.setMin=function(t){this.min=t||0},m.prototype.setMaxSize=function(t){this.maxSize=t||35},m.prototype.setMinSize=function(t){this.minSize=t||0},m.prototype.initPalette=function(){var t=this.gradient,e=new g(256,1),r=this.paletteCtx=e.getContext("2d"),n=r.createLinearGradient(0,0,256,1);for(var i in t)n.addColorStop(parseFloat(i),t[i]);r.fillStyle=n,r.fillRect(0,0,256,1)},m.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},m.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var r=this.max,n=this.min;t>r&&(t=r),t<n&&(t=n);var i=4*Math.floor((t-n)/(r-n)*255);return[e[i],e[i+1],e[i+2],e[i+3]]},m.prototype.getSize=function(t){var e=this.max,r=this.min,n=this.maxSize,i=this.minSize;return t>e&&(t=e),t<r&&(t=r),e>r?i+(t-r)/(e-r)*(n-i):n},m.prototype.getLegend=function(t){var e=this.gradient,r=t.width||20,n=t.height||180,i=new g(r,n),o=i.getContext("2d"),a=o.createLinearGradient(0,n,0,0);for(var s in e)a.addColorStop(parseFloat(s),e[s]);return o.fillStyle=a,o.fillRect(0,0,r,n),i};var y=("undefined"===typeof window?{}:window).devicePixelRatio||1;function b(t){return t.max||100}function x(t){return t.min||0}function _(t,e,r){var n=b(r),i=x(r),o=r._size;void 0==o&&void 0==(o=r.size)&&(o=13);var a=new m({gradient:r.gradient,max:n,min:i}),s=function(t){var e=t/2,r=t+e,n=new g(2*r,2*r),i=n.getContext("2d");return i.shadowBlur=e,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=1e4,i.beginPath(),i.arc(r-1e4,r-1e4,t,0,2*Math.PI,!0),i.closePath(),i.fill(),n}(o),u=s.width/2,l=s.height/2,h=e,c={};for(var f in h.forEach((function(t,e){var r=void 0===t.count?1:t.count,i=Math.min(1,r/n).toFixed(2);c[i]=c[i]||[],c[i].push(t)})),c)if(!isNaN(f)){var p=c[f];t.beginPath(),r.withoutAlpha||(t.globalAlpha=f),t.strokeStyle=a.getColor(f*n),p.forEach((function(e,i){if(e.geometry){var o=e.geometry._coordinates||e.geometry.coordinates,a=e.geometry.type;if("Point"===a){var h=void 0===e.count?1:e.count;t.globalAlpha=h/n,t.drawImage(s,o[0]-u,o[1]-l)}else"LineString"===a&&(h=void 0===e.count?1:e.count,t.globalAlpha=h/n,t.beginPath(),d.draw(t,e,r),t.stroke())}}))}}var w={draw:function(t,e,r){if(!(t.canvas.width<=0||t.canvas.height<=0)){var n=r.strength||.3;t.strokeStyle="rgba(0,0,0,"+n+")";var i=new g(t.canvas.width,t.canvas.height),o=i.getContext("2d");o.scale(y,y),r=r||{};var a=e instanceof f?e.get():e;t.save();var s=new m({gradient:r.gradient});if(_(o,a,r),!r.absolute){var u=o.getImageData(0,0,t.canvas.width,t.canvas.height);!function(t,e,r){var n=b(r),i=x(r),o=n-i,a=0,s=1024;(c=r.range||null)&&2===c.length&&(a=(c[0]-i)/o*1024),c&&2===c.length&&(s=(c[1]-i)/o*1024);for(var u,l=r.maxOpacity||.8,h=r.minOpacity||0,c=r.range,f=3,p=t.length;f<p;f+=4)u=4*t[f],t[f]/256>l&&(t[f]=256*l),t[f]/256<h&&(t[f]=256*h),u&&u>=a&&u<=s?(t[f-3]=e[u],t[f-2]=e[u+1],t[f-1]=e[u+2]):t[f]=0}(u.data,s.getImageData(),r),t.putImageData(u,0,0),t.restore()}s=null,i=null}}},M={draw:function(t,e,r){t.save();var n=e instanceof f?e.get():e,i={},o=r._size||r.size||50,a=!("enableCluster"in r)||r.enableCluster,s=r.offset||{x:0,y:0},u=new m({min:r.min||0,max:r.max||100,gradient:r.gradient});if(a){for(var l=0;l<n.length;l++)p=n[l].geometry._coordinates||n[l].geometry.coordinates,i[v=Math.floor((p[0]-s.x)/o)+","+Math.floor((p[1]-s.y)/o)]||(i[v]=0),i[v]+=~~(n[l].count||1);for(var h in i)h=h.split(","),t.beginPath(),t.rect(h[0]*o+.5+s.x,h[1]*o+.5+s.y,o,o),t.fillStyle=u.getColor(i[h]),t.fill(),r.strokeStyle&&r.lineWidth&&t.stroke()}else{for(var c=0;c<n.length;c++){var p;i[v=(p=n[c].geometry._coordinates||n[c].geometry.coordinates).join(",")]=n[c].count||1}for(var d in i)d=d.split(","),t.beginPath(),t.rect(+d[0]-o/2,+d[1]-o/2,o,o),t.fillStyle=u.getColor(i[d]),t.fill(),r.strokeStyle&&r.lineWidth&&t.stroke()}if(r.label&&!1!==r.label.show)for(var v in t.fillStyle=r.label.fillStyle||"white",r.label.font&&(t.font=r.label.font),r.label.shadowColor&&(t.shadowColor=r.label.shadowColor),r.label.shadowBlur&&(t.shadowBlur=r.label.shadowBlur),i){var g=i[v=v.split(",")],y=t.measureText(g).width;a?t.fillText(g,v[0]*o+.5+s.x+o/2-y/2,v[1]*o+.5+s.y+o/2+5):t.fillText(g,+v[0]-y/2,+v[1]+5)}t.restore()}};function E(t,e,r){var n=60*r+30,i=Math.PI/180*n;return[t.x+e*Math.cos(i),t.y+e*Math.sin(i)]}var T={draw:function(t,e,r){t.save();var n=e instanceof f?e.get():e;for(var i in r)t[i]=r[i];for(var o=r.offset||{x:10,y:10},a=r._size||r.size||40,s=2*(a=a/2/Math.sin(Math.PI/3))*Math.sin(Math.PI/3),u=1.5*a,l={},h=0;h<n.length;h++){var c=n[h].geometry._coordinates||n[h].geometry.coordinates,p=(c[1]-o.y)/u,d=Math.round(p),v=(c[0]-o.x)/s-(1&d?.5:0),g=Math.round(v),y=p-d;if(3*Math.abs(y)>1){var b=v-g,x=g+(v<g?-1:1)/2,_=d+(p<d?-1:1),w=v-x,M=p-_;b*b+y*y>w*w+M*M&&(g=x+(1&d?1:-1)/2,d=_)}var T=g+"-"+d,P=l[T];P?P.push(n[h]):((P=l[T]=[n[h]]).i=g,P.j=d,P.x=(g+(1&d?.5:0))*s,P.y=d*u)}var A=new m({max:r.max||100,maxSize:a,gradient:r.gradient});for(var i in l){var S=l[i];t.beginPath();for(var L=0;L<6;L++){var O=E({x:S.x+o.x,y:S.y+o.y},a,L);t.lineTo(O[0],O[1])}t.closePath();var R=0;for(h=0;h<S.length;h++)R+=S[h].count||1;S.count=R,t.fillStyle=A.getColor(R),t.fill(),r.strokeStyle&&r.lineWidth&&t.stroke()}if(r.label&&!1!==r.label.show)for(var i in t.fillStyle=r.label.fillStyle||"white",r.label.font&&(t.font=r.label.font),r.label.shadowColor&&(t.shadowColor=r.label.shadowColor),r.label.shadowBlur&&(t.shadowBlur=r.label.shadowBlur),l){var C=(S=l[i]).count;C=C<0?C.toFixed(2):~~C;var k=t.measureText(C).width;t.fillText(C,S.x+o.x-k/2,S.y+o.y+5)}t.restore()}};function A(t,e,r){var n=t.createShader(r);return t.shaderSource(n,e),t.compileShader(n),n}function S(t,e,r){var n=A(t,e,t.VERTEX_SHADER),i=A(t,r,t.FRAGMENT_SHADER),o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,i),t.linkProgram(o),t.useProgram(o),o}function O(t){var e=document.createElement("canvas"),r=e.getContext("2d");return e.width=1,e.height=1,r.fillStyle=t,r.fillRect(0,0,1,1),r.getImageData(0,0,1,1).data}var R=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),C=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),k={draw:function(t,e,r){if(e){var n=S(t,R,C);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT);var i=t.canvas.width/2,o=t.canvas.height/2,a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var s=t.getAttribLocation(n,"a_Position");t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);var u=t.getUniformLocation(n,"u_FragColor"),l=O(r.strokeStyle||"red");t.uniform4f(u,l[0]/255,l[1]/255,l[2]/255,l[3]/255),t.lineWidth(r.lineWidth||1);for(var h=0,c=e.length;h<c;h++){for(var f=e[h].geometry._coordinates,p=[],d=0;d<f.length;d++){var v=f[d],g=(v[0]-i)/i,m=(o-v[1])/o;p.push(g,m)}var y=new Float32Array(p);t.bufferData(t.ARRAY_BUFFER,y,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,f.length)}}}},B=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),D=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),F={draw:function(t,e,r){if(e){var n=S(t,B,D),i=t.getAttribLocation(n,"a_Position"),o=t.getAttribLocation(n,"a_PointSize"),a=t.getUniformLocation(n,"u_FragColor");t.clear(t.COLOR_BUFFER_BIT);for(var s=t.canvas.width/2,u=t.canvas.height/2,l=[],h=0,c=0;c<e.length;c++){var f=e[c].geometry._coordinates,p=(f[0]-s)/s,d=(u-f[1])/u;p<-1||p>1||d<-1||d>1||(l.push(p,d),h++)}var v=new Float32Array(l),g=h,m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i),t.vertexAttrib1f(o,r._size);var y=O(r.fillStyle||"red");t.uniform4f(a,y[0]/255,y[1]/255,y[2]/255,y[3]/255),t.drawArrays(t.POINTS,0,g)}}};function z(t,e,r){r=r||2;var n,i,o,a,s,u,l,h=e&&e.length,c=h?e[0]*r:t.length,f=I(t,0,c,r,!0),p=[];if(!f)return p;if(h&&(f=function(t,e,r,n){var i,o,a,s,u,l=[];for(i=0,o=e.length;i<o;i++)a=e[i]*n,s=i<o-1?e[i+1]*n:t.length,(u=I(t,a,s,n,!1))===u.next&&(u.steiner=!0),l.push(X(u));for(l.sort(q),i=0;i<l.length;i++)Z(l[i],r),r=U(r,r.next);return r}(t,e,f,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<c;d+=r)(s=t[d])<n&&(n=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=Math.max(o-n,a-i)}return j(f,p,r,n,i,l),p}function I(t,e,r,n,i){var o,a;if(i===ot(t,e,r,n)>0)for(o=e;o<r;o+=n)a=rt(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=rt(o,t[o],t[o+1],a);return a&&Q(a,a.next)&&(nt(a),a=a.next),a}function U(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Q(n,n.next)&&0!==$(n.prev,n,n.next))n=n.next;else{if(nt(n),(n=e=n.prev)===n.next)return null;r=!0}}while(r||n!==e);return e}function j(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=V(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0===s?(i=n,n=n.nextZ,u--):0!==u&&n?r.z<=n.z?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Y(t,n,i,o):N(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),nt(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?j(t=W(t,e,r),e,r,n,i,o,2):2===a&&H(t,e,r,n,i,o):j(U(t),e,r,n,i,o,1);break}}}function N(t){var e=t.prev,r=t,n=t.next;if($(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(G(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&$(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Y(t,e,r,n){var i=t.prev,o=t,a=t.next;if($(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,h=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=V(s,u,e,r,n),f=V(l,h,e,r,n),p=t.nextZ;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&G(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&G(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function W(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Q(i,o)&&K(i,n,n.next,o)&&tt(i,o)&&tt(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),nt(n),nt(n.next),n=t=o),n=n.next}while(n!==t);return n}function H(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&J(a,s)){var u=et(a,s);return a=U(a,a.next),u=U(u,u.next),j(a,e,r,n,i,o),void j(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function q(t,e){return t.x-e.x}function Z(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var u,l=r,h=r.x,c=r.y,f=1/0;for(n=r.next;n!==l;)i>=n.x&&n.x>=h&&G(o<c?i:a,o,h,c,o<c?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<f||u===f&&n.x>r.x)&&tt(n,t)&&(r=n,f=u),n=n.next;return r}(t,e)){var r=et(e,t);U(r,r.next)}}function V(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function X(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function G(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function J(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&K(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&tt(t,e)&&tt(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!==r.next.y>o&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function $(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Q(t,e){return t.x===e.x&&t.y===e.y}function K(t,e,r,n){return!!(Q(t,e)&&Q(r,n)||Q(t,n)&&Q(r,e))||$(t,e,r)>0!==$(t,e,n)>0&&$(r,n,t)>0!==$(r,n,e)>0}function tt(t,e){return $(t.prev,t,t.next)<0?$(t,e,t.next)>=0&&$(t,t.prev,e)>=0:$(t,e,t.prev)<0||$(t,t.next,e)<0}function et(t,e){var r=new it(t.i,t.x,t.y),n=new it(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function rt(t,e,r,n){var i=new it(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function nt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function it(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ot(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}z.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(ot(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*r,h=s<u-1?e[s+1]*r:t.length;a-=Math.abs(ot(t,l,h,r))}var c=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,p=n[s+1]*r,d=n[s+2]*r;c+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},z.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var at=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),st=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join(""),ut={draw:function(t,e,r){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);var n=S(t,at,st);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);var i=t.canvas.width/2,o=t.canvas.height/2;t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer());var a=t.getAttribLocation(n,"a_Position");t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var s=t.getUniformLocation(n,"u_FragColor"),u=O(r.fillStyle||"red");t.uniform4f(s,u[0]/255,u[1]/255,u[2]/255,u[3]/255),t.lineWidth(r.lineWidth||1);for(var l=[],h=[],c=0,f=0,p=e.length;f<p;f++){var d=z.flatten(e[f].geometry._coordinates||e[f].geometry.coordinates),v=d.vertices;c=l.length/2;for(var g=0;g<v.length;g+=2)v[g]=(v[g]-i)/i,v[g+1]=(o-v[g+1])/o;for((l.length+v.length)/2>65536&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),l.length=0,h.length=0,c=0),g=0;g<v.length;g++)l.push(v[g]);var m=z(v,d.holes,d.dimensions);for(g=0;g<m.length;g++)h.push(m[g]+c)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},lt={draw:function(t,e,r){var n=e instanceof f?e.get():e;n.length>0&&("LineString"==n[0].geometry.type?k.draw(t,n,r):"Polygon"==n[0].geometry.type||"MultiPolygon"==n[0].geometry.type?ut.draw(t,n,r):F.draw(t,n,r))}};function ht(t,e,r){if(!t||!e)return null;var n,i,o,a,s,u,l=function(t){return 1-2*t+t*t},h=function(t){return 2*t-2*t*t},c=function(t){return t*t},f=[],p=(r=r||40,0),d=0;if("undefined"!=typeof e){var v=parseFloat(t.lat),g=parseFloat(e.lat),m=parseFloat(t.lng),y=parseFloat(e.lng);for(y>m&&parseFloat(y-m)>180&&m<0&&(m=parseFloat(360+m),y=parseFloat(360+y)),u=0,g==v?(n=0,i=m-y):y==m?(n=Math.PI/2,i=v-g):(n=Math.atan((g-v)/(y-m)),i=(g-v)/Math.sin(n)),0==u&&(u=n+Math.PI/5),s=(o=i/2)*Math.cos(u)+m,a=o*Math.sin(u)+v,p=0;p<r+1;p++){var b=m*l(d)+s*h(d)+y*c(d),x=v*l(d)+a*h(d)+g*c(d),_=t.lng,w=e.lng;f.push([_<0&&w>0?b-360:b,x]),d+=1/r}return f}"undefined"!=typeof f&&(f=[])}var ct={getPoints:function(t,e){e=e||{};for(var r=[],n=0;n<t.length-1;n++){var i=ht(t[n],t[n+1],e.count);i&&i.length>0&&(r=r.concat(i))}return r}};function ft(t){this.splitList=t||{other:1}}function pt(t){this.splitList=t||[{start:0,value:"red"}]}ft.prototype.get=function(t){var e=this.splitList,r=e.other;for(var n in e)if(t==n){r=e[n];break}return r},ft.prototype.generateByDataSet=function(t,e){var r=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=t.get();this.splitList={};for(var i=0,o=0;o<n.length&&(void 0===this.splitList[n[o].count]&&(this.splitList[n[o].count]=r[i],i++),!(i>=r.length-1));o++);this.splitList.other=r[r.length-1]},ft.prototype.getLegend=function(t){var e=this.splitList,r=document.createElement("div");r.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;";var n="";for(var i in e)n+='<div style="line-height: 19px;" value="'+i+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+e[i]+';"></span><span style="margin-left: 3px;">'+i+"<span></div>";return r.innerHTML=n,r},pt.prototype.get=function(t){for(var e=this.splitList,r=!1,n=0;n<e.length;n++)if((void 0===e[n].start||void 0!==e[n].start&&t>=e[n].start)&&(void 0===e[n].end||void 0!==e[n].end&&t<e[n].end)){r=e[n].value;break}return r},pt.prototype.generateByDataSet=function(t){var e=t.getMin("count"),r=t.getMax("count");this.generateByMinMax(e,r)},pt.prototype.generateByMinMax=function(t,e){var r=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=Number((e-t)/7);e=Number(e);var i=Number(t);this.splitList=[];for(var o=0;i<e;)this.splitList.push({start:i,end:i+n,value:r[o]}),o++,i+=n},pt.prototype.getLegend=function(t){this.splitList};var dt=function(){function t(e,r,n){if(s(this,t),!e||!r)return console.warn("id \u548c type \u4e3a\u5fc5\u586b\u9879"),!1;if("baidu"==r){if(!BMap)return console.warn("\u8bf7\u5148\u5f15\u5165\u767e\u5ea6\u5730\u56feJS API"),!1}else console.warn("\u6682\u4e0d\u652f\u6301\u4f60\u7684\u5730\u56fe\u7c7b\u578b");this.type=r;var i=n&&n.center?n.center:[106.962497,38.208726],o=n&&n.zoom?n.zoom:5,a=this.map=new BMap.Map(e,{enableMapClick:!1});a.centerAndZoom(new BMap.Point(i[0],i[1]),o),a.enableScrollWheelZoom(!0),a.setMapStyle({style:"light"})}return u(t,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]),t}();function vt(t){this.options=t||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=t.map,this._lastDrawTime=null,this.show()}var gt="undefined"===typeof window?{}:window,mt=gt.BMap||gt.BMapGL;mt&&(vt.prototype=new mt.Overlay,vt.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize();var r=t.getPanes()[this.paneName];r||(r=t.getPanes().floatShadow),r.appendChild(e);var n=this;return t.addEventListener("resize",(function(){n.adjustSize(),n._draw()})),t.addEventListener("update",(function(){n._draw()})),this.options.updateImmediate&&setTimeout((function(){n._draw()}),100),this.canvas},vt.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,r=this.devicePixelRatio=gt.devicePixelRatio||1;e.width=t.width*r,e.height=t.height*r,"2d"==this.context&&e.getContext(this.context).scale(r,r),e.style.width=t.width+"px",e.style.height=t.height+"px"},vt.prototype.draw=function(){var t=this;this.options.updateImmediate?t._draw():(clearTimeout(t.timeoutID),t.timeoutID=setTimeout((function(){t._draw()}),15))},vt.prototype._draw=function(){var t=this._map,e=t.getSize(),r=t.getCenter();if(r){var n=t.pointToOverlayPixel(r);this.canvas.style.left=n.x-e.width/2+"px",this.canvas.style.top=n.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},vt.prototype.getContainer=function(){return this.canvas},vt.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},vt.prototype.hide=function(){this.canvas.style.display="none"},vt.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},vt.prototype.getZIndex=function(){return this.zIndex});var yt=yt||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)},update:function(e,r){if(0===t.length)return!1;var n=0;for(e=void 0!==e?e:yt.now();n<t.length;)t[n].update(e)||r?n++:t.splice(n,1);return!0}}}();function bt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=360*Math.atan(n/r)/(2*Math.PI);return e[0]<t[0]&&(i+=180),i}"undefined"===typeof window&&"undefined"!==typeof t?yt.now=function(){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?yt.now=window.performance.now.bind(window.performance):void 0!==Date.now?yt.now=Date.now:yt.now=function(){return(new Date).getTime()},yt.Tween=function(t){var e,r=t,n={},i={},o={},a=1e3,s=0,u=!1,l=!1,h=!1,c=0,f=null,p=yt.Easing.Linear.None,d=yt.Interpolation.Linear,v=[],g=null,m=!1,y=null,b=null,x=null;this.to=function(t,e){return i=t,void 0!==e&&(a=e),this},this.start=function(t){for(var e in yt.add(this),l=!0,m=!1,f=void 0!==t?t:yt.now(),f+=c,i){if(i[e]instanceof Array){if(0===i[e].length)continue;i[e]=[r[e]].concat(i[e])}void 0!==r[e]&&(n[e]=r[e],n[e]instanceof Array===!1&&(n[e]*=1),o[e]=n[e]||0)}return this},this.stop=function(){return l?(yt.remove(this),l=!1,null!==x&&x.call(r,r),this.stopChainedTweens(),this):this},this.end=function(){return this.update(f+a),this},this.stopChainedTweens=function(){for(var t=0,e=v.length;t<e;t++)v[t].stop()},this.delay=function(t){return c=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return u=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return v=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){var l,x,_;if(t<f)return!0;for(l in!1===m&&(null!==g&&g.call(r,r),m=!0),_=p(x=(x=(t-f)/a)>1?1:x),i)if(void 0!==n[l]){var w=n[l]||0,M=i[l];M instanceof Array?r[l]=d(M,_):("string"===typeof M&&(M="+"===M.charAt(0)||"-"===M.charAt(0)?w+parseFloat(M):parseFloat(M)),"number"===typeof M&&(r[l]=w+(M-w)*_))}if(null!==y&&y.call(r,_),1===x){if(s>0){for(l in isFinite(s)&&s--,o){if("string"===typeof i[l]&&(o[l]=o[l]+parseFloat(i[l])),u){var E=o[l];o[l]=i[l],i[l]=E}n[l]=o[l]}return u&&(h=!h),f=void 0!==e?t+e:t+c,!0}null!==b&&b.call(r,r);for(var T=0,P=v.length;T<P;T++)v[T].start(f+a);return!1}return!0}},yt.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-yt.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*yt.Easing.Bounce.In(2*t):.5*yt.Easing.Bounce.Out(2*t-1)+.5}}},yt.Interpolation={Linear:function(t,e){var r=t.length-1,n=r*e,i=Math.floor(n),o=yt.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],n):e>1?o(t[r],t[r-1],r-n):o(t[i],t[i+1>r?r:i+1],n-i)},Bezier:function(t,e){for(var r=0,n=t.length-1,i=Math.pow,o=yt.Interpolation.Utils.Bernstein,a=0;a<=n;a++)r+=i(1-e,n-a)*i(e,a)*t[a]*o(n,a);return r},CatmullRom:function(t,e){var r=t.length-1,n=r*e,i=Math.floor(n),o=yt.Interpolation.Utils.CatmullRom;return t[0]===t[r]?(e<0&&(i=Math.floor(n=r*(1+e))),o(t[(i-1+r)%r],t[i],t[(i+1)%r],t[(i+2)%r],n-i)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[r]-(o(t[r],t[r],t[r-1],t[r-1],n-r)-t[r]):o(t[i?i-1:0],t[i],t[r<i+1?r:i+1],t[r<i+2?r:i+2],n-i)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var r=yt.Interpolation.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:function(){var t=[1];return function(e){var r=1;if(t[e])return t[e];for(var n=e;n>1;n--)r*=n;return t[e]=r,r}}(),CatmullRom:function(t,e,r,n,i){var o=.5*(r-t),a=.5*(n-e),s=i*i;return(2*e-2*r+o+a)*(i*s)+(-3*e+3*r-2*o-a)*s+o*i+e}}};var xt={},_t={draw:function(t,e,r){var n="http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png";r.arrow&&r.arrow.url&&(n=r.arrow.url),xt[n]||(xt[n]=null);var i=xt[n];if(!i){var o=Array.prototype.slice.call(arguments),a=new Image;return a.onload=function(){xt[n]=a,_t.draw.apply(null,o)},void(a.src=n)}var s=e instanceof f?e.get():e;for(var u in t.save(),r)t[u]=r[u];for(var l=[],h=null,c=0,p=s.length;c<p;c++){var d=s[c];t.save(),(d.fillStyle||d._fillStyle)&&(t.fillStyle=d.fillStyle||d._fillStyle),(d.strokeStyle||d._strokeStyle)&&(t.strokeStyle=d.strokeStyle||d._strokeStyle);var v=d.geometry.type;if(t.beginPath(),"LineString"===v)for(var g=d.geometry._coordinates||d.geometry.coordinates,m=void 0!==r.arrow.interval?r.arrow.interval:1,y=0;y<g.length;y+=m)if(g[y]&&g[y+1]){var b=g[y];if(h&&wt(b,h)<30)continue;t.save();var x=bt(g[y],g[y+1]);t.translate(b[0],b[1]),t.rotate(x*Math.PI/180),t.drawImage(i,-i.width/2/2,-i.height/2/2,i.width/2,i.height/2),t.restore(),l.push(b),h=b}t.restore()}t.restore()}};function wt(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}var Mt=function(t,e,n){var i=e instanceof f?e.get():e;t.save(),t.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),n.multiPolygonDraw=function(){t.save(),t.clip(),r(t),t.restore()};for(var o=0,a=i.length;o<a;o++)t.beginPath(),d.drawDataSet(t,[i[o]],n),t.save(),t.clip(),r(t),t.restore();t.restore()},Et=function(t,e,r){t.save();for(var n,i,o=e instanceof f?e.get():e,a=0;a<o.length;a++)(u=o[a]).properties&&u.properties.cluster&&(void 0===n&&(n=u.properties.point_count),void 0===i&&(i=u.properties.point_count),n=Math.max(n,u.properties.point_count),i=Math.min(i,u.properties.point_count));var s=new m({min:i,max:n,minSize:r.minSize||8,maxSize:r.maxSize||30,gradient:r.gradient});for(a=0;a<o.length;a++){var u=o[a],l=o[a].geometry._coordinates||o[a].geometry.coordinates;if(t.beginPath(),u.properties&&u.properties.cluster){if(t.arc(l[0],l[1],s.getSize(u.properties.point_count),0,2*Math.PI),t.fillStyle=s.getColor(u.properties.point_count),t.fill(),r.label&&!1!==r.label.show){t.fillStyle=r.label.fillStyle||"white",r.label.font&&(t.font=r.label.font),r.label.shadowColor&&(t.shadowColor=r.label.shadowColor),r.label.shadowBlur&&(t.shadowBlur=r.label.shadowBlur);var h=u.properties.point_count,c=t.measureText(h).width;t.fillText(h,l[0]+.5-c/2,l[1]+.5+3)}}else t.arc(l[0],l[1],r.size||5,0,2*Math.PI),t.fillStyle=r.fillStyle||"red",t.fill()}t.restore()},Tt=function(t,e,r){var n=e instanceof f?e.get():e;for(var i in t.save(),r)t[i]=r[i];var o=[],a=r._size||r.size;a?t.font="bold "+a+"px Arial":a=12;var s=r.textKey||"text";if(r.textAlign||(t.textAlign="center"),r.textBaseline||(t.textBaseline="middle"),r.avoid)for(var u=0,l=n.length;u<l;u++){var h=n[u].offset||r.offset||{x:0,y:0},c=(b=n[u].geometry._coordinates||n[u].geometry.coordinates)[0]+h.x,p=b[1]+h.y,d=n[u][s],v=t.measureText(d).width,g=c-v/2,m=p-a/2,y={sw:{x:g,y:m+a},ne:{x:g+v,y:m}};Pt(o,y)||(o.push(y),g+=v/2,m+=a/2,t.fillText(d,g,m))}else for(u=0,l=n.length;u<l;u++){var b;h=n[u].offset||r.offset||{x:0,y:0},c=(b=n[u].geometry._coordinates||n[u].geometry.coordinates)[0]+h.x,p=b[1]+h.y,d=n[u][s],t.fillText(d,c,p)}t.restore()};function Pt(t,e){for(var r=0;r<t.length;r++)if(At(t[r],e))return!0;return!1}function At(t,e){var r=Math.min(t.ne.x,e.ne.x),n=Math.min(t.sw.y,e.sw.y),i=Math.max(t.sw.x,e.sw.x),o=Math.max(t.ne.y,e.ne.y);return r>i&&n>o}var St=function(t,e,r){var n=e instanceof f?e.get():e;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var i=r.offset||{x:0,y:0},o=0,a=n.length;o<a;o++)if(n[o].geometry){var s=n[o].deg||r.deg,u=n[o].icon||r.icon,l=n[o].geometry._coordinates||n[o].geometry.coordinates,h=l[0],c=l[1];s&&(t.save(),t.translate(h,c),t.rotate(s*Math.PI/180),t.translate(-h,-c));var p=r._width||r.width||u.width,d=r._height||r.height||u.height;h=h-p/2+i.x,c=c-d/2+i.y,r.sx&&r.sy&&r.swidth&&r.sheight&&r.width&&r.height?t.drawImage(u,r.sx,r.sy,r.swidth,r.sheight,h,c,p,d):r.width&&r.height?t.drawImage(u,h,c,p,d):t.drawImage(u,h,c),s&&t.restore()}};function Lt(t,e,r,n,i,o){if(!(i-n<=r)){var a=n+i>>1;!function t(e,r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(s-h)/s)*(u-s/2<0?-1:1),f=Math.max(i,Math.floor(n-u*h/s+c)),p=Math.min(o,Math.floor(n+(s-u)*h/s+c));t(e,r,n,f,p,a)}var d=r[2*n+a],v=i,g=o;for(Ot(e,r,i,n),r[2*o+a]>d&&Ot(e,r,i,o);v<g;){for(Ot(e,r,v,g),v++,g--;r[2*v+a]<d;)v++;for(;r[2*g+a]>d;)g--}r[2*i+a]===d?Ot(e,r,i,g):(g++,Ot(e,r,g,o)),g<=n&&(i=g+1),n<=g&&(o=g-1)}}(t,e,a,n,i,o%2),Lt(t,e,r,n,a-1,o+1),Lt(t,e,r,a+1,i,o+1)}}function Ot(t,e,r,n){Rt(t,r,n),Rt(e,2*r,2*n),Rt(e,2*r+1,2*n+1)}function Rt(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Ct(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}var kt=function(t){return t[0]},Bt=function(t){return t[1]},Dt=function(t,e,r,n,i){void 0===e&&(e=kt),void 0===r&&(r=Bt),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=r(t[u]);Lt(a,s,n,0,a.length-1,0)};Dt.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,o,a){for(var s,u,l=[0,t.length-1,0],h=[];l.length;){var c=l.pop(),f=l.pop(),p=l.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=e[2*d],u=e[2*d+1],s>=r&&s<=i&&u>=n&&u<=o&&h.push(t[d]);else{var v=Math.floor((p+f)/2);s=e[2*v],u=e[2*v+1],s>=r&&s<=i&&u>=n&&u<=o&&h.push(t[v]);var g=(c+1)%2;(0===c?r<=s:n<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===c?i>=s:o>=u)&&(l.push(v+1),l.push(f),l.push(g))}}return h}(this.ids,this.coords,t,e,r,n,this.nodeSize)},Dt.prototype.within=function(t,e,r){return function(t,e,r,n,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(var f=c;f<=h;f++)Ct(e[2*f],e[2*f+1],r,n)<=u&&s.push(t[f]);else{var p=Math.floor((c+h)/2),d=e[2*p],v=e[2*p+1];Ct(d,v,r,n)<=u&&s.push(t[p]);var g=(l+1)%2;(0===l?r-i<=d:n-i<=v)&&(a.push(c),a.push(p-1),a.push(g)),(0===l?r+i>=d:n+i>=v)&&(a.push(p+1),a.push(h),a.push(g))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var Ft={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},zt=function(t){this.options=qt(Object.create(Ft),t),this.trees=new Array(this.options.maxZoom+1)};function It(t,e,r,n,i){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function Ut(t,e){var r=t.geometry.coordinates,n=r[0],i=r[1];return{x:Yt(n),y:Wt(i),zoom:1/0,index:e,parentId:-1}}function jt(t){return{type:"Feature",id:t.id,properties:Nt(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),Ht(t.y)]}};var e}function Nt(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return qt(qt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function Yt(t){return t/360+.5}function Wt(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function Ht(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function qt(t,e){for(var r in e)t[r]=e[r];return t}function Zt(t){return t.x}function Vt(t){return t.y}zt.prototype.load=function(t){var e=this.options,r=(e.log,e.minZoom),n=e.maxZoom,i=e.nodeSize;t.length,this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(Ut(t[a],a));this.trees[n+1]=new Dt(o,Zt,Vt,i,Float32Array);for(var s=n;s>=r;s--)Date.now(),o=this._cluster(o,s),this.trees[s]=new Dt(o,Zt,Vt,i,Float32Array);return this},zt.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],h=0,c=u.range(Yt(r),Wt(o),Yt(i),Wt(n));h<c.length;h+=1){var f=c[h],p=u.points[f];l.push(p.numPoints?jt(p):this.points[p.index])}return l},zt.prototype.getChildren=function(t){var e=t>>5,r=t%32,n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var h=l[u],c=i.points[h];c.parentId===t&&s.push(c.numPoints?jt(c):this.points[c.index])}if(0===s.length)throw new Error(n);return s},zt.prototype.getLeaves=function(t,e,r){e=e||10,r=r||0;var n=[];return this._appendLeaves(n,t,e,r,0),n},zt.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(r-s)/i,l=(r+1+s)/i,h={features:[]};return this._addTileFeatures(n.range((e-s)/i,u,(e+1+s)/i,l),n.points,e,r,i,h),0===e&&this._addTileFeatures(n.range(1-s/i,u,1,l),n.points,i,r,i,h),e===i-1&&this._addTileFeatures(n.range(0,u,s/i,l),n.points,-1,r,i,h),h.features.length?h:null},zt.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},zt.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=n?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},zt.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-r)),Math.round(this.options.extent*(u.y*i-n))]],tags:u.numPoints?Nt(u):this.points[u.index].properties},h=u.numPoints?u.id:this.points[u.index].id;void 0!==h&&(l.id=h),o.features.push(l)}},zt.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},zt.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.radius,o=n.extent,a=n.reduce,s=i/(o*Math.pow(2,e)),u=0;u<t.length;u++){var l=t[u];if(!(l.zoom<=e)){l.zoom=e;for(var h=this.trees[e+1],c=h.within(l.x,l.y,s),f=l.numPoints||1,p=l.x*f,d=l.y*f,v=a&&f>1?this._map(l,!0):null,g=(u<<5)+(e+1),m=0,y=c;m<y.length;m+=1){var b=y[m],x=h.points[b];if(!(x.zoom<=e)){x.zoom=e;var _=x.numPoints||1;p+=x.x*_,d+=x.y*_,f+=_,x.parentId=g,a&&(v||(v=this._map(l,!0)),a(v,this._map(x)))}}1===f?r.push(l):(l.parentId=g,r.push(It(p/f,d/f,g,f,v)))}}return r},zt.prototype._map=function(t,e){if(t.numPoints)return e?qt({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?qt({},n):n},"undefined"!==typeof window&&requestAnimationFrame((function t(e){requestAnimationFrame(t),yt.update(e)}));var Xt=function(){function t(e,r,n){s(this,t),r instanceof f||(r=new f(r)),this.dataSet=r,this.map=e,"cluster"!==n.draw||this.supercluster||(this.supercluster=new zt({maxZoom:n.maxZoom||19,radius:n.clusterRadius||100}),this.supercluster.load(r.get()),this.clusterDataSet=new f)}return u(t,[{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){if(this.intensity=new m({maxSize:this.options.maxSize,minSize:this.options.minSize,gradient:this.options.gradient,max:this.options.max||this.dataSet.getMax("count")}),this.category=new ft(this.options.splitList),this.choropleth=new pt(this.options.splitList),void 0===this.options.splitList&&this.category.generateByDataSet(this.dataSet,this.options.color),void 0===this.options.splitList){var e=this.options.min||this.dataSet.getMin("count"),r=this.options.max||this.dataSet.getMax("count");this.choropleth.generateByMinMax(e,r)}}},{key:"getLegend",value:function(t){return this.options.draw,"intensity"==this.options.draw||"heatmap"==this.options.draw?this.intensity.getLegend(t):"category"==this.options.draw?this.category.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this.options.draw;if("bubble"==e||"intensity"==e||"category"==e||"choropleth"==e||"simple"==e)for(var r=0;r<t.length;r++){var n=t[r];"bubble"==this.options.draw?t[r]._size=this.intensity.getSize(n.count):t[r]._size=void 0;var i="_fillStyle";"LineString"!==t[r].geometry.type&&"stroke"!==this.options.styleType||(i="_strokeStyle"),"intensity"==this.options.draw?t[r][i]=this.intensity.getColor(n.count):"category"==this.options.draw?t[r][i]=this.category.get(n.count):"choropleth"==this.options.draw&&(t[r][i]=this.choropleth.get(n.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation;return t&&!(!1===t.enabled)}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,r,n){switch(this.options.draw){case"heatmap":w.draw(t,e,this.options);break;case"grid":case"cluster":case"honeycomb":this.options.offset={x:n.x,y:n.y},"grid"===this.options.draw?M.draw(t,e,this.options):"cluster"===this.options.draw?Et(t,e,this.options):T.draw(t,e,this.options);break;case"text":Tt(t,e,this.options);break;case"icon":St(t,e,this.options);break;case"clip":Mt(t,e,this.options);break;default:"webgl"==this.options.context?lt.draw(this.canvasLayer.canvas.getContext("webgl"),e,this.options):v.draw(t,e,this.options)}this.options.arrow&&!1!==this.options.arrow.show&&_t.draw(t,e,this.options)}},{key:"isPointInPath",value:function(t,e){var r;t=this.canvasLayer.canvas.getContext(this.context),r="cluster"===this.options.draw?this.clusterDataSet.get():this.dataSet.get();for(var n=0;n<r.length;n++){t.beginPath();var i=this.options,o=e.x*this.canvasLayer.devicePixelRatio,a=e.y*this.canvasLayer.devicePixelRatio;if(i.multiPolygonDraw=function(){if(t.isPointInPath(o,a))return r[n]},d.draw(t,r[n],i),(r[n].geometry&&r[n].geometry.type).indexOf("LineString")>-1){if(t.isPointInStroke&&t.isPointInStroke(o,a))return r[n]}else if(t.isPointInPath(o,a))return r[n]}}},{key:"clickEvent",value:function(t,e){if(this.options.methods){var r=this.isPointInPath(this.getContext(),t);r?this.options.methods.click(r,e):this.options.methods.click(null,e)}}},{key:"mousemoveEvent",value:function(t,e){if(this.options.methods){var r=this.isPointInPath(this.getContext(),t);r?this.options.methods.mousemove(r,e):this.options.methods.mousemove(null,e)}}},{key:"tapEvent",value:function(t,e){if(this.options.methods){var r=this.isPointInPath(this.getContext(),t);r?this.options.methods.tap(r,e):this.options.methods.tap(null,e)}}},{key:"update",value:function(t,e){var r=t.options,n=this.options;for(var i in r)n[i]=r[i];this.init(n),!1!==e&&this.draw()}},{key:"setOptions",value:function(t){this.dataSet.reset(),this.init(t),this.draw()}},{key:"set",value:function(t){var e=this.getContext(),r=this.getDefaultContextConfig();for(var n in r)e[n]=r[n];this.init(t.options),this.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t=this,e=t.options.animation;if("time"==t.options.draw||t.isEnabledTime()){e.stepsRange||(e.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:e.stepsRange.start},t.animator=new yt.Tween(this.steps).onUpdate((function(){t._canvasUpdate(this.step)})).repeat(1/0),this.addAnimatorEvent();var r=1e3*e.duration||5e3;t.animator.to({step:e.stepsRange.end},r),t.animator.start()}else t.animator&&t.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),t}(),Gt="undefined"===typeof window?{}:window,Jt=Gt.BMap||Gt.BMapGL,$t=function(t){function e(t,r,n){s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n));i.map=t,i.options=n||{},i.dataSet=r;var o=new vt({map:t,zIndex:i.options.zIndex,update:i._canvasUpdate.bind(i)});i.init(i.options),i.canvasLayer=o,i.transferToMercator();var a=i;return r.on("change",(function(){a.transferToMercator(),o.draw()})),i.ctx=o.canvas.getContext("2d"),i.start(),i}return h(e,t),u(e,[{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.options.max&&this.intensity.setMax(this.options.max),this.options.min&&this.intensity.setMin(this.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var t,e=this.map,r=e.getMapType();if(t=r.getProjection?r.getProjection():{lngLatToPoint:function(t){var r=e.lnglatToMercator(t.lng,t.lat);return{x:r[0],y:r[1]}}},"bd09mc"!==this.options.coordType){var n=this.dataSet.get();n=this.dataSet.transferCoordinate(n,(function(e){var r=t.lngLatToPoint({lng:e[0],lat:e[1]});return[r.x,r.y]}),"coordinates","coordinates_mercator"),this.dataSet._set(n)}}},{key:"_canvasUpdate",value:function(){var t=this.ctx;if(t){var e,n,i,o=this.map;o.getMapType().getProjection?n=(e=o.getMapType().getProjection()).lngLatToPoint(o.getCenter()):((n={x:o.getCenter().lng,y:o.getCenter().lat}).x>-180&&n.x<180&&(n={x:(n=o.lnglatToMercator(n.x,n.y))[0],y:n[1]}),e={lngLatToPoint:function(t){var e=o.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}}),i=e.getZoomUnits?e.getZoomUnits(o.getZoom()):Math.pow(2,18-o.getZoom());var a=new Jt.Pixel(n.x-o.getSize().width/2*i,n.y+o.getSize().height/2*i);r(t);var s={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){if(t)return[(t[0]-a.x)/i,(a.y-t[1])/i]}};this.data=this.dataSet.get(s),this.processData(this.data),this.drawAnimation()}}},{key:"drawAnimation",value:function(){var t=this.ctx,e=this.data;if(e){t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),t.save(),this.options.shadowColor&&(t.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(t.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(t.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(t.globalCompositeOperation=this.options.globalCompositeOperation);for(var r=this.options,n=0;n<e.length;n++)if("Point"===e[n].geometry.type){t.beginPath();var i=e[n].size||this.options.size,o=e[n].minSize||this.options.minSize||0;void 0===e[n]._size&&(e[n]._size=o),t.arc(e[n].geometry._coordinates[0],e[n].geometry._coordinates[1],e[n]._size,0,2*Math.PI,!0),t.closePath(),e[n]._size++,e[n]._size>i&&(e[n]._size=o),t.lineWidth=1,t.strokeStyle=e[n].strokeStyle||e[n]._strokeStyle||r.strokeStyle||"yellow",t.stroke(),(l=e[n].fillStyle||e[n]._fillStyle||r.fillStyle)&&(t.fillStyle=l,t.fill())}else if("LineString"===e[n].geometry.type){t.beginPath();var a=e[n].size||this.options.size||5;o=e[n].minSize||this.options.minSize||0,void 0===e[n]._index&&(e[n]._index=0);var s=e[n]._index;t.arc(e[n].geometry._coordinates[s][0],e[n].geometry._coordinates[s][1],a,0,2*Math.PI,!0),t.closePath(),e[n]._index++,e[n]._index>=e[n].geometry._coordinates.length&&(e[n]._index=0);var u=e[n].strokeStyle||r.strokeStyle,l=e[n].fillStyle||r.fillStyle||"yellow";t.fillStyle=l,t.fill(),u&&r.lineWidth&&(t.lineWidth=r.lineWidth||1,t.strokeStyle=u,t.stroke())}t.restore()}}},{key:"animate",value:function(){this.drawAnimation();var t=this.options.animateTime||100;this.timeout=setTimeout(this.animate.bind(this),t)}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}},{key:"unbindEvent",value:function(){}},{key:"hide",value:function(){this.canvasLayer.hide(),this.stop()}},{key:"show",value:function(){this.start()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.stop(),this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(Xt),Qt="undefined"===typeof window?{}:window,Kt=Qt.BMap||Qt.BMapGL,te=function(t){function e(t,r,n){s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n)),o=i;n=n||{},i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.tapEvent=i.tapEvent.bind(i),o.init(n),o.argCheck(n),o.transferToMercator();var a=i.canvasLayer=new vt({map:t,context:i.context,updateImmediate:n.updateImmediate,paneName:n.paneName,mixBlendMode:n.mixBlendMode,enableMassClear:n.enableMassClear,zIndex:n.zIndex,update:function(){o._canvasUpdate()}});return r.on("change",(function(){o.transferToMercator(),a.draw()})),i}return h(e,t),u(e,[{key:"clickEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,r,t)}},{key:"mousemoveEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,r,t)}},{key:"tapEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tapEvent",this).call(this,r,t)}},{key:"bindEvent",value:function(t){this.unbindEvent();var e=this.map,r=0,n=this;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addEventListener("mousemove",this.mousemoveEvent),"ontouchend"in window.document&&this.options.methods.tap&&(e.addEventListener("touchstart",(function(t){r=new Date})),e.addEventListener("touchend",(function(t){new Date-r<300&&n.tapEvent(t)}))))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(t){t||(t=this.dataSet);var e,r=this.map,n=r.getMapType();if(e=n.getProjection?n.getProjection():{lngLatToPoint:function(t){var e=r.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}},"bd09mc"!==this.options.coordType){var i=t.get();i=t.transferCoordinate(i,(function(t){if(t[0]<-180||t[0]>180||t[1]<-90||t[1]>90)return t;var r=e.lngLatToPoint({lng:t[0],lat:t[1]});return[r.x,r.y]}),"coordinates","coordinates_mercator"),t._set(i)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e,n,i,o=this.options.animation,a=this.canvasLayer._map;a.getMapType().getProjection?n=(e=a.getMapType().getProjection()).lngLatToPoint(a.getCenter()):((n={x:a.getCenter().lng,y:a.getCenter().lat}).x>-180&&n.x<180&&(n={x:(n=a.lnglatToMercator(n.x,n.y))[0],y:n[1]}),e={lngLatToPoint:function(t){var e=a.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}}),i=e.getZoomUnits?e.getZoomUnits(a.getZoom()):Math.pow(2,18-a.getZoom());var s=new Kt.Pixel(n.x-a.getSize().width/2*i,n.y+a.getSize().height/2*i),u=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void r(u);"2d"==this.context&&(u.save(),u.globalCompositeOperation="destination-out",u.fillStyle="rgba(0, 0, 0, .1)",u.fillRect(0,0,u.canvas.width,u.canvas.height),u.restore())}else r(u);if("2d"==this.context)for(var l in this.options)u[l]=this.options[l];else u.clear(u.COLOR_BUFFER_BIT);if(!(this.options.minZoom&&a.getZoom()<this.options.minZoom||this.options.maxZoom&&a.getZoom()>this.options.maxZoom)){var h=1;"2d"!=this.context&&(h=this.canvasLayer.devicePixelRatio);var c,f={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){return[(t[0]-s.x)/i*h,(s.y-t[1])/i*h]}};if(void 0!==t&&(f.filter=function(e){var r=o.trails||10;return!!(t&&e.time>t-r&&e.time<t)}),"cluster"===this.options.draw){var p=this.map.getBounds(),d=p.getNorthEast(),v=p.getSouthWest(),g=this.supercluster.getClusters([v.lng,v.lat,d.lng,d.lat],this.getZoom());this.clusterDataSet.set(g),this.transferToMercator(this.clusterDataSet),c=this.clusterDataSet.get(f)}else c=this.dataSet.get(f);this.processData(c);var m=a.pointToPixel(new Kt.Point(0,0));"m"==this.options.unit?(this.options.size&&(this.options._size=this.options.size/i),this.options.width&&(this.options._width=this.options.width/i),this.options.height&&(this.options._height=this.options.height/i)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(u,c,this.options,m),this.options.updateCallback&&this.options.updateCallback(t)}}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.options.max&&this.intensity.setMax(this.options.max),this.options.min&&this.intensity.setMin(this.options.min),this.initAnimator(),this.bindEvent()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer&&this.canvasLayer.draw()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(Xt);function ee(t){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=ee.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var e=document.createElement("canvas");function r(t,e){return function(){e.apply(t)}}e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",this.canvas=e,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=r(this,this.repositionCanvas_),this.resizeFunction_=r(this,this.resize_),this.requestUpdateFunction_=r(this,this.update_),t&&this.setOptions(t)}var re="undefined"===typeof window?{}:window;re.google&&re.google.maps&&(ee.prototype=new google.maps.OverlayView,ee.DEFAULT_PANE_NAME_="overlayLayer",ee.CSS_TRANSFORM_=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],r=0;r<e.length;r++){var n=e[r];if(void 0!==t.style[n])return n}return e[0]}(),ee.prototype.requestAnimFrame_=re.requestAnimationFrame||re.webkitRequestAnimationFrame||re.mozRequestAnimationFrame||re.oRequestAnimationFrame||re.msRequestAnimationFrame||function(t){return re.setTimeout(t,1e3/60)},ee.prototype.cancelAnimFrame_=re.cancelAnimationFrame||re.webkitCancelAnimationFrame||re.mozCancelAnimationFrame||re.oCancelAnimationFrame||re.msCancelAnimationFrame||function(t){},ee.prototype.setOptions=function(t){void 0!==t.animate&&this.setAnimate(t.animate),void 0!==t.paneName&&this.setPaneName(t.paneName),void 0!==t.updateHandler&&this.setUpdateHandler(t.updateHandler),void 0!==t.resizeHandler&&this.setResizeHandler(t.resizeHandler),void 0!==t.resolutionScale&&this.setResolutionScale(t.resolutionScale),void 0!==t.map&&this.setMap(t.map)},ee.prototype.setAnimate=function(t){this.isAnimated_=!!t,this.isAnimated_&&this.scheduleUpdate()},ee.prototype.isAnimated=function(){return this.isAnimated_},ee.prototype.setPaneName=function(t){this.paneName_=t,this.setPane_()},ee.prototype.getPaneName=function(){return this.paneName_},ee.prototype.setPane_=function(){if(this.isAdded_){var t=this.getPanes();if(!t[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');t[this.paneName_].appendChild(this.canvas)}},ee.prototype.setResizeHandler=function(t){this.resizeHandler_=t},ee.prototype.setResolutionScale=function(t){"number"===typeof t&&(this.resolutionScale_=t,this.resize_())},ee.prototype.setUpdateHandler=function(t){this.updateHandler_=t},ee.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},ee.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(re,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},ee.prototype.resize_=function(){if(this.isAdded_){var t=this.getMap(),e=t.getDiv().offsetWidth,r=t.getDiv().offsetHeight,n=e*this.resolutionScale_,i=r*this.resolutionScale_,o=this.canvas.width,a=this.canvas.height;o===n&&a===i||(this.canvas.width=n,this.canvas.height=i,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===e&&this.canvasCssHeight_===r||(this.canvasCssWidth_=e,this.canvasCssHeight_=r,this.canvas.style.width=e+"px",this.canvas.style.height=r+"px")}},ee.prototype.draw=function(){this.repositionCanvas_()},ee.prototype.repositionCanvas_=function(){var t=this.getMap(),e=t.getBounds().getNorthEast().lat(),r=t.getCenter(),n=Math.pow(2,t.getZoom()),i=r.lng()-180*this.canvasCssWidth_/(256*n);this.topLeft_=new google.maps.LatLng(e,i);var o=this.getProjection().fromLatLngToDivPixel(r),a=-Math.round(this.canvasCssWidth_/2-o.x),s=-Math.round(this.canvasCssHeight_/2-o.y);this.canvas.style[ee.CSS_TRANSFORM_]="translate("+a+"px,"+s+"px)",this.scheduleUpdate()},ee.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},ee.prototype.getTopLeft=function(){return this.topLeft_},ee.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(re,this.requestUpdateFunction_))});var ne=function(t){function e(t,r,n){s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n)),o=i;n=n||{},o.init(n),o.argCheck(n);var a={map:t,animate:!1,updateHandler:function(){o._canvasUpdate()},resolutionScale:resolutionScale};return i.canvasLayer=new ee(a),i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return h(e,t),u(e,[{key:"clickEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,r,t)}},{key:"mousemoveEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,r,t)}},{key:"bindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeListener("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this.options.animation,n=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void r(n);"2d"==this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else r(n);if("2d"==this.context)for(var i in this.options)n[i]=this.options[i];else n.clear(n.COLOR_BUFFER_BIT);if(!(this.options.minZoom&&a.getZoom()<this.options.minZoom||this.options.maxZoom&&a.getZoom()>this.options.maxZoom)){var o=1;"2d"!=this.context&&(o=this.canvasLayer.devicePixelRatio);var a=this.map,s=a.getProjection(),u=(o=Math.pow(2,a.zoom)*resolutionScale,s.fromLatLngToPoint(this.canvasLayer.getTopLeft())),l={transferCoordinate:function(t){var e=new google.maps.LatLng(t[1],t[0]),r=s.fromLatLngToPoint(e),n={x:(r.x-u.x)*o,y:(r.y-u.y)*o};return[n.x,n.y]}};void 0!==t&&(l.filter=function(r){var n=e.trails||10;return!!(t&&r.time>t-n&&r.time<t)});var h=this.dataSet.get(l);this.processData(h);var c=new google.maps.LatLng(0,0),p=s.fromLatLngToPoint(c),d={x:(p.x-u.x)*o,y:(p.y-u.y)*o};"m"==this.options.unit&&this.options.size?this.options._size=this.options.size/zoomUnit:this.options._size=this.options.size,this.drawContext(n,new f(h),this.options,d),this.options.updateCallback&&this.options.updateCallback(t)}}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),e}(Xt),ie=void 0;if("undefined"!==typeof maptalks){ie=function(t){function e(t,r,n){s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return i.options_=n,i.dataSet=r,i._initBaseLayer(n),i}return h(e,t),u(e,[{key:"_initBaseLayer",value:function(t){var e=this.baseLayer=new Xt(null,this.dataSet,t);this.init(t),e.argCheck(t)}},{key:"clickEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.clickEvent(e,t.domEvent)}}},{key:"mousemoveEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.mousemoveEvent(e,t.domEvent)}}},{key:"getEvents",value:function(){return{click:this.clickEvent,mousemove:this.mousemoveEvent}}},{key:"init",value:function(t){var e=this.baseLayer;e.options=t,e.initDataRange(t),e.context=e.options.context||"2d",e.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}}]),e}(maptalks.Layer);var oe=function(t){function e(){return s(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"needToRedraw",value:function(){return!!this.layer.baseLayer.isEnabledTime()||l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"needToRedraw",this).call(this)}},{key:"draw",value:function(){var t=this.layer.baseLayer;this.canvas&&t.isEnabledTime()&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this._update(this.gl||this.context,this._mapvFrameTime),delete this._mapvFrameTime,this.completeRender()}},{key:"drawOnInteracting",value:function(){this.draw(),this._shouldClear=!1}},{key:"onSkipDrawOnInteracting",value:function(){this._shouldClear=!0}},{key:"_canvasUpdate",value:function(t){this.setToRedraw(),this._mapvFrameTime=t}},{key:"_update",value:function(t,e){if(this.canvas){var n=this.layer.baseLayer,i=n.options.animation,o=this.getMap();if(n.isEnabledTime()){if(void 0===e)return void r(t);"2d"==n.context&&(t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore())}else r(t);if("2d"==n.context)for(var a in n.options)t[a]=n.options[a];else t.clear(t.COLOR_BUFFER_BIT);var s=1;"2d"===n.context&&"heatmap"!==n.options.draw&&(s=n.canvasLayer.devicePixelRatio);var u=new maptalks.Coordinate(0,0),l={fromColumn:"bd09mc"===n.options.coordType?"coordinates_mercator":"coordinates",transferCoordinate:function(t){return u.x=t[0],u.y=t[1],o.coordToContainerPoint(u)._multi(s).toArray()}};void 0!==e&&(l.filter=function(t){var r=i.trails||10;return!!(e&&t.time>e-r&&t.time<e)});var h=n.dataSet.get(l);n.processData(h),"m"==n.options.unit?(n.options.size&&(n.options._size=n.options.size/zoomUnit),n.options.width&&(n.options._width=n.options.width/zoomUnit),n.options.height&&(n.options._height=n.options.height/zoomUnit)):(n.options._size=n.options.size,n.options._height=n.options.height,n.options._width=n.options.width);var c=new maptalks.Point(0,0),f=o._pointToContainerPoint(c)._multi(s);n.drawContext(t,h,n.options,f),n.options.updateCallback&&n.options.updateCallback(e)}}},{key:"createCanvas",value:function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),r=maptalks.Browser.retina?2:1,n=r*e.width,i=r*e.height;this.canvas=maptalks.Canvas.createCanvas(n,i,t.CanvasClass),"2d"===this.layer.baseLayer.context?(this.context=this.canvas.getContext("2d"),this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation)):this.gl=this.canvas.getContext("webgl",{alpha:!0,preserveDrawingBuffer:!0,antialias:!1}),this.onCanvasCreate(),this._bindToMapv(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})}}},{key:"_bindToMapv",value:function(){var t=this.layer.baseLayer;this.devicePixelRatio=maptalks.Browser.retina?2:1,t.canvasLayer=this,t._canvasUpdate=this._canvasUpdate.bind(this),t.getContext=function(){var t=self.getRenderer();return t.gl||t.context}}}]),e}(maptalks.renderer.CanvasRenderer);ie.registerRenderer("canvas",oe)}var ae,se=ie,ue=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments[1],n=arguments[2];s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n));return i.options=n,i.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},i.layer_=null,i.initDataRange(n),i.initAnimator(),i.onEvents(),t.on("complete",(function(){this.init(t,n),this.argCheck(n)}),i),i}return h(e,t),u(e,[{key:"init",value:function(t,e){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){if(t){var n=this.map,i=t.getContext(this.context),o=this.options.animation;if(this.isEnabledTime()){if(void 0===e)return r(i),this;"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else r(i);if("2d"===this.context)for(var a in this.options)i[a]=this.options[a];else i.clear(i.COLOR_BUFFER_BIT);var s={transferCoordinate:function(t){var e=n.lngLatToContainer(new AMap.LngLat(t[0],t[1]));return[e.x,e.y]}};void 0!==e&&(s.filter=function(t){var r=o.trails||10;return!!(e&&t.time>e-r&&t.time<e)});var u=this.dataSet.get(s);return this.processData(u),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(i,new f(u),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.canvasFunction(),e=this.map.getBounds();this.layer_=new AMap.CanvasLayer({canvas:t,bounds:this.options.bounds||e,zooms:this.options.zooms||[0,22]}),this.layer_.setMap(this.map),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this)}}},{key:"canvasFunction",value:function(){var t=[this.map.getSize().width,this.map.getSize().height],e=t[0],r=t[1];if(this.canvasLayer.canvas){this.canvasLayer.canvas.width=e,this.canvasLayer.canvas.height=r;var n=this.map.getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||n)}else this.canvasLayer.canvas=function(t,e,r){if("undefined"!==typeof document){var n=document.createElement("canvas");return n.width=t,n.height=e,n}return new r(t,e)}(e,r);return this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"removeLayer",value:function(){this.map&&(this.unEvents(),this.map.removeLayer(this.layer_),delete this.map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,r,t)}},{key:"mousemoveEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,r,t)}},{key:"addAnimatorEvent",value:function(){this.map.on("movestart",this.animatorMovestartEvent,this),this.map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent,this),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent,this))}}]),e}(Xt),le=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments[1],n=arguments[2];s(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n));return i.options=n,i.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},i.layer_=null,i.previousCursor_=void 0,i.init(t,n),i.argCheck(n),i}return h(e,t),u(e,[{key:"init",value:function(t,e){if(!(t&&t instanceof ol.Map))throw new Error("not map object");this.$Map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.initDataRange(e),this.initAnimator(),this.onEvents()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){var n=this.$Map,i=t.getContext(this.context),o=this.options.animation,a=this.options.hasOwnProperty("projection")?this.options.projection:"EPSG:4326";if(this.isEnabledTime()){if(void 0===e)return r(i),this;"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else r(i);if("2d"===this.context)for(var s in this.options)i[s]=this.options[s];else i.clear(i.COLOR_BUFFER_BIT);var u={transferCoordinate:function(t){return n.getPixelFromCoordinate(ol.proj.transform(t,a,"EPSG:4326"))}};void 0!==e&&(u.filter=function(t){var r=o.trails||10;return!!(e&&t.time>e-r&&t.time<e)});var l=this.dataSet.get(u);return this.processData(l),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(i,new f(l),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.getMapExtent();this.layer_=new ol.layer.Image({layerName:this.options.layerName,minResolution:this.options.minResolution,maxResolution:this.options.maxResolution,zIndex:this.options.zIndex,extent:t,source:new ol.source.ImageCanvas({canvasFunction:this.canvasFunction.bind(this),projection:this.options.hasOwnProperty("projection")?this.options.projection:"EPSG:4326",ratio:this.options.hasOwnProperty("ratio")?this.options.ratio:1})}),this.$Map.addLayer(this.layer_),this.$Map.un("precompose",this.reRender,this),this.$Map.on("precompose",this.reRender,this)}}},{key:"reRender",value:function(){if(this.layer_){var t=this.getMapExtent();this.layer_.setExtent(t)}}},{key:"canvasFunction",value:function(t,e,r,n,i){return this.canvasLayer.canvas?(this.canvasLayer.canvas.width=n[0],this.canvasLayer.canvas.height=n[1]):this.canvasLayer.canvas=function(t,e){if("undefined"!==typeof document){var r=document.createElement("canvas");return r.width=t,r.height=e,r}}(n[0],n[1]),this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"getMapExtent",value:function(){var t=this.$Map.getSize();return this.$Map.getView().calculateExtent(t)}},{key:"addTo",value:function(t){this.init(t,this.options)}},{key:"removeLayer",value:function(){this.$Map&&(this.unEvents(),this.$Map.un("precompose",this.reRender,this),this.$Map.removeLayer(this.layer_),delete this.$Map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,{x:r[0],y:r[1]},t)}},{key:"mousemoveEvent",value:function(t){var r=t.pixel;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,{x:r[0],y:r[1]},t)}},{key:"addAnimatorEvent",value:function(){this.$Map.on("movestart",this.animatorMovestartEvent,this),this.$Map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.$Map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("pointermove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.$Map;this.options.methods&&(this.options.methods.click&&t.un("click",this.clickEvent,this),this.options.methods.pointermove&&t.un("pointermove",this.mousemoveEvent,this))}},{key:"setDefaultCursor",value:function(t,e){if(this.$Map){var r=this.$Map.getTargetElement();e?r.style.cursor!==t&&(this.previousCursor_=r.style.cursor,r.style.cursor=t):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}}}]),e}(Xt),he=function(t){function e(t,r,n,i){s(this,e);var o=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));if(!Xt)return c(o);var a=o;return i=i||{},a.init(i),a.argCheck(i),o.canvasLayer=r,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o._moveStartEvent=o.moveStartEvent.bind(o),o._moveEndEvent=o.moveEndEvent.bind(o),o._zoomStartEvent=o.zoomStartEvent.bind(o),o.bindEvent(),o}return h(e,t),u(e,[{key:"clickEvent",value:function(t){var r=this.map.containerPointToLayerPoint([0,0]),n=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio,i=t.layerPoint;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,L.point((i.x-r.x)/n,(i.y-r.y)/n),t)}},{key:"mousemoveEvent",value:function(t){var r=t.layerPoint;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,r,t)}},{key:"bindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent)),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent)),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}},{key:"getContext",value:function(){return this.canvasLayer.getCanvas().getContext(this.context)}},{key:"addData",value:function(t,e){var r=t;t&&t.get&&(r=t.get()),this.dataSet.add(r),this.update({options:e})}},{key:"update",value:function(t){var r=t||{},n=r.data;n&&n.get&&(n=n.get()),void 0!=n&&this.dataSet.set(n),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:r.options})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!==typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,r=e.options.animation,n=this.getContext(),i=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(var o in e.options)n[o]=e.options[o];else n.clear(n.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&i.getZoom()<e.options.minZoom||e.options.maxZoom&&i.getZoom()>e.options.maxZoom)){var a=i.getBounds(),s=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth(),l=i.getSize(),h=s/l.x,c=u/l.y,f=this.canvasLayer.getTopLeft(),p=i.latLngToContainerPoint(f),d={transferCoordinate:function(t){var r,n={x:(r="2d"===e.context?i.latLngToContainerPoint(L.latLng(t[1],t[0])):{x:(t[0]-f.lng)/h,y:(f.lat-t[1])/c}).x-p.x,y:r.y-p.y};return[n.x,n.y]}};void 0!==t&&(d.filter=function(e){var n=r.trails||10;return t&&e.time>t-n&&e.time<t});var v=e.dataSet.get(d);this.processData(v),e.options._size=e.options.size;var g=i.latLngToContainerPoint(L.latLng(0,0)),m={x:g.x-p.x,y:g.y-p.y};this.drawContext(n,v,e.options,m),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){}},{key:"moveStartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}},{key:"moveEndEvent",value:function(){this.canvasLayer.draw(),this._show()}},{key:"zoomStartEvent",value:function(){this._hide()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_hide",value:function(){this.canvasLayer.canvas.style.display="none"}},{key:"_show",value:function(){this.canvasLayer.canvas.style.display="block"}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),e}(Xt);if("undefined"!==typeof L){var ce=L.Layer.extend({options:{attributionPrefix:null,attribution:""},initialize:function(t,e,r){r=r||{},this.dataSet=t||{},this.mapVOptions=e||{},this.render=this.render.bind(this),L.Util.setOptions(this,r),this.options.attributionPrefix&&(this.options.attribution=this.options.attributionPrefix+this.options.attribution),this.canvas=this._createCanvas(),L.stamp(this)},onAdd:function(t){this._map=t;var e=this.getPane(),r=this.container=L.DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e);r.appendChild(this.canvas);var n=t.getSize();r.style.width=n.x+"px",r.style.height=n.y+"px",this.renderer=new he(t,this,this.dataSet,this.mapVOptions),this.draw(),this.fire("loaded")},onRemove:function(){L.DomUtil.remove(this.container),this.renderer.destroy()},addData:function(t,e){this.renderer.addData(t,e)},update:function(t){this.renderer.update(t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},draw:function(){return this._reset()},setZIndex:function(t){this.canvas.style.zIndex=t},render:function(){this.renderer._canvasUpdate()},getCanvas:function(){return this.canvas},getContainer:function(){return this.container},getTopLeft:function(){var t,e=this._map;return e&&(t=e.getBounds().getNorthWest()),t},_createCanvas:function(){var t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600;var e="undefined"===typeof window?{}:window,r=this.devicePixelRatio=e.devicePixelRatio;return this.mapVOptions.context&&"2d"!==this.mapVOptions.context||t.getContext("2d").scale(r,r),t},_resize:function(){var t=this.canvas;if(t){var e=this._map,r=e.getSize();t.width=r.x,t.height=r.y,t.style.width=r.x+"px",t.style.height=r.y+"px";var n=e.getBounds(),i=e.latLngToLayerPoint(n.getNorthWest());L.DomUtil.setPosition(t,i)}},_reset:function(){this._resize(),this._render()},redraw:function(){this._resize(),this._render()},_render:function(){this.render()}});ae=function(t,e,r){return new ce(t,e,r)}}var fe,pe=ae,de=function(t){function e(t,r,n,i){s(this,e);var o=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n));return Xt?(o.map=t,o.scene=t.scene,o.dataSet=r,n=n||{},o.init(n),o.argCheck(n),o.initDevicePixelRatio(),o.canvasLayer=i,o.stopAniamation=!1,o.animation=n.animation,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o.bindEvent(),o):c(o)}return h(e,t),u(e,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(t){var r=t.point;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,r,t)}},{key:"mousemoveEvent",value:function(t){var r=t.point;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,r,t)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(t){this.map;var e=this.scene;if(this.canvasLayer&&!this.stopAniamation){var r=this.options.animation,n=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(var i in this.options)n[i]=this.options[i];else n.clear(n.COLOR_BUFFER_BIT);var o={transferCoordinate:function(t){var r=Cesium.Cartesian3.fromDegrees(t[0],t[1]),n=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,r);return void 0==n?[-1,-1]:[n.x,n.y]}};void 0!==t&&(o.filter=function(e){var n=r.trails||10;return!!(t&&e.time>t-n&&e.time<t)});var a=this.dataSet.get(o);this.processData(a),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,Cesium.Cartesian3.fromDegrees(0,0));this.drawContext(n,new f(a),this.options,s),this.options.updateCallback&&this.options.updateCallback(t)}}},{key:"updateData",value:function(t,r){var n=t;n&&n.get&&(n=n.get()),void 0!=n&&this.dataSet.set(n),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:r})}},{key:"addData",value:function(t,e){var r=t;t&&t.get&&(r=t.get()),this.dataSet.add(r),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}}]),e}(Xt);if("undefined"!==typeof Cesium){var ve=0,ge=(Cesium,function(){function t(e,r,n,i){if(s(this,t),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new de(e,r,n,this),this.mapVOptions=n,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),i)this.container=i;else{var o=e.container.querySelector(".cesium-viewer-cesiumWidgetContainer");this.container=o||e.container}this.addInnerContainer(),this.bindEvent(),this._reset()}return u(t,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var e=new Cesium.ScreenSpaceEventHandler(this.scene.canvas);e.setInputAction((function(e){t.innerMoveEnd()}),Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction((function(e){t.innerMoveEnd()}),Cesium.ScreenSpaceEventType.MIDDLE_UP),this.handler=e}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.mapvBaseLayer&&(this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer.animatorMoveendEvent(),this._reset())}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(t,e)}},{key:"updateData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(t,e)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(t){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(t)}},{key:"removeAllData",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block",this}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none",this}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");t.id=this.mapVOptions.layerid||"mapv"+ve++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||0,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height;var e=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(e,e),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){void 0!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(t){void 0!=t&&this.updateData(t.data,t.options)}},{key:"resizeCanvas",value:function(){if(void 0!=this.canvas&&null!=this.canvas){var t=this.canvas;t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),t}());fe=function(t,e,r,n){return new ge(t,e,r,n)}}var me=fe,ye={getDataSet:function(t){var e=[],r=t.features;if(r)for(var n=0;n<r.length;n++){var i=r[n],o=i.geometry,a=i.properties,s={};for(var u in a)s[u]=a[u];s.geometry=o,e.push(s)}return new f(e)}},be={CSVToArray:function(t,e){e=e||",";for(var r=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),n=[[]],i=null;i=r.exec(t);){var o,a=i[1];a.length&&a!==e&&n.push([]),o=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],n[n.length-1].push(o)}return n},getDataSet:function(t,e){for(var r=this.CSVToArray(t,e||","),n=[],i=r[0],o=1;o<r.length-1;o++){for(var a=r[o],s={},u=0;u<a.length;u++){var l=a[u];"geometry"==i[u]&&(l=JSON.parse(l)),s[i[u]]=l}n.push(s)}return new f(n)}};e.version="2.0.56",e.canvasClear=r,e.canvasResolutionScale=function(t){var e=window.devicePixelRatio||1;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)},e.canvasDrawSimple=v,e.canvasDrawHeatmap=w,e.canvasDrawGrid=M,e.canvasDrawHoneycomb=T,e.webglDrawSimple=lt,e.webglDrawPoint=F,e.webglDrawLine=k,e.webglDrawPolygon=ut,e.utilCityCenter=a,e.utilCurve=ct,e.utilForceEdgeBundling=function(){var t={},e=[],r=[],n=[],i=.1,o=.1,a=2,s=6,u=70,l=.6666667,h=.6;function c(e){return{x:t[e.target].x-t[e.source].x,y:t[e.target].y-t[e.source].y}}function f(e){return Math.sqrt(Math.pow(t[e.source].x-t[e.target].x,2)+Math.pow(t[e.source].y-t[e.target].y,2))}function p(t){for(var e=0,r=1;r<n[t].length;r++)e+=d(n[t][r],n[t][r-1]);return e}function d(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function v(t,e){var r=Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y)),n=((e.source.y-t.y)*(e.source.y-e.target.y)-(e.source.x-t.x)*(e.target.x-e.source.x))/(r*r);return{x:e.source.x+n*(e.target.x-e.source.x),y:e.source.y+n*(e.target.y-e.source.y)}}function g(e){for(var r=[],n=0;n<e.length;n++)t[e[n].source].x!=t[e[n].target].x&&t[e[n].source].y!=t[e[n].target].y&&r.push(e[n]);return r}function m(t,e,r){var i=n[t][e-1],o=n[t][e+1],a=n[t][e],s=i.x-a.x+o.x-a.x,u=i.y-a.y+o.y-a.y;return{x:s*=r,y:u*=r}}function y(t,e,i){for(var o,a={x:0,y:0},s=r[t],u=0;u<s.length;u++){var l={x:n[s[u]][e].x-n[t][e].x,y:n[s[u]][e].y-n[t][e].y};if(Math.abs(l.x)>1e-8||Math.abs(l.y)>1e-8){var h=1/Math.pow((o={source:n[s[u]][e],target:n[t][e]},Math.sqrt(Math.pow(o.source.x-o.target.x,2)+Math.pow(o.source.y-o.target.y,2))),1);a.x+=l.x*h,a.y+=l.y*h}}return a}function b(t,r,n){for(var o=i/(f(e[t])*(r+1)),a=[{x:0,y:0}],s=1;s<r+1;s++){var u={x:0,y:0},l=m(t,s,o),h=y(t,s);u.x=n*(l.x+h.x),u.y=n*(l.y+h.y),a.push(u)}return a.push({x:0,y:0}),a}function x(r){for(var i=0;i<e.length;i++)if(1==r)n[i].push(t[e[i].source]),n[i].push((v=e[i],{x:(t[v.source].x+t[v.target].x)/2,y:(t[v.source].y+t[v.target].y)/2})),n[i].push(t[e[i].target]);else{var o=p(i)/(r+1),a=o,s=[];s.push(t[e[i].source]);for(var u=1;u<n[i].length;u++){for(var l=d(n[i][u],n[i][u-1]);l>a;){var h=a/l,c=n[i][u-1].x,f=n[i][u-1].y;c+=h*(n[i][u].x-n[i][u-1].x),f+=h*(n[i][u].y-n[i][u-1].y),s.push({x:c,y:f}),l-=a,a=o}a-=l}s.push(t[e[i].target]),n[i]=s}var v}function _(e,r){var n=v(t[r.source],{source:t[e.source],target:t[e.target]}),i=v(t[r.target],{source:t[e.source],target:t[e.target]}),o={x:(n.x+i.x)/2,y:(n.y+i.y)/2},a={x:(t[e.source].x+t[e.target].x)/2,y:(t[e.source].y+t[e.target].y)/2};return Math.max(0,1-2*d(a,o)/d(n,i))}function w(e,r){return function(t,e){var r,n;return Math.abs((r=c(t),n=c(e),(r.x*n.x+r.y*n.y)/(f(t)*f(e))))}(e,r)*function(t,e){var r=(f(t)+f(e))/2;return 2/(r/Math.min(f(t),f(e))+Math.max(f(t),f(e))/r)}(e,r)*function(e,r){var n=(f(e)+f(r))/2;return n/(n+d({x:(t[e.source].x+t[e.target].x)/2,y:(t[e.source].y+t[e.target].y)/2},{x:(t[r.source].x+t[r.target].x)/2,y:(t[r.source].y+t[r.target].y)/2}))}(e,r)*function(t,e){return Math.min(_(t,e),_(e,t))}(e,r)}function M(t,e){return w(t,e)>=h}var E=function(){var t=o,i=u,a=1;!function(){for(var t=0;t<e.length;t++)n[t]=[]}(),function(){for(var t=0;t<e.length;t++)r[t]=[]}(),x(a),function(){for(var t=0;t<e.length-1;t++)for(var n=t+1;n<e.length;n++)t!=n&&M(e[t],e[n])&&(r[t].push(n),r[n].push(t))}();for(var h=0;h<s;h++){for(var c=0;c<i;c++){for(var f=[],p=0;p<e.length;p++)f[p]=b(p,a,t);for(var d=0;d<e.length;d++)for(var v=0;v<a+1;v++)n[d][v].x+=f[d][v].x,n[d][v].y+=f[d][v].y}t/=2,i*=l,x(a*=2)}return n};return E.nodes=function(e){return 0==arguments.length?t:(t=e,E)},E.edges=function(t){return 0==arguments.length?e:(e=g(t),E)},E.bundling_stiffness=function(t){return 0==arguments.length?i:(i=t,E)},E.step_size=function(t){return 0==arguments.length?o:(o=t,E)},E.cycles=function(t){return 0==arguments.length?s:(s=t,E)},E.iterations=function(t){return 0==arguments.length?u:(u=t,E)},E.iterations_rate=function(t){return 0==arguments.length?l:(l=t,E)},E.subdivision_points_seed=function(t){return 0==arguments.length?P:(P=t,E)},E.subdivision_rate=function(t){return 0==arguments.length?a:(a=t,E)},E.compatbility_threshold=function(t){return 0==arguments.length?compatbility_threshold:(h=t,E)},E},e.utilDataRangeIntensity=m,e.utilDataRangeCategory=ft,e.utilDataRangeChoropleth=pt,e.Map=dt,e.baiduMapCanvasLayer=vt,e.baiduMapAnimationLayer=$t,e.baiduMapLayer=te,e.googleMapCanvasLayer=ee,e.googleMapLayer=ne,e.MaptalksLayer=se,e.AMapLayer=ue,e.OpenlayersLayer=le,e.leafletMapLayer=pe,e.cesiumMapLayer=me,e.DataSet=f,e.geojson=ye,e.csv=be,Object.defineProperty(e,"__esModule",{value:!0})}(e)}).call(this,r(170))},400:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311);var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeControl(this.control),this.control=null}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.destroy(),this.control=this.getControl(),t.addControl(this.control))}},{key:"getControl",value:function(){return null}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},520:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(311);var a=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeOverlay(this.overlay),this.overlay=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.overlay=this.getOverlay(),this.bindEvent(this.overlay,this.events),t.addOverlay(this.overlay);var e=this.overlay.getPath();e&&e.length>0&&!0===this.props.autoViewport&&t.setViewport(e,this.props.viewportOptions)}}},{key:"getOverlay",value:function(){return null}},{key:"options",get:function(){return["strokeColor","fillColor","strokeWeight","strokeOpacity","fillOpacity","strokeStyle","enableMassClear","enableEditing","enableClicking"]}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"]}}]),e}(((n=o)&&n.__esModule?n:{default:n}).default);e.default=a},637:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=l(r(0)),o=r(3),a=l(r(311)),s=l(r(638)),u=l(r(1120));function l(t){return t&&t.__esModule?t:{default:t}}for(var h="//huiyan.baidu.com/cms/react-bmap/markers_new2x_fbb9e99.png",c={simple_red:new BMap.Icon(h,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-189),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),simple_blue:new BMap.Icon(h,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-225),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),loc_red:new BMap.Icon(h,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-189),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),loc_blue:new BMap.Icon(h,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-225),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),start:new BMap.Icon(h,new BMap.Size(25,40),{imageOffset:new BMap.Size(-200,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),end:new BMap.Icon(h,new BMap.Size(25,40),{imageOffset:new BMap.Size(-225,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),location:new BMap.Icon(h,new BMap.Size(14,20),{imageOffset:new BMap.Size(-124,-233),anchor:new BMap.Size(7,20),imageSize:new BMap.Size(300,300)})},f=1;f<=10;f++)c["red"+f]=new BMap.Icon(h,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(f-1),0),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});for(f=1;f<=10;f++)c["blue"+f]=new BMap.Icon(h,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(f-1),-66),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});var p=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.marker&&(this.props.map.removeOverlay(this.marker),this.marker=null)}},{key:"initialize",value:function(){var t=this.props.map;if("order_tip"!=this.props.type&&t){var e;this.destroy();var r=this.props.icon;if(e=r&&r instanceof BMap.Icon?r:r&&c[r]?c[r]:c.simple_red,"bd09mc"===this.props.coordType)var n=t.getMapType().getProjection().pointToLngLat(new BMap.Pixel(this.props.position.lng,this.props.position.lat));else n=new BMap.Point(this.props.position.lng,this.props.position.lat);if("children"in this.props){this.contentDom=document.createElement("div");var a=this.props.children;(0,o.render)(i.default.createElement("div",null,a),this.contentDom),this.marker=new u.default(n,this.contentDom,{zIndex:this.props.zIndex,pane:this.props.pane,offset:this.props.offset}),t.addOverlay(this.marker)}else{var s=this.getOptions(this.options);s.icon=e,this.marker=new BMap.Marker(n,s),this.props.isTop&&this.marker.setTop(!0),this.bindEvent(this.marker,this.events),t.addOverlay(this.marker),this.bindToggleMeghods(this.marker,this.toggleMethods)}this.props.autoViewport&&t.setViewport([n],this.props.ViewportOptions)}}},{key:"render",value:function(){return"order_tip"==this.props.type?i.default.createElement(s.default,this.props):null}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","infowindowclose","infowindowopen","dragstart","dragging","dragend","rightclick"]}},{key:"toggleMethods",get:function(){return{enableMassClear:["enableMassClear","disableMassClear"],enableDragging:["enableDragging","disableDragging"]}}},{key:"options",get:function(){return["offset","icon","enableMassClear","enableDragging","enableClicking","raiseOnDrag","draggingCursor","rotation","shadow","title"]}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=p},638:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=u(r(0)),a=u(r(637)),s=r(1110);function u(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.createMarker=r.createMarker.bind(r),r.state={},r}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentDidUpdate",value:function(t){JSON.stringify(t.data)!=JSON.stringify(this.props.data)||this.map}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"createMarker",value:function(){var t=this,e=this.props,r=e.position,i=e.num,u=e.rate,l=e.name,h=e.rightModule,c=e.order,f=e.visible,p=void 0===f||f,d=s.bmap.createPoint(r),v=!0;u&&(u.indexOf("-")>-1&&(v=!1,u=u.replace(/-/,"")),u.indexOf("+")>-1&&(v=!0,u=u.replace("+","")),0==u.length&&(u="_"));var g={display:"flex",justifyContent:"space-between",background:"#FFFFFF",alignItems:"stretch",boxShadow:"0 2px 2px 0 rgba(0, 0, 0, 0.22)",borderRadius:"3px 0 0 3px",minWidth:"155px",minHeight:"50px",marginTop:"-25px"},m={minWidth:"30px",background:"#999999",color:"white",padding:"auto 0",display:"flex",justifyContent:"center",alignItems:"center"};this.props.active&&(m.background="#F5533D"),this.props.leftStyle&&(m=s.obj.merge(m,this.props.leftStyle)),this.props.style&&(g=s.obj.merge(g,this.props.style));var y={flex:"1",padding:"6px",justifyContent:"center",alignItems:"center",fontSize:"12px",color:"#8D93A3",letterSpacing:"0.6px"};this.props.rightStyle&&(y=s.obj.merge(y,this.props.rightStyle));var b=Object.keys(t.props).filter((function(t){return 0==t.indexOf("on")})),x=[];if(b.map((function(e){x[e]=t.props[e]})),p)return o.default.createElement(a.default,{key:JSON.stringify(d)+Math.random(),map:this.props.map,position:d,zIndex:t.props.zIndex},o.default.createElement("div",n({key:JSON.stringify(d)+Math.random(),style:g},x),o.default.createElement("div",{style:m},c),o.default.createElement("div",{style:y},!h&&o.default.createElement("div",null,"  ",i+"("+u,v?o.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/up.png"}):o.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/down.png"}),")"),h||o.default.createElement("div",null,"  ",l," "))))}},{key:"render",value:function(){return this.createMarker()}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(o.default.Component);e.default=l},639:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=void 0,n=void 0;try{if("string"===typeof t){var i=t.split(",");r=JSON.parse(i[0].match(/[0-9]+\.?[0-9]{0,}/)[0]),n=JSON.parse(i[1].match(/[0-9]+\.?[0-9]{0,}/)[0])}else t instanceof Array?(r=JSON.parse(t[0]),n=JSON.parse(t[1])):t instanceof Object&&(r=t.lng,n=t.lat);if(e)return{lng:r,lat:n};var o=new BMap.Point(r,n);return o}catch(a){console.log("create BmapPoint error",'Please input data like this:  1. "114.54,40.33",  2.[114.54,40.33],  3.{lng:114.54,lat:40.33}')}}},640:function(t,e,r){(function(t){!function(e){function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}function i(t,e){return function(r){return e(t(r))}}function o(t,e){if(!(this instanceof o))return new o(t,e);if(e&&e in $t&&(e=null),e&&!(e in Gt))throw Error("Unknown model: "+e);if("undefined"===typeof t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof o)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"===typeof t){if(null===(e=zt.get(t)))throw Error("Unable to parse color from string: "+t);this.model=e.model;var r=Gt[this.model].channels;this.color=e.value.slice(0,r),this.valpha="number"===typeof e.value[r]?e.value[r]:1}else if(t.length)this.model=e||"rgb",r=Gt[this.model].channels,e=Jt.call(t,0,r),this.color=u(e,r),this.valpha="number"===typeof t[r]?t[r]:1;else if("number"===typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{if(this.valpha=1,e=Object.keys(t),"alpha"in t&&(e.splice(e.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0),!((e=e.sort().join(""))in Qt))throw Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Qt[e],r=Gt[this.model].labels;var n=[];for(e=0;e<r.length;e++)n.push(t[r[e]]);this.color=u(n)}if(Kt[this.model])for(r=Gt[this.model].channels,e=0;e<r;e++)(t=Kt[this.model][e])&&(this.color[e]=t(this.color[e]));this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function a(t,e,r){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Kt[t]||(Kt[t]=[]))[e]=r})),t=t[0],function(n){if(arguments.length){r&&(n=r(n));var i=this[t]();return i.color[e]=n,i}return i=this[t]().color[e],r&&(i=r(i)),i}}function s(t){return function(e){return Math.max(0,Math.min(t,e))}}function u(t,e){for(var r=0;r<e;r++)"number"!==typeof t[r]&&(t[r]=0);return t}function l(){}function h(t,e){for(var r in e)t[r]=e[r]}function c(t,e){this.lng=t,this.lat=e}function f(t,e){this.x=t,this.y=e}function p(t){return t*Math.PI/180}function d(t,e){var r=document.createElement("canvas");return t&&(r.width=t),e&&(r.height=e),r}function v(t,e,r,n,i,o){if(!(i-n<=r)){var a=n+i>>1;!function t(e,r,n,i,o,a){for(;o>i;){if(600<o-i){var s=o-i+1,u=n-i+1,l=Math.log(s),h=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*h*(s-h)/s)*(0>u-s/2?-1:1),t(e,r,n,Math.max(i,Math.floor(n-u*h/s+l)),Math.min(o,Math.floor(n+(s-u)*h/s+l)),a)}for(s=r[2*n+a],u=i,h=o,g(e,r,i,n),r[2*o+a]>s&&g(e,r,i,o);u<h;){for(g(e,r,u,h),u++,h--;r[2*u+a]<s;)u++;for(;r[2*h+a]>s;)h--}r[2*i+a]===s?g(e,r,i,h):(h++,g(e,r,h,o)),h<=n&&(i=h+1),n<=h&&(o=h-1)}}(t,e,a,n,i,o%2),v(t,e,r,n,a-1,o+1),v(t,e,r,a+1,i,o+1)}}function g(t,e,r,n){m(t,r,n),m(e,2*r,2*n),m(e,2*r+1,2*n+1)}function m(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e){return{x:(t=t.geometry.coordinates)[0]/360+.5,y:_(t[1]),zoom:1/0,index:e,parentId:-1}}function b(t){return{type:"Feature",id:t.id,properties:x(t),geometry:{type:"Point",coordinates:[360*(t.x-.5),360*Math.atan(Math.exp((180-360*t.y)*Math.PI/180))/Math.PI-90]}}}function x(t){var e=t.numPoints,r=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return w(w({},t.properties),{cluster:!0,clusterId:t.id,pointCount:e,pointCountAbbreviated:r})}function _(t){return t=Math.sin(t*Math.PI/180),0>(t=.5-.25*Math.log((1+t)/(1-t))/Math.PI)?0:1<t?1:t}function w(t,e){for(var r in e)t[r]=e[r];return t}function M(t){return t.x}function E(t){return t.y}function T(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=void 0===t.maxSize?35:t.maxSize,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function P(t){this.options=t||{},this._initialize()}function A(t,e,r,n,i){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*r+3*(1-t)*t*t*n+t*t*t*i}function S(t){for(var e,r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],n=0;n<r.length;n++)try{if((e=t.getContext(r[n])).getExtension("OES_element_index_uint"),e)break}catch(i){}return e}function L(t,e,r){r=Object.assign({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},r);var n=t.createTexture();for(var i in t.bindTexture(t.TEXTURE_2D,n),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),r)t.texParameteri(t.TEXTURE_2D,t[i],t[r[i]]);return t.bindTexture(t.TEXTURE_2D,null),n}function O(t,e,r,n){if("object"===("undefined"===typeof e?"undefined":Ut(e)))e=L(t,e,n),r(e,null);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var e=Math.pow(2,Math.floor(Math.log(i.width)/Math.LN2)),o=Math.pow(2,Math.floor(Math.log(i.height)/Math.LN2)),a=document.createElement("canvas");a.width=e,a.height=o,a.getContext("2d").drawImage(i,0,0,e,o),e=L(t,i=a,n),r(e,i)},i.src=e}}function R(t,e){return function(r){var n=this;if(!e)return new Ge(t);if(Ge&&!r)return r=C(r=(""+e).replace(/^function.+?{/,"").slice(0,-1)),this[Ze]=new Ge(r),Xe.revokeObjectURL(r),this[Ze];var i={postMessage:function(t){n.onmessage&&setTimeout((function(){return n.onmessage({data:t,target:i})}))}};e.call(i),this.postMessage=function(t){setTimeout((function(){return i.onmessage({data:t,target:n})}))},this.isThisThread=!0}}function C(t){try{return Xe.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch(r){var e=new Ve;return e.append(t),Xe.createObjectURL(e.getBlob(type))}}function k(t,e,r){this.heatmapLayer=r,this.options=e||{},this.map=t,t=document.createElement("canvas"),this.data=[],this.canvas=t,this.scale(1)}function B(t,e,r){this.layer=t,this.map=e,this.gl=r,this.initWorker()}function D(t,e,r){this.layer=t,this.map=e,this.gl=r,this.initWorker()}function F(t,e,r){r=r||2;var n,i=e&&e.length,o=i?e[0]*r:t.length,a=z(t,0,o,r,!0),s=[];if(!a||a.next===a.prev)return s;if(i){var u,l=r;i=[];var h=0;for(u=e.length;h<u;h++){var c=e[h]*l;(c=z(t,c,h<u-1?e[h+1]*l:t.length,l,!1))===c.next&&(c.steiner=!0),i.push(W(c))}for(i.sort(j),h=0;h<i.length;h++)(l=N(e=i[h],l=a))&&I(e=G(l,e),e.next),a=I(a,a.next)}if(t.length>80*r){var f=n=t[0],p=i=t[1];for(l=r;l<o;l+=r)(h=t[l])<f&&(f=h),(e=t[l+1])<p&&(p=e),h>n&&(n=h),e>i&&(i=e);n=0!==(n=Math.max(n-f,i-p))?1/n:0}return function t(e,r,n,i,o,a,s){if(e){if(!s&&a){var u=e,l=u;do{null===l.z&&(l.z=Y(l.x,l.y,i,o,a)),l.prevZ=l.prev,l=l.nextZ=l.next}while(l!==u);l.prevZ.nextZ=null,l.prevZ=null,u=l;var h,c,f,p,d=1;do{l=u;var v=u=null;for(c=0;l;){c++;var g=l;for(h=f=0;h<d&&(f++,g=g.nextZ);h++);for(p=d;0<f||0<p&&g;)0!==f&&(0===p||!g||l.z<=g.z)?(h=l,l=l.nextZ,f--):(h=g,g=g.nextZ,p--),v?v.nextZ=h:u=h,h.prevZ=v,v=h;l=g}v.nextZ=null,d*=2}while(1<c)}for(u=e;e.prev!==e.next;){if(l=e.prev,g=e.next,a)v=U(e,i,o,a);else t:if(v=e,c=v.prev,f=v,d=v.next,0<=q(c,f,d))v=!1;else{for(h=v.next.next;h!==v.prev;){if(H(c.x,c.y,f.x,f.y,d.x,d.y,h.x,h.y)&&0<=q(h.prev,h,h.next)){v=!1;break t}h=h.next}v=!0}if(v)r.push(l.i/n),r.push(e.i/n),r.push(g.i/n),$(e),u=e=g.next;else if((e=g)===u){if(s){if(1===s){s=r,u=n,l=e;do{g=l.prev,v=l.next.next,!Z(g,v)&&V(g,l,l.next,v)&&X(g,v)&&X(v,g)&&(s.push(g.i/u),s.push(l.i/u),s.push(v.i/u),$(l),$(l.next),l=e=v),l=l.next}while(l!==e);t(e=l,r,n,i,o,a,2)}else if(2===s)t:{s=e;do{for(u=s.next.next;u!==s.prev;){if(l=s.i!==u.i){if(g=u,v=(l=s).next.i!==g.i&&l.prev.i!==g.i){e:{v=l;do{if(v.i!==l.i&&v.next.i!==l.i&&v.i!==g.i&&v.next.i!==g.i&&V(v,v.next,l,g)){v=!0;break e}v=v.next}while(v!==l);v=!1}v=!v}if(v=v&&X(l,g)&&X(g,l)){v=l,c=!1,f=(l.x+g.x)/2,g=(l.y+g.y)/2;do{v.y>g!==v.next.y>g&&v.next.y!==v.y&&f<(v.next.x-v.x)*(g-v.y)/(v.next.y-v.y)+v.x&&(c=!c),v=v.next}while(v!==l);v=c}l=v}if(l){e=G(s,u),s=I(s,s.next),e=I(e,e.next),t(s,r,n,i,o,a),t(e,r,n,i,o,a);break t}u=u.next}s=s.next}while(s!==e)}}else t(I(e),r,n,i,o,a,1);break}}}}(a,s,r,f,p,n),s}function z(t,e,r,n,i){if(i===0<K(t,e,r,n))for(i=e;i<r;i+=n)var o=J(i,t[i],t[i+1],o);else for(i=r-n;i>=e;i-=n)o=J(i,t[i],t[i+1],o);return o&&Z(o,o.next)&&($(o),o=o.next),o}function I(t,e){if(!t)return t;e||(e=t);do{var r=!1;if(t.steiner||!Z(t,t.next)&&0!==q(t.prev,t,t.next))t=t.next;else{if($(t),(t=e=t.prev)===t.next)break;r=!0}}while(r||t!==e);return e}function U(t,e,r,n){var i=t.prev,o=t.next;if(0<=q(i,t,o))return!1;var a=i.x>t.x?i.x>o.x?i.x:o.x:t.x>o.x?t.x:o.x,s=i.y>t.y?i.y>o.y?i.y:o.y:t.y>o.y?t.y:o.y,u=Y(i.x<t.x?i.x<o.x?i.x:o.x:t.x<o.x?t.x:o.x,i.y<t.y?i.y<o.y?i.y:o.y:t.y<o.y?t.y:o.y,e,r,n);for(e=Y(a,s,e,r,n),r=t.prevZ,n=t.nextZ;r&&r.z>=u&&n&&n.z<=e;){if(r!==t.prev&&r!==t.next&&H(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=q(r.prev,r,r.next))return!1;if(r=r.prevZ,n!==t.prev&&n!==t.next&&H(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=q(n.prev,n,n.next))return!1;n=n.nextZ}for(;r&&r.z>=u;){if(r!==t.prev&&r!==t.next&&H(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=q(r.prev,r,r.next))return!1;r=r.prevZ}for(;n&&n.z<=e;){if(n!==t.prev&&n!==t.next&&H(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=q(n.prev,n,n.next))return!1;n=n.nextZ}return!0}function j(t,e){return t.x-e.x}function N(t,e){var r=e,n=t.x,i=t.y,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(i===r.y)return r;if(i===r.next.y)return r.next}var s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(n===o)return s.prev;e=s,a=s.x;var u=s.y,l=1/0;for(r=s.next;r!==e;){if(n>=r.x&&r.x>=a&&n!==r.x&&H(i<u?n:o,i,a,u,i<u?o:n,i,r.x,r.y)){var h=Math.abs(i-r.y)/(n-r.x);(h<l||h===l&&r.x>s.x)&&X(r,t)&&(s=r,l=h)}r=r.next}return s}function Y(t,e,r,n,i){return 1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1)|(1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function W(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function H(t,e,r,n,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(r-a)*(e-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function q(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Z(t,e){return t.x===e.x&&t.y===e.y}function V(t,e,r,n){return!!(Z(t,e)&&Z(r,n)||Z(t,n)&&Z(r,e))||0<q(t,e,r)!==0<q(t,e,n)&&0<q(r,n,t)!==0<q(r,n,e)}function X(t,e){return 0>q(t.prev,t,t.next)?0<=q(t,e,t.next)&&0<=q(t,t.prev,e):0>q(t,e,t.prev)||0>q(t,t.next,e)}function G(t,e){var r=new Q(t.i,t.x,t.y),n=new Q(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function J(t,e,r,n){return t=new Q(t,e,r),n?(t.next=n.next,t.prev=n,n.next.prev=t,n.next=t):(t.prev=t,t.next=t),t}function $(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Q(t,e,r){this.i=t,this.x=e,this.y=r,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function K(t,e,r,n){for(var i=0,o=r-n;e<r;e+=n)i+=(t[o]-t[e])*(t[e+1]+t[o+1]),o=e;return i}function tt(t,e){this.shapeLayer=t,this.gl=e,this.initData()}function et(){dr=!0;for(var t=0;64>t;++t)cr[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t],fr["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;fr[45]=62,fr[95]=63}function rt(t,e,r){for(var n=[],i=e;i<r;i+=3)e=(t[i]<<16)+(t[i+1]<<8)+t[i+2],n.push(cr[e>>18&63]+cr[e>>12&63]+cr[e>>6&63]+cr[63&e]);return n.join("")}function nt(t){dr||et();for(var e=t.length,r=e%3,n="",i=[],o=0,a=e-r;o<a;o+=16383)i.push(rt(t,o,o+16383>a?a:o+16383));return 1===r?(t=t[e-1],n+=cr[t>>2],n+=cr[t<<4&63],n+="=="):2===r&&(t=(t[e-2]<<8)+t[e-1],n+=cr[t>>10],n+=cr[t>>4&63],n+=cr[t<<2&63],n+="="),i.push(n),i.join("")}function it(t,e,r,n,i){var o=8*i-n-1,a=(1<<o)-1,s=a>>1,u=-7,l=r?-1:1,h=t[e+(i=r?i-1:0)];for(i+=l,r=h&(1<<-u)-1,h>>=-u,u+=o;0<u;r=256*r+t[e+i],i+=l,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=n;0<u;o=256*o+t[e+i],i+=l,u-=8);if(0===r)r=1-s;else{if(r===a)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),r-=s}return(h?-1:1)*o*Math.pow(2,r-n)}function ot(t,e,r,n,i,o){var a,s=8*o-i-1,u=(1<<s)-1,l=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0;o=n?0:o-1;var c=n?1:-1,f=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(e=isNaN(e)?1:0,n=u):(n=Math.floor(Math.log(e)/Math.LN2),1>e*(a=Math.pow(2,-n))&&(n--,a*=2),2<=(e=1<=n+l?e+h/a:e+h*Math.pow(2,1-l))*a&&(n++,a/=2),n+l>=u?(e=0,n=u):1<=n+l?(e=(e*a-1)*Math.pow(2,i),n+=l):(e=e*Math.pow(2,l-1)*Math.pow(2,i),n=0));8<=i;t[r+o]=255&e,o+=c,e/=256,i-=8);for(n=n<<i|e,s+=i;0<s;t[r+o]=255&n,o+=c,n/=256,s-=8);t[r+o-c]|=128*f}function at(t,e){if((st.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<e)throw new RangeError("Invalid typed array length");return st.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=st.prototype:(null===t&&(t=new st(e)),t.length=e),t}function st(t,e,r){if(!(st.TYPED_ARRAY_SUPPORT||this instanceof st))return new st(t,e,r);if("number"===typeof t){if("string"===typeof e)throw Error("If encoding is specified then the first argument must be a string");return ht(this,t)}return ut(this,t,e,r)}function ut(t,e,r,n){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');if("undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer){if(e.byteLength,0>r||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),st.TYPED_ARRAY_SUPPORT?(t=e).__proto__=st.prototype:t=ct(t,e),t}if("string"===typeof e){if(n=t,"string"===typeof(t=r)&&""!==t||(t="utf8"),!st.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return(e=(n=at(n,r=0|dt(e,t))).write(e,t))!==r&&(n=n.slice(0,e)),n}return function(t,e){if(pt(e)){var r=0|ft(e.length);return 0===(t=at(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return(r="number"!==typeof e.length)||(r=(r=e.length)!==r),r?at(t,0):ct(t,e);if("Buffer"===e.type&&gr(e.data))return ct(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function lt(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(0>t)throw new RangeError('"size" argument must not be negative')}function ht(t,e){if(lt(e),t=at(t,0>e?0:0|ft(e)),!st.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function ct(t,e){var r=0>e.length?0:0|ft(e.length);t=at(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function ft(t){if(t>=(st.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(st.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return 0|t}function pt(t){return!(null==t||!t._isBuffer)}function dt(t,e){if(pt(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return At(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Lt(t).length;default:if(n)return At(t).length;e=(""+e).toLowerCase(),n=!0}}function vt(t,e,r){var n=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),0>=r)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":for(t=e,e=r,r=this.length,(!t||0>t)&&(t=0),(!e||0>e||e>r)&&(e=r),n="",r=t;r<e;++r)n=(t=n)+(n=16>(n=this[r])?"0"+n.toString(16):n.toString(16));return n;case"utf8":case"utf-8":return bt(this,e,r);case"ascii":for(t="",r=Math.min(this.length,r);e<r;++e)t+=String.fromCharCode(127&this[e]);return t;case"latin1":case"binary":for(t="",r=Math.min(this.length,r);e<r;++e)t+=String.fromCharCode(this[e]);return t;case"base64":return e=0===e&&r===this.length?nt(this):nt(this.slice(e,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(e=this.slice(e,r),r="",t=0;t<e.length;t+=2)r+=String.fromCharCode(e[t]+256*e[t+1]);return r;default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function gt(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function mt(t,e,r,n,i){if(0===t.length)return-1;if("string"===typeof r?(n=r,r=0):2147483647<r?r=2147483647:-2147483648>r&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),0>r&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(0>r){if(!i)return-1;r=0}if("string"===typeof e&&(e=st.from(e,n)),pt(e))return 0===e.length?-1:yt(t,e,r,n,i);if("number"===typeof e)return e&=255,st.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):yt(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function yt(t,e,r,n,i){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(2>t.length||2>e.length)return-1;a=2,s/=2,u/=2,r/=2}if(i)for(n=-1;r<s;r++)if(o(t,r)===o(e,-1===n?0:r-n)){if(-1===n&&(n=r),r-n+1===u)return n*a}else-1!==n&&(r-=r-n),n=-1;else for(r+u>s&&(r=s-u);0<=r;r--){for(s=!0,n=0;n<u;n++)if(o(t,r+n)!==o(e,n)){s=!1;break}if(s)return r}return-1}function bt(t,e,r){r=Math.min(t.length,r);for(var n=[];e<r;){var i=t[e],o=null,a=239<i?4:223<i?3:191<i?2:1;if(e+a<=r)switch(a){case 1:128>i&&(o=i);break;case 2:var s=t[e+1];128===(192&s)&&127<(i=(31&i)<<6|63&s)&&(o=i);break;case 3:s=t[e+1];var u=t[e+2];128===(192&s)&&128===(192&u)&&2047<(i=(15&i)<<12|(63&s)<<6|63&u)&&(55296>i||57343<i)&&(o=i);break;case 4:s=t[e+1],u=t[e+2];var l=t[e+3];128===(192&s)&&128===(192&u)&&128===(192&l)&&65535<(i=(15&i)<<18|(63&s)<<12|(63&u)<<6|63&l)&&1114112>i&&(o=i)}null===o?(o=65533,a=1):65535<o&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),e+=a}if((t=n.length)<=mr)n=String.fromCharCode.apply(String,n);else{for(r="",e=0;e<t;)r+=String.fromCharCode.apply(String,n.slice(e,e+=mr));n=r}return n}function xt(t,e,r){if(0!==t%1||0>t)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function _t(t,e,r,n,i,o){if(!pt(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function wt(t,e,r,n){0>e&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Mt(t,e,r,n){0>e&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function Et(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(0>r)throw new RangeError("Index out of range")}function Tt(t,e,r,n,i){return i||Et(t,0,r,4),ot(t,e,r,n,23,4),r+4}function Pt(t,e,r,n,i){return i||Et(t,0,r,8),ot(t,e,r,n,52,8),r+8}function At(t,e){e=e||1/0;for(var r,n=t.length,i=null,o=[],a=0;a<n;++a){if(55295<(r=t.charCodeAt(a))&&57344>r){if(!i){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(e-=3)&&o.push(239,191,189);continue}i=r;continue}if(56320>r){-1<(e-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,128>r){if(0>--e)break;o.push(r)}else if(2048>r){if(0>(e-=2))break;o.push(r>>6|192,63&r|128)}else if(65536>r){if(0>(e-=3))break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(1114112>r))throw Error("Invalid code point");if(0>(e-=4))break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function St(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function Lt(t){if(2>(t=(t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(xr,"")).length)t="";else for(;0!==t.length%4;)t+="=";dr||et();var e=t.length;if(0<e%4)throw Error("Invalid string. Length must be a multiple of 4");var r="="===t[e-2]?2:"="===t[e-1]?1:0,n=new pr(3*e/4-r),i=0<r?e-4:e,o=0;for(e=0;e<i;e+=4){var a=fr[t.charCodeAt(e)]<<18|fr[t.charCodeAt(e+1)]<<12|fr[t.charCodeAt(e+2)]<<6|fr[t.charCodeAt(e+3)];n[o++]=a>>16&255,n[o++]=a>>8&255,n[o++]=255&a}return 2===r?(a=fr[t.charCodeAt(e)]<<2|fr[t.charCodeAt(e+1)]>>4,n[o++]=255&a):1===r&&(a=fr[t.charCodeAt(e)]<<10|fr[t.charCodeAt(e+1)]<<4|fr[t.charCodeAt(e+2)]>>2,n[o++]=a>>8&255,n[o++]=255&a),n}function Ot(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Rt(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Ct(t,e){var r=[];return t.forEach((function(t){r.push(e?-t:t,t)})),r}function kt(t){return function(e,r,n){return e=r+t,n[0<(r=n.length-1)?0>e?0:e>r?r:e:e<r?r:0<e?0:e]}}function Bt(t){if(!t[0]||!t[0].length)return t;for(var e=t[0].length,r=[],n=0,i=0;i<t.length;i++)for(var o=0;o<e;o++)r[n++]=t[i][o];return r}"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t||"undefined"!==typeof self&&self;var Dt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ft=n((function(t){var e=Array.prototype.concat,r=Array.prototype.slice,n=t.exports=function(t){for(var n=[],i=0,o=t.length;i<o;i++){var a=t[i],s=!(!(s=a)||"string"===typeof s)&&(s instanceof Array||Array.isArray(s)||0<=s.length&&(s.splice instanceof Function||Object.getOwnPropertyDescriptor(s,s.length-1)&&"String"!==s.constructor.name));s?n=e.call(n,r.call(a)):n.push(a)}return n};n.wrap=function(t){return function(){return t(n(arguments))}}})),zt=n((function(t){function e(t,e,r){return Math.min(Math.max(e,t),r)}function r(t){return 2>(t=t.toString(16).toUpperCase()).length?"0"+t:t}var n,i={};for(n in Dt)Dt.hasOwnProperty(n)&&(i[Dt[n]]=n);var o=t.exports={to:{},get:{}};o.get=function(t){switch(t.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(t);var e="hsl";break;case"hwb":t=o.get.hwb(t),e="hwb";break;default:t=o.get.rgb(t),e="rgb"}return t?{model:e,value:t}:null},o.get.rgb=function(t){if(!t)return null;var r,n=/^#([a-f0-9]{3,4})$/i,i=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=[0,0,0,1];if(r=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=r[2],r=r[1],t=0;3>t;t++)i=2*t,o[t]=parseInt(r.slice(i,i+2),16);n&&(o[3]=Math.round(parseInt(n,16)/255*100)/100)}else if(r=t.match(n)){for(n=(r=r[1])[3],t=0;3>t;t++)o[t]=parseInt(r[t]+r[t],16);n&&(o[3]=Math.round(parseInt(n+n,16)/255*100)/100)}else if(r=t.match(i)){for(t=0;3>t;t++)o[t]=parseInt(r[t+1],0);r[4]&&(o[3]=parseFloat(r[4]))}else{if(!(r=t.match(/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(r=t.match(/(\D+)/))?"transparent"===r[1]?[0,0,0,0]:(o=Dt[r[1]])?(o[3]=1,o):null:null;for(t=0;3>t;t++)o[t]=Math.round(2.55*parseFloat(r[t+1]));r[4]&&(o[3]=parseFloat(r[4]))}for(t=0;3>t;t++)o[t]=e(o[t],0,255);return o[3]=e(o[3],0,1),o},o.get.hsl=function(t){if(!t)return null;var r=t.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(r){var n=parseFloat(r[4]);return[t=(parseFloat(r[1])+360)%360,e(parseFloat(r[2]),0,100),r=e(parseFloat(r[3]),0,100),n=e(isNaN(n)?1:n,0,1)]}return null},o.get.hwb=function(t){if(!t)return null;var r=t.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(r){var n=parseFloat(r[4]);return[t=(parseFloat(r[1])%360+360)%360,e(parseFloat(r[2]),0,100),r=e(parseFloat(r[3]),0,100),n=e(isNaN(n)?1:n,0,1)]}return null},o.to.hex=function(){var t=Ft(arguments);return"#"+r(t[0])+r(t[1])+r(t[2])+(1>t[3]?r(Math.round(255*t[3])):"")},o.to.rgb=function(){var t=Ft(arguments);return 4>t.length||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},o.to.rgb.percent=function(){var t=Ft(arguments),e=Math.round(t[0]/255*100),r=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return 4>t.length||1===t[3]?"rgb("+e+"%, "+r+"%, "+n+"%)":"rgba("+e+"%, "+r+"%, "+n+"%, "+t[3]+")"},o.to.hsl=function(){var t=Ft(arguments);return 4>t.length||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},o.to.hwb=function(){var t=Ft(arguments),e="";return 4<=t.length&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},o.to.keyword=function(t){return i[t.slice(0,3)]}})),It=n((function(t){var e={};for(i in Dt)Dt.hasOwnProperty(i)&&(e[Dt[i]]=i);var r,n=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(r in n)if(n.hasOwnProperty(r)){if(!("channels"in n[r]))throw Error("missing channels property: "+r);if(!("labels"in n[r]))throw Error("missing channel labels property: "+r);if(n[r].labels.length!==n[r].channels)throw Error("channel and label counts mismatch: "+r);t=n[r].channels;var i=n[r].labels;delete n[r].channels,delete n[r].labels,Object.defineProperty(n[r],"channels",{value:t}),Object.defineProperty(n[r],"labels",{value:i})}n.rgb.hsl=function(t){var e=t[0]/255,r=t[1]/255,n=t[2]/255;t=Math.min(e,r,n);var i,o=Math.max(e,r,n),a=o-t;return o===t?i=0:e===o?i=(r-n)/a:r===o?i=2+(n-e)/a:n===o&&(i=4+(e-r)/a),0>(i=Math.min(60*i,360))&&(i+=360),e=(t+o)/2,[i,100*(o===t?0:.5>=e?a/(o+t):a/(2-o-t)),100*e]},n.rgb.hsv=function(t){var e,r=t[0]/255,n=t[1]/255,i=t[2]/255,o=Math.max(r,n,i),a=o-Math.min(r,n,i);if(0===a)var s=e=0;else{e=a/o,t=(o-r)/6/a+.5;var u=(o-n)/6/a+.5;a=(o-i)/6/a+.5,r===o?s=a-u:n===o?s=1/3+t-a:i===o&&(s=2/3+u-t),0>s?s+=1:1<s&&--s}return[360*s,100*e,100*o]},n.rgb.hwb=function(t){var e=t[0],r=t[1],i=t[2];return[t=n.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(r,i))*100,100*(i=1-1/255*Math.max(e,Math.max(r,i)))]},n.rgb.cmyk=function(t){var e=t[0]/255,r=t[1]/255;t=t[2]/255;var n=Math.min(1-e,1-r,1-t);return[100*((1-e-n)/(1-n)||0),100*((1-r-n)/(1-n)||0),100*((1-t-n)/(1-n)||0),100*n]},n.rgb.keyword=function(t){var r,n=e[t];if(n)return n;for(r in n=1/0,Dt)if(Dt.hasOwnProperty(r)){var i=Dt[r];if((i=Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2)+Math.pow(t[2]-i[2],2))<n){n=i;var o=r}}return o},n.keyword.rgb=function(t){return Dt[t]},n.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255;return t=t[2]/255,[100*(.4124*(e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(r=.04045<r?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92)),100*(.2126*e+.7152*r+.0722*t),100*(.0193*e+.1192*r+.9505*t)]},n.rgb.lab=function(t){var e=n.rgb.xyz(t);t=e[0];var r=e[1];return e=e[2],r/=100,e/=108.883,t=.008856<(t/=95.047)?Math.pow(t,1/3):7.787*t+16/116,[116*(r=.008856<r?Math.pow(r,1/3):7.787*r+16/116)-16,500*(t-r),200*(r-(e=.008856<e?Math.pow(e,1/3):7.787*e+16/116))]},n.hsl.rgb=function(t){var e=t[0]/360,r=t[1]/100;if(t=t[2]/100,0===r){var n=255*t;return[n,n,n]}t=2*t-(r=.5>t?t*(1+r):t+r-t*r);for(var i=[0,0,0],o=0;3>o;o++)0>(n=e+1/3*-(o-1))&&n++,1<n&&n--,n=1>6*n?t+6*(r-t)*n:1>2*n?r:2>3*n?t+(r-t)*(2/3-n)*6:t,i[o]=255*n;return i},n.hsl.hsv=function(t){var e=t[0],r=t[1]/100;t=t[2]/100;var n=r,i=Math.max(t,.01);return r*=1>=(t*=2)?t:2-t,n*=1>=i?i:2-i,[e,100*(0===t?2*n/(i+n):2*r/(t+r)),(t+r)/2*100]},n.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100;t=t[2]/100;var n=Math.floor(e)%6,i=e-Math.floor(e);e=255*t*(1-r);var o=255*t*(1-r*i);switch(r=255*t*(1-r*(1-i)),t*=255,n){case 0:return[t,r,e];case 1:return[o,t,e];case 2:return[e,t,r];case 3:return[e,o,t];case 4:return[r,e,t];case 5:return[t,e,o]}},n.hsv.hsl=function(t){var e=t[0],r=t[1]/100;t=t[2]/100;var n=Math.max(t,.01),i=(2-r)*n;return[e,100*(n=r*n/(1>=i?i:2-i)||0),(2-r)*t/2*100]},n.hwb.rgb=function(t){var e=t[0]/360,r=t[1]/100,n=r+(t=t[2]/100);switch(1<n&&(r/=n,t/=n),e=6*e-(n=Math.floor(6*e)),0!==(1&n)&&(e=1-e),e=r+e*((t=1-t)-r),n){default:case 6:case 0:n=t;var i=e;break;case 1:n=e,i=t;break;case 2:n=r,i=t,r=e;break;case 3:n=r,i=e,r=t;break;case 4:n=e,i=r,r=t;break;case 5:n=t,i=r,r=e}return[255*n,255*i,255*r]},n.cmyk.rgb=function(t){var e=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-e)+e)),255*(1-Math.min(1,t[1]/100*(1-e)+e)),255*(1-Math.min(1,t[2]/100*(1-e)+e))]},n.xyz.rgb=function(t){var e=t[0]/100,r=t[1]/100,n=t[2]/100;t=3.2406*e+-1.5372*r+-.4986*n;var i=-.9689*e+1.8758*r+.0415*n;return e=.0557*e+-.204*r+1.057*n,t=.0031308<t?1.055*Math.pow(t,1/2.4)-.055:12.92*t,i=.0031308<i?1.055*Math.pow(i,1/2.4)-.055:12.92*i,e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e,[255*(t=Math.min(Math.max(0,t),1)),255*(i=Math.min(Math.max(0,i),1)),255*(e=Math.min(Math.max(0,e),1))]},n.xyz.lab=function(t){var e=t[0],r=t[1];return t=t[2],r/=100,t/=108.883,e=.008856<(e/=95.047)?Math.pow(e,1/3):7.787*e+16/116,[116*(r=.008856<r?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(t=.008856<t?Math.pow(t,1/3):7.787*t+16/116))]},n.lab.xyz=function(t){var e=t[1],r=t[2];e=e/500+(t=(t[0]+16)/116),r=t-r/200;var n=Math.pow(t,3),i=Math.pow(e,3),o=Math.pow(r,3);return[95.047*(.008856<i?i:(e-16/116)/7.787),100*(.008856<n?n:(t-16/116)/7.787),108.883*(.008856<o?o:(r-16/116)/7.787)]},n.lab.lch=function(t){var e=t[0],r=t[1];t=t[2];var n=360*Math.atan2(t,r)/2/Math.PI;return 0>n&&(n+=360),[e,Math.sqrt(r*r+t*t),n]},n.lch.lab=function(t){var e=t[0],r=t[1];return t=t[2]/360*2*Math.PI,[e,r*Math.cos(t),r*Math.sin(t)]},n.rgb.ansi16=function(t){var e=t[0],r=t[1],i=t[2],o=1 in arguments?arguments[1]:n.rgb.hsv(t)[2];return 0===(o=Math.round(o/50))?30:(e=30+(Math.round(i/255)<<2|Math.round(r/255)<<1|Math.round(e/255)),2===o&&(e+=60),e)},n.hsv.ansi16=function(t){return n.rgb.ansi16(n.hsv.rgb(t),t[2])},n.rgb.ansi256=function(t){var e=t[0],r=t[1];return t=t[2],e===r&&r===t?8>e?16:248<e?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(t/255*5)},n.ansi16.rgb=function(t){var e=t%10;return 0===e||7===e?(50<t&&(e+=3.5),[e=e/10.5*255,e,e]):[(1&e)*(t=.5*(1+~~(50<t)))*255,(e>>1&1)*t*255,(e>>2&1)*t*255]},n.ansi256.rgb=function(t){if(232<=t){var e=10*(t-232)+8;return[e,e,e]}return t-=16,[e=Math.floor(t/36)/5*255,Math.floor((t%=36)/6)/5*255,t%6/5*255]},n.rgb.hex=function(t){return t=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase(),"000000".substring(t.length)+t},n.hex.rgb=function(t){if(!(t=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i)))return[0,0,0];var e=t[0];return 3===t[0].length&&(e=e.split("").map((function(t){return t+t})).join("")),[(t=parseInt(e,16))>>16&255,t>>8&255,255&t]},n.rgb.hcg=function(t){var e=t[0]/255,r=t[1]/255;t=t[2]/255;var n=Math.max(Math.max(e,r),t),i=Math.min(Math.min(e,r),t),o=n-i;return[(0>=o?0:n===e?(r-t)/o%6:n===r?2+(t-e)/o:(e-r)/o+8)/6%1*360,100*o,100*(1>o?i/(1-o):0)]},n.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=0;return 1>(e=.5>r?2*e*r:2*e*(1-r))&&(n=(r-.5*e)/(1-e)),[t[0],100*e,100*n]},n.hsv.hcg=function(t){var e=t[2]/100,r=t[1]/100*e,n=0;return 1>r&&(n=(e-r)/(1-r)),[t[0],100*r,100*n]},n.hcg.rgb=function(t){var e=t[1]/100,r=t[2]/100;if(0===e)return[255*r,255*r,255*r];var n=[0,0,0],i=(t=t[0]/360%1*6)%1,o=1-i;switch(Math.floor(t)){case 0:n[0]=1,n[1]=i,n[2]=0;break;case 1:n[0]=o,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=i;break;case 3:n[0]=0,n[1]=o,n[2]=1;break;case 4:n[0]=i,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=o}return r*=1-e,[255*(e*n[0]+r),255*(e*n[1]+r),255*(e*n[2]+r)]},n.hcg.hsv=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e),n=0;return 0<r&&(n=e/r),[t[0],100*n,100*r]},n.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100*(1-e)+.5*e,n=0;return 0<r&&.5>r?n=e/(2*r):.5<=r&&1>r&&(n=e/(2*(1-r))),[t[0],100*n,100*r]},n.hcg.hwb=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e);return[t[0],100*(r-e),100*(1-r)]},n.hwb.hcg=function(t){var e=1-t[2]/100,r=e-t[1]/100,n=0;return 1>r&&(n=(e-r)/(1-r)),[t[0],100*r,100*n]},n.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},n.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},n.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},n.gray.hsl=n.gray.hsv=function(t){return[0,0,t[0]]},n.gray.hwb=function(t){return[0,100,t[0]]},n.gray.cmyk=function(t){return[0,0,0,t[0]]},n.gray.lab=function(t){return[t[0],0,0]},n.gray.hex=function(t){return t=(((t=255&Math.round(t[0]/100*255))<<16)+(t<<8)+t).toString(16).toUpperCase(),"000000".substring(t.length)+t},n.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}})),Ut="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Nt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Yt=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},Wt=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);return void 0!==i?"value"in i?i.value:void 0===(r=i.get)?void 0:r.call(n):null!==(e=Object.getPrototypeOf(e))?t(e,r,n):void 0},Ht=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},qt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e},Zt=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},Vt=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},Xt={};Object.keys(It).forEach((function(t){Xt[t]={},Object.defineProperty(Xt[t],"channels",{value:It[t].channels}),Object.defineProperty(Xt[t],"labels",{value:It[t].labels});var e=function(t){for(var e={},r=Object.keys(It),n=r.length,o=0;o<n;o++)e[r[o]]={distance:-1,parent:null};for(r=[t],e[t].distance=0;r.length;){t=r.pop(),o=(n=Object.keys(It[t])).length;for(var a=0;a<o;a++){var s=n[a],u=e[s];-1===u.distance&&(u.distance=e[t].distance+1,u.parent=t,r.unshift(s))}}for(r={},n=(t=Object.keys(e)).length,o=0;o<n;o++){var l=t[o];if(null!==e[l].parent){a=l,u=[(s=e)[l].parent,l];var h=It[s[l].parent][l];for(l=s[l].parent;s[l].parent;)u.unshift(s[l].parent),h=i(It[s[l].parent][l],h),l=s[l].parent;h.conversion=u,r[a]=h}}return r}(t);Object.keys(e).forEach((function(r){var n=e[r];Xt[t][r]=function(t){var e=function(e){if(void 0===e||null===e)return e;1<arguments.length&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===("undefined"===typeof r?"undefined":Ut(r)))for(var n=r.length,i=0;i<n;i++)r[i]=Math.round(r[i]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}(n),Xt[t][r].raw=function(t){var e=function(e){return void 0===e||null===e?e:(1<arguments.length&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(n)}))}));var Gt=Xt,Jt=[].slice,$t=["keyword","gray","hex"],Qt={};Object.keys(Gt).forEach((function(t){Qt[Jt.call(Gt[t].labels).sort().join("")]=t}));var Kt={};o.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in zt.to?this:this.rgb();return t=1===(e=e.round("number"===typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha),zt.to[e.model](t)},percentString:function(t){return t=1===(t=this.rgb().round("number"===typeof t?t:1)).valpha?t.color:t.color.concat(this.valpha),zt.to.rgb.percent(t)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=Gt[this.model].channels,r=Gt[this.model].labels,n=0;n<e;n++)t[r[n]]=this.color[n];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new o(this.color.map((e=t,function(t){return Number(t.toFixed(e))})).concat(this.valpha),this.model);var e},alpha:function(t){return arguments.length?new o(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:a("rgb",0,s(255)),green:a("rgb",1,s(255)),blue:a("rgb",2,s(255)),hue:a(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:a("hsl",1,s(100)),lightness:a("hsl",2,s(100)),saturationv:a("hsv",1,s(100)),value:a("hsv",2,s(100)),chroma:a("hcg",1,s(100)),gray:a("hcg",2,s(100)),white:a("hwb",1,s(100)),wblack:a("hwb",2,s(100)),cyan:a("cmyk",0,s(100)),magenta:a("cmyk",1,s(100)),yellow:a("cmyk",2,s(100)),black:a("cmyk",3,s(100)),x:a("xyz",0,s(100)),y:a("xyz",1,s(100)),z:a("xyz",2,s(100)),l:a("lab",0,s(100)),a:a("lab",1),b:a("lab",2),keyword:function(t){return arguments.length?new o(t):Gt[this.model].keyword(this.color)},hex:function(t){return arguments.length?new o(t):zt.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],r=0;r<t.length;r++){var n=t[r]/255;e[r]=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity();return e>(t=t.luminosity())?(e+.05)/(t+.05):(t+.05)/(e+.05)},level:function(t){return 7.1<=(t=this.contrast(t))?"AAA":4.5<=t?"AA":""},isDark:function(){var t=this.rgb().color;return 128>(299*t[0]+587*t[1]+114*t[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;3>e;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color;return t=.3*t[0]+.59*t[1]+.11*t[2],o.rgb(t,t,t)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),r=e.color[0];return r=(r+t)%360,e.color[0]=0>r?360+r:r,e},mix:function(t,e){if(!t||!t.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof t?"undefined":Ut(t)));t=t.rgb();var r=this.rgb(),n=2*(e=void 0===e?.5:e)-1,i=t.alpha()-r.alpha();return i=1-(n=((-1===n*i?n:(n+i)/(1+n*i))+1)/2),o.rgb(n*t.red()+i*r.red(),n*t.green()+i*r.green(),n*t.blue()+i*r.blue(),t.alpha()*e+r.alpha()*(1-e))}},Object.keys(Gt).forEach((function(t){if(-1===$t.indexOf(t)){var e=Gt[t].channels;o.prototype[t]=function(){if(this.model===t)return new o(this);if(arguments.length)return new o(arguments,t);var r="number"===typeof arguments[e]?e:this.valpha,n=Gt[this.model][t].raw(this.color);return new o((n=Array.isArray(n)?n:[n]).concat(r),t)},o[t]=function(r){return"number"===typeof r&&(r=u(Jt.call(arguments),e)),new o(r,t)}}}));var te=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=n=t},e.toRadian=function(t){return t*i},e.equals=function(t,e){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var r=1e-6;e.EPSILON=r;var n="undefined"!==typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=n,e.RANDOM=Math.random;var i=Math.PI/180}));r(te);var ee=n((function(t,e){function r(t,e,r){var n=e[0],i=e[1],o=e[2];e=e[3];var a=r[0],s=r[1],u=r[2];return r=r[3],t[0]=n*a+o*s,t[1]=i*a+e*s,t[2]=n*u+o*r,t[3]=i*u+e*r,t}function n(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,r,n){var o=new i.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o},e.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},e.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*(e=e[3])-i*n;return o?(o=1/o,t[0]=e*o,t[1]=-n*o,t[2]=-i*o,t[3]=r*o,t):null},e.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=r,e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(r);return r=Math.cos(r),t[0]=n*r+o*a,t[1]=i*r+e*a,t[2]=n*-a+o*r,t[3]=i*-a+e*r,t},e.scale=function(t,e,r){var n=e[1],i=e[2],o=e[3],a=r[0];return r=r[1],t[0]=e[0]*a,t[1]=n*a,t[2]=i*r,t[3]=o*r,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=-r,t[3]=e,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=n,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],n=t[1],o=t[2];t=t[3];var a=e[0],s=e[1],u=e[2];return e=e[3],Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-u)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.mul=r,e.sub=n}));r(ee);var re=n((function(t,e){function r(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=r[0],l=r[1],h=r[2],c=r[3],f=r[4];return r=r[5],t[0]=n*u+o*l,t[1]=i*u+a*l,t[2]=n*h+o*c,t[3]=i*h+a*c,t[4]=n*f+o*r+s,t[5]=i*f+a*r+e,t}function n(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(6);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,r,n,o,a){var s=new i.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s[4]=o,s[5]=a,s},e.set=function(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4];e=e[5];var s=r*o-n*i;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-i*s,t[3]=r*s,t[4]=(i*e-o*a)*s,t[5]=(n*a-r*e)*s,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=r,e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=Math.sin(r);return r=Math.cos(r),t[0]=n*r+o*u,t[1]=i*r+a*u,t[2]=n*-u+o*r,t[3]=i*-u+a*r,t[4]=s,t[5]=e,t},e.scale=function(t,e,r){var n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=r[0];return r=r[1],t[0]=e[0]*u,t[1]=n*u,t[2]=i*r,t[3]=o*r,t[4]=a,t[5]=s,t},e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=r[0];return r=r[1],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=n*u+o*r+s,t[5]=i*u+a*r+e,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=-r,t[3]=e,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},e.subtract=n,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4];t=t[5];var u=e[0],l=e[1],h=e[2],c=e[3],f=e[4];return e=e[5],Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-h)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-f)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.mul=r,e.sub=n}));r(re);var ne=n((function(t,e){function r(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=r[0],f=r[1],p=r[2],d=r[3],v=r[4],g=r[5],m=r[6],y=r[7];return r=r[8],t[0]=c*n+f*a+p*l,t[1]=c*i+f*s+p*h,t[2]=c*o+f*u+p*e,t[3]=d*n+v*a+g*l,t[4]=d*i+v*s+g*h,t[5]=d*o+v*u+g*e,t[6]=m*n+y*a+r*l,t[7]=m*i+y*s+r*h,t[8]=m*o+y*u+r*e,t}function n(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new i.ARRAY_TYPE(9);return i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,r,n,o,a,s,u,l){var h=new i.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=o,h[5]=a,h[6]=s,h[7]=u,h[8]=l,h},e.set=function(t,e,r,n,i,o,a,s,u,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=(e=e[8])*a-s*l,c=-e*o+s*u,f=l*o-a*u,p=r*h+n*c+i*f;return p?(p=1/p,t[0]=h*p,t[1]=(-e*n+i*l)*p,t[2]=(s*n-i*a)*p,t[3]=c*p,t[4]=(e*r-i*u)*p,t[5]=(-s*r+i*o)*p,t[6]=f*p,t[7]=(-l*r+n*u)*p,t[8]=(a*r-n*o)*p,t):null},e.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];return e=e[8],t[0]=a*e-s*l,t[1]=i*l-n*e,t[2]=n*s-i*a,t[3]=s*u-o*e,t[4]=r*e-i*u,t[5]=i*o-r*s,t[6]=o*l-a*u,t[7]=n*u-r*l,t[8]=r*a-n*o,t},e.determinant=function(t){var e=t[3],r=t[4],n=t[5],i=t[6],o=t[7],a=t[8];return t[0]*(a*r-n*o)+t[1]*(-a*e+n*i)+t[2]*(o*e-r*i)},e.multiply=r,e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=r[0];return r=r[1],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c*n+r*a+l,t[7]=c*i+r*s+h,t[8]=c*o+r*u+e,t},e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var c=Math.sin(r);return r=Math.cos(r),t[0]=r*n+c*a,t[1]=r*i+c*s,t[2]=r*o+c*u,t[3]=r*a-c*n,t[4]=r*s-c*i,t[5]=r*u-c*o,t[6]=l,t[7]=h,t[8]=e,t},e.scale=function(t,e,r){var n=r[0];return r=r[1],t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=r+r,a=n+n,s=i+i;r*=o;var u=n*o;n*=a;var l=i*o,h=i*a;return i*=s,o*=e=e[3],a*=e,e*=s,t[0]=1-n-i,t[3]=u-e,t[6]=l+a,t[1]=u+e,t[4]=1-r-i,t[7]=h-o,t[2]=l-a,t[5]=h+o,t[8]=1-r-n,t},e.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=r*s-n*a,y=r*u-i*a,b=r*l-o*a,x=n*u-i*s,_=n*l-o*s,w=i*l-o*u,M=h*v-c*d,E=h*g-f*d,T=c*g-f*v;return(p=m*(f=f*(e=e[15])-p*g)-y*(c=c*e-p*v)+b*T+x*(h=h*e-p*d)-_*E+w*M)?(p=1/p,t[0]=(s*f-u*c+l*T)*p,t[1]=(u*h-a*f-l*E)*p,t[2]=(a*c-s*h+l*M)*p,t[3]=(i*c-n*f-o*T)*p,t[4]=(r*f-i*h+o*E)*p,t[5]=(n*h-r*c-o*M)*p,t[6]=(v*w-g*_+e*x)*p,t[7]=(g*b-d*w-e*y)*p,t[8]=(d*_-v*b+e*m)*p,t):null},e.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},e.subtract=n,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var r=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7];t=t[8];var c=e[0],f=e[1],p=e[2],d=e[3],v=e[4],g=e[5],m=e[6],y=e[7];return e=e[8],Math.abs(r-c)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-v)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-g)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-m)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-y)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var i=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.mul=r,e.sub=n}));r(ne);var ie=n((function(t,e){function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],p=e[10],d=e[11],v=e[12],g=e[13],m=e[14];e=e[15];var y=r[0],b=r[1],x=r[2],_=r[3];return t[0]=y*n+b*s+x*c+_*v,t[1]=y*i+b*u+x*f+_*g,t[2]=y*o+b*l+x*p+_*m,t[3]=y*a+b*h+x*d+_*e,y=r[4],b=r[5],x=r[6],_=r[7],t[4]=y*n+b*s+x*c+_*v,t[5]=y*i+b*u+x*f+_*g,t[6]=y*o+b*l+x*p+_*m,t[7]=y*a+b*h+x*d+_*e,y=r[8],b=r[9],x=r[10],_=r[11],t[8]=y*n+b*s+x*c+_*v,t[9]=y*i+b*u+x*f+_*g,t[10]=y*o+b*l+x*p+_*m,t[11]=y*a+b*h+x*d+_*e,y=r[12],b=r[13],x=r[14],_=r[15],t[12]=y*n+b*s+x*c+_*v,t[13]=y*i+b*u+x*f+_*g,t[14]=y*o+b*l+x*p+_*m,t[15]=y*a+b*h+x*d+_*e,t}function i(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,l=o+o;e=n*s;var h=n*u;n*=l;var c=i*u;return i*=l,o*=l,s*=a,u*=a,a*=l,t[0]=1-(c+o),t[1]=h+a,t[2]=n-u,t[3]=0,t[4]=h-a,t[5]=1-(e+o),t[6]=i+s,t[7]=0,t[8]=n+u,t[9]=i-s,t[10]=1-(e+c),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,r,n,i,o,s,u,l,h,c,f,p,d,v,g){var m=new a.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=i,m[5]=o,m[6]=s,m[7]=u,m[8]=l,m[9]=h,m[10]=c,m[11]=f,m[12]=p,m[13]=d,m[14]=v,m[15]=g,m},e.set=function(t,e,r,n,i,o,a,s,u,l,h,c,f,p,d,v,g){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=f,t[12]=p,t[13]=d,t[14]=v,t[15]=g,t},e.identity=r,e.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=r*s-n*a,y=r*u-i*a,b=r*l-o*a,x=n*u-i*s,_=n*l-o*s,w=i*l-o*u,M=h*v-c*d,E=h*g-f*d,T=h*(e=e[15])-p*d,P=c*g-f*v,A=c*e-p*v,S=f*e-p*g,L=m*S-y*A+b*P+x*T-_*E+w*M;return L?(L=1/L,t[0]=(s*S-u*A+l*P)*L,t[1]=(i*A-n*S-o*P)*L,t[2]=(v*w-g*_+e*x)*L,t[3]=(f*_-c*w-p*x)*L,t[4]=(u*T-a*S-l*E)*L,t[5]=(r*S-i*T+o*E)*L,t[6]=(g*b-d*w-e*y)*L,t[7]=(h*w-f*b+p*y)*L,t[8]=(a*A-s*T+l*M)*L,t[9]=(n*T-r*A-o*M)*L,t[10]=(d*_-v*b+e*m)*L,t[11]=(c*b-h*_-p*m)*L,t[12]=(s*E-a*P-u*M)*L,t[13]=(r*P-n*E+i*M)*L,t[14]=(v*y-d*x-g*m)*L,t[15]=(h*x-c*y+f*m)*L,t):null},e.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14];return e=e[15],t[0]=s*(f*e-p*g)-c*(u*e-l*g)+v*(u*p-l*f),t[1]=-(n*(f*e-p*g)-c*(i*e-o*g)+v*(i*p-o*f)),t[2]=n*(u*e-l*g)-s*(i*e-o*g)+v*(i*l-o*u),t[3]=-(n*(u*p-l*f)-s*(i*p-o*f)+c*(i*l-o*u)),t[4]=-(a*(f*e-p*g)-h*(u*e-l*g)+d*(u*p-l*f)),t[5]=r*(f*e-p*g)-h*(i*e-o*g)+d*(i*p-o*f),t[6]=-(r*(u*e-l*g)-a*(i*e-o*g)+d*(i*l-o*u)),t[7]=r*(u*p-l*f)-a*(i*p-o*f)+h*(i*l-o*u),t[8]=a*(c*e-p*v)-h*(s*e-l*v)+d*(s*p-l*c),t[9]=-(r*(c*e-p*v)-h*(n*e-o*v)+d*(n*p-o*c)),t[10]=r*(s*e-l*v)-a*(n*e-o*v)+d*(n*l-o*s),t[11]=-(r*(s*p-l*c)-a*(n*p-o*c)+h*(n*l-o*s)),t[12]=-(a*(c*g-f*v)-h*(s*g-u*v)+d*(s*f-u*c)),t[13]=r*(c*g-f*v)-h*(n*g-i*v)+d*(n*f-i*c),t[14]=-(r*(s*g-u*v)-a*(n*g-i*v)+d*(n*u-i*s)),t[15]=r*(s*f-u*c)-a*(n*f-i*c)+h*(n*u-i*s),t},e.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],h=t[9],c=t[10],f=t[11],p=t[12],d=t[13],v=t[14];return(e*a-r*o)*(c*(t=t[15])-f*v)-(e*s-n*o)*(h*t-f*d)+(e*u-i*o)*(h*v-c*d)+(r*s-n*a)*(l*t-f*p)-(r*u-i*a)*(l*v-c*p)+(n*u-i*s)*(l*d-h*p)},e.multiply=n,e.translate=function(t,e,r){var n=r[0],i=r[1];if(r=r[2],e===t)t[12]=e[0]*n+e[4]*i+e[8]*r+e[12],t[13]=e[1]*n+e[5]*i+e[9]*r+e[13],t[14]=e[2]*n+e[6]*i+e[10]*r+e[14],t[15]=e[3]*n+e[7]*i+e[11]*r+e[15];else{var o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7],p=e[8],d=e[9],v=e[10],g=e[11];t[0]=o,t[1]=a,t[2]=s,t[3]=u,t[4]=l,t[5]=h,t[6]=c,t[7]=f,t[8]=p,t[9]=d,t[10]=v,t[11]=g,t[12]=o*n+l*i+p*r+e[12],t[13]=a*n+h*i+d*r+e[13],t[14]=s*n+c*i+v*r+e[14],t[15]=u*n+f*i+g*r+e[15]}return t},e.scale=function(t,e,r){var n=r[0],i=r[1];return r=r[2],t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,r,n){var i=n[0],o=n[1];n=n[2];var s=Math.sqrt(i*i+o*o+n*n);if(s<a.EPSILON)return null;i*=s=1/s,o*=s,n*=s;var u=Math.sin(r),l=Math.cos(r),h=1-l;r=e[0],s=e[1];var c=e[2],f=e[3],p=e[4],d=e[5],v=e[6],g=e[7],m=e[8],y=e[9],b=e[10],x=e[11],_=i*i*h+l,w=o*i*h+n*u,M=n*i*h-o*u,E=i*o*h-n*u,T=o*o*h+l,P=n*o*h+i*u,A=i*n*h+o*u;return i=o*n*h-i*u,o=n*n*h+l,t[0]=r*_+p*w+m*M,t[1]=s*_+d*w+y*M,t[2]=c*_+v*w+b*M,t[3]=f*_+g*w+x*M,t[4]=r*E+p*T+m*P,t[5]=s*E+d*T+y*P,t[6]=c*E+v*T+b*P,t[7]=f*E+g*T+x*P,t[8]=r*A+p*i+m*o,t[9]=s*A+d*i+y*o,t[10]=c*A+v*i+b*o,t[11]=f*A+g*i+x*o,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},e.rotateX=function(t,e,r){var n=Math.sin(r);r=Math.cos(r);var i=e[4],o=e[5],a=e[6],s=e[7],u=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*r+u*n,t[5]=o*r+l*n,t[6]=a*r+h*n,t[7]=s*r+c*n,t[8]=u*r-i*n,t[9]=l*r-o*n,t[10]=h*r-a*n,t[11]=c*r-s*n,t},e.rotateY=function(t,e,r){var n=Math.sin(r);r=Math.cos(r);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r-u*n,t[1]=o*r-l*n,t[2]=a*r-h*n,t[3]=s*r-c*n,t[8]=i*n+u*r,t[9]=o*n+l*r,t[10]=a*n+h*r,t[11]=s*n+c*r,t},e.rotateZ=function(t,e,r){var n=Math.sin(r);r=Math.cos(r);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],l=e[5],h=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r+u*n,t[1]=o*r+l*n,t[2]=a*r+h*n,t[3]=s*r+c*n,t[4]=u*r-i*n,t[5]=l*r-o*n,t[6]=h*r-a*n,t[7]=c*r-s*n,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,r){var n=r[0],i=r[1];r=r[2];var o=Math.sqrt(n*n+i*i+r*r);if(o<a.EPSILON)return null;n*=o=1/o,i*=o,r*=o,o=Math.sin(e);var s=1-(e=Math.cos(e));return t[0]=n*n*s+e,t[1]=i*n*s+r*o,t[2]=r*n*s-i*o,t[3]=0,t[4]=n*i*s-r*o,t[5]=i*i*s+e,t[6]=r*i*s+n*o,t[7]=0,t[8]=n*r*s+i*o,t[9]=i*r*s-n*o,t[10]=r*r*s+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromXRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=i,e.fromQuat2=function(t,e){var r=new a.ARRAY_TYPE(3),n=-e[0],o=-e[1],s=-e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7],p=n*n+o*o+s*s+u*u;return 0<p?(r[0]=2*(l*u+f*n+h*s-c*o)/p,r[1]=2*(h*u+f*o+c*n-l*s)/p,r[2]=2*(c*u+f*s+l*o-h*n)/p):(r[0]=2*(l*u+f*n+h*s-c*o),r[1]=2*(h*u+f*o+c*n-l*s),r[2]=2*(c*u+f*s+l*o-h*n)),i(t,e,r),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9];return e=e[10],t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+a*a+s*s),t[2]=Math.sqrt(u*u+l*l+e*e),t},e.getRotation=function(t,e){var r=e[0]+e[5]+e[10];return 0<r?(r=2*Math.sqrt(r+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},e.fromRotationTranslationScale=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,h=a+a;e=i*u;var c=i*l;i*=h;var f=o*l;o*=h,a*=h,u*=s,l*=s,s*=h,h=n[0];var p=n[1];return n=n[2],t[0]=(1-(f+a))*h,t[1]=(c+s)*h,t[2]=(i-l)*h,t[3]=0,t[4]=(c-s)*p,t[5]=(1-(e+a))*p,t[6]=(o+u)*p,t[7]=0,t[8]=(i+l)*n,t[9]=(o-u)*n,t[10]=(1-(e+f))*n,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,h=a+a,c=s+s;e=o*l;var f=o*h,p=o*c;o=a*h,a*=c;var d=s*c;s=u*l,h*=u;var v=u*c,g=n[0],m=n[1];c=n[2],n=i[0],u=i[1],i=i[2],l=(1-(o+d))*g;var y=(f+v)*g;return g*=p-h,f=(f-v)*m,d=(1-(e+d))*m,m*=a+s,p=(p+h)*c,a=(a-s)*c,e=(1-(e+o))*c,t[0]=l,t[1]=y,t[2]=g,t[3]=0,t[4]=f,t[5]=d,t[6]=m,t[7]=0,t[8]=p,t[9]=a,t[10]=e,t[11]=0,t[12]=r[0]+n-(l*n+f*u+p*i),t[13]=r[1]+u-(y*n+d*u+a*i),t[14]=r[2]+i-(g*n+m*u+e*i),t[15]=1,t},e.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=r+r,a=n+n,s=i+i;r*=o;var u=n*o;n*=a;var l=i*o,h=i*a;return i*=s,o*=e=e[3],a*=e,e*=s,t[0]=1-n-i,t[1]=u+e,t[2]=l-a,t[3]=0,t[4]=u-e,t[5]=1-r-i,t[6]=h+o,t[7]=0,t[8]=l+a,t[9]=h-o,t[10]=1-r-n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},e.perspective=function(t,e,r,n,i){return e=1/Math.tan(e/2),t[0]=e/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&1/0!==i?(r=1/(n-i),t[10]=(i+n)*r,t[14]=2*i*n*r):(t[10]=-1,t[14]=-2*n),t},e.perspectiveFromFieldOfView=function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=2/(a+(e=Math.tan(e.rightDegrees*Math.PI/180))),u=2/(i+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-e)*s*.5,t[9]=(i-o)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},e.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t},e.lookAt=function(t,e,n,i){var o=e[0],s=e[1];e=e[2];var u=i[0],l=i[1],h=i[2],c=n[0];i=n[1];var f=n[2];if(Math.abs(o-c)<a.EPSILON&&Math.abs(s-i)<a.EPSILON&&Math.abs(e-f)<a.EPSILON)return r(t);n=o-c,i=s-i,c=e-f;var p=1/Math.sqrt(n*n+i*i+c*c);f=l*(c*=p)-h*(i*=p),h=h*(n*=p)-u*c,u=u*i-l*n,(p=Math.sqrt(f*f+h*h+u*u))?(f*=p=1/p,h*=p,u*=p):u=h=f=0,l=i*u-c*h;var d=c*f-n*u,v=n*h-i*f;return(p=Math.sqrt(l*l+d*d+v*v))?(l*=p=1/p,d*=p,v*=p):v=d=l=0,t[0]=f,t[1]=l,t[2]=n,t[3]=0,t[4]=h,t[5]=d,t[6]=i,t[7]=0,t[8]=u,t[9]=v,t[10]=c,t[11]=0,t[12]=-(f*o+h*s+u*e),t[13]=-(l*o+d*s+v*e),t[14]=-(n*o+i*s+c*e),t[15]=1,t},e.targetTo=function(t,e,r,n){var i=e[0],o=e[1];e=e[2];var a=n[0],s=n[1],u=n[2];n=i-r[0];var l=o-r[1],h=n*n+l*l+(r=e-r[2])*r;0<h&&(n*=h=1/Math.sqrt(h),l*=h,r*=h);var c=s*r-u*l;return 0<(h=c*c+(u=u*n-a*r)*u+(a=a*l-s*n)*a)&&(c*=h=1/Math.sqrt(h),u*=h,a*=h),t[0]=c,t[1]=u,t[2]=a,t[3]=0,t[4]=l*a-r*u,t[5]=r*c-n*a,t[6]=n*u-l*c,t[7]=0,t[8]=n,t[9]=l,t[10]=r,t[11]=0,t[12]=i,t[13]=o,t[14]=e,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},e.subtract=o,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],c=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14];t=t[15];var y=e[0],b=e[1],x=e[2],_=e[3],w=e[4],M=e[5],E=e[6],T=e[7],P=e[8],A=e[9],S=e[10],L=e[11],O=e[12],R=e[13],C=e[14];return e=e[15],Math.abs(r-y)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-x)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-_)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-w)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-M)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(l-E)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-T)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-P)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-A)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(p-S)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(d-L)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(v-O)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(g-R)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-C)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.mul=n,e.sub=o}));r(ie);var oe=n((function(t,e){function r(){var t=new p.ARRAY_TYPE(3);return p.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t){var e=t[0],r=t[1];return t=t[2],Math.sqrt(e*e+r*r+t*t)}function i(t,e,r){var n=new p.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function a(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function s(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function u(t,e){var r=e[0]-t[0],n=e[1]-t[1];return t=e[2]-t[2],Math.sqrt(r*r+n*n+t*t)}function l(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n+(t=e[2]-t[2])*t}function h(t){var e=t[0],r=t[1];return e*e+r*r+(t=t[2])*t}function c(t,e){var r=e[0],n=e[1],i=e[2];return 0<(r=r*r+n*n+i*i)&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function f(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new p.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=n,e.fromValues=i,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},e.subtract=o,e.multiply=a,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},e.distance=u,e.squaredDistance=l,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=c,e.dot=f,e.cross=function(t,e,r){var n=e[0],i=e[1];e=e[2];var o=r[0],a=r[1];return r=r[2],t[0]=i*r-e*a,t[1]=e*o-n*r,t[2]=n*a-i*o,t},e.lerp=function(t,e,r,n){var i=e[0],o=e[1];return e=e[2],t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=e+n*(r[2]-e),t},e.hermite=function(t,e,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1);return o=a*(3-2*o),t[0]=e[0]*s+r[0]*u+n[0]*l+i[0]*o,t[1]=e[1]*s+r[1]*u+n[1]*l+i[1]*o,t[2]=e[2]*s+r[2]*u+n[2]*l+i[2]*o,t},e.bezier=function(t,e,r,n,i,o){var a=1-o,s=a*a,u=o*o,l=s*a;return s*=3*o,a*=3*u,o*=u,t[0]=e[0]*l+r[0]*s+n[0]*a+i[0]*o,t[1]=e[1]*l+r[1]*s+n[1]*a+i[1]*o,t[2]=e[2]*l+r[2]*s+n[2]*a+i[2]*o,t},e.random=function(t,e){e=e||1;var r=2*p.RANDOM()*Math.PI,n=2*p.RANDOM()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t},e.transformMat4=function(t,e,r){var n=e[0],i=e[1];e=e[2];var o=r[3]*n+r[7]*i+r[11]*e+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*e+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*e+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*e+r[14])/o,t},e.transformMat3=function(t,e,r){var n=e[0],i=e[1];return e=e[2],t[0]=n*r[0]+i*r[3]+e*r[6],t[1]=n*r[1]+i*r[4]+e*r[7],t[2]=n*r[2]+i*r[5]+e*r[8],t},e.transformQuat=function(t,e,r){var n=r[0],i=r[1],o=r[2],a=e[0],s=e[1],u=i*(e=e[2])-o*s,l=o*a-n*e,h=n*s-i*a;return r=2*r[3],t[0]=a+u*r+2*(i*h-o*l),t[1]=s+l*r+2*(o*u-n*h),t[2]=e+h*r+2*(n*l-i*u),t},e.rotateX=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.rotateY=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.rotateZ=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.angle=function(t,e){return t=i(t[0],t[1],t[2]),e=i(e[0],e[1],e[2]),c(t,t),c(e,e),1<(e=f(t,e))?0:-1>e?Math.PI:Math.acos(e)},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var r=t[0],n=t[1];t=t[2];var i=e[0],o=e[1];return e=e[2],Math.abs(r-i)<=p.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=p.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(t-e)<=p.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.sub=o,e.mul=a,e.div=s,e.dist=u,e.sqrDist=l,e.len=n,e.sqrLen=h,t=function(){var t=r();return function(e,r,n,i,o,a){for(r||(r=3),n||(n=0),i=i?Math.min(i*r+n,e.length):e.length;n<i;n+=r)t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],o(t,t,a),e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2];return e}}(),e.forEach=t}));r(oe);var ae=n((function(t,e){function r(){var t=new h.ARRAY_TYPE(4);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function n(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function i(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function o(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function a(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return t=e[3]-t[3],Math.sqrt(r*r+n*n+i*i+t*t)}function s(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i+(t=e[3]-t[3])*t}function u(t){var e=t[0],r=t[1],n=t[2];return t=t[3],Math.sqrt(e*e+r*r+n*n+t*t)}function l(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n+(t=t[3])*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new h.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,r,n){var i=new h.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=n,e.multiply=i,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i+(e=e[3])*e;return 0<o&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=e*o,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.cross=function(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1];r=r[2]*n[3]-r[3]*n[2],n=e[0];var l=e[1],h=e[2];return e=e[3],t[0]=l*r-h*u+e*s,t[1]=-n*r+h*a-e*o,t[2]=n*u-l*a+e*i,t[3]=-n*s+l*o-h*i,t},e.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return e=e[3],t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=e+n*(r[3]-e),t},e.random=function(t,e){e=e||1;do{var r=2*h.RANDOM()-1,n=2*h.RANDOM()-1,i=r*r+n*n}while(1<=i);do{var o=2*h.RANDOM()-1,a=2*h.RANDOM()-1,s=o*o+a*a}while(1<=s);return i=Math.sqrt((1-i)/s),t[0]=e*r,t[1]=e*n,t[2]=e*o*i,t[3]=e*a*i,t},e.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2];return e=e[3],t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*e,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*e,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*e,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*e,t},e.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=(r=r[3])*n+s*o-u*i,h=r*i+u*n-a*o,c=r*o+a*i-s*n;return n=-a*n-s*i-u*o,t[0]=l*r+n*-a+h*-u-c*-s,t[1]=h*r+n*-s+c*-a-l*-u,t[2]=c*r+n*-u+l*-s-h*-a,t[3]=e[3],t},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2];t=t[3];var o=e[0],a=e[1],s=e[2];return e=e[3],Math.abs(r-o)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.sub=n,e.mul=i,e.div=o,e.dist=a,e.sqrDist=s,e.len=u,e.sqrLen=l,t=function(){var t=r();return function(e,r,n,i,o,a){for(r||(r=4),n||(n=0),i=i?Math.min(i*r+n,e.length):e.length;n<i;n+=r)t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],o(t,t,a),e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3];return e}}(),e.forEach=t}));r(ae);var se=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}function n(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function i(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function o(t,e,r){var n=e[0],i=e[1],o=e[2];e=e[3];var a=r[0],s=r[1],u=r[2];return r=r[3],t[0]=n*r+e*a+i*u-o*s,t[1]=i*r+e*s+o*a-n*u,t[2]=o*r+e*u+n*s-i*a,t[3]=e*r-n*a-i*s-o*u,t}function a(t,e,r,n){var i=e[0],o=e[1],a=e[2];e=e[3];var s=r[0],l=r[1],h=r[2],c=i*s+o*l+a*h+e*(r=r[3]);if(0>c&&(c=-c,s=-s,l=-l,h=-h,r=-r),1-c>u.EPSILON){var f=Math.acos(c),p=Math.sin(f);c=Math.sin((1-n)*f)/p,n=Math.sin(n*f)/p}else c=1-n;return t[0]=c*i+n*s,t[1]=c*o+n*l,t[2]=c*a+n*h,t[3]=c*e+n*r,t}function s(t,e){var r=e[0]+e[4]+e[8];if(0<r)r=Math.sqrt(r+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var i=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+n]+e[3*n+i])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=i,e.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>u.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},e.multiply=o,e.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(r);return r=Math.cos(r),t[0]=n*r+e*a,t[1]=i*r+o*a,t[2]=o*r-i*a,t[3]=e*r-n*a,t},e.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(r);return r=Math.cos(r),t[0]=n*r-o*a,t[1]=i*r+e*a,t[2]=o*r+n*a,t[3]=e*r-i*a,t},e.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2];e=e[3];var a=Math.sin(r);return r=Math.cos(r),t[0]=n*r+i*a,t[1]=i*r-n*a,t[2]=o*r+e*a,t[3]=e*r-o*a,t},e.calculateW=function(t,e){var r=e[0],n=e[1];return e=e[2],t[0]=r,t[1]=n,t[2]=e,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-e*e)),t},e.slerp=a,e.random=function(t){var e=u.RANDOM(),r=u.RANDOM(),n=u.RANDOM(),i=Math.sqrt(1-e);return e=Math.sqrt(e),t[0]=i*Math.sin(2*Math.PI*r),t[1]=i*Math.cos(2*Math.PI*r),t[2]=e*Math.sin(2*Math.PI*n),t[3]=e*Math.cos(2*Math.PI*n),t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i+(e=e[3])*e;return o=o?1/o:0,t[0]=-r*o,t[1]=-n*o,t[2]=-i*o,t[3]=e*o,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=s,e.fromEuler=function(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i,i=Math.sin(e),e=Math.cos(e);var o=Math.sin(r);r=Math.cos(r);var a=Math.sin(n);return n=Math.cos(n),t[0]=i*r*n-e*o*a,t[1]=e*o*n+i*r*a,t[2]=e*r*a-i*o*n,t[3]=e*r*n+i*o*a,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0;var u=r(te),l=r(ne),h=r(oe);t=r(ae),e.clone=t.clone,e.fromValues=t.fromValues,e.copy=t.copy,e.set=t.set,e.add=t.add,e.mul=o,e.scale=t.scale,e.dot=t.dot,e.lerp=t.lerp;var c=t.length;e.length=c,e.len=c,c=t.squaredLength,e.squaredLength=c,e.sqrLen=c;var f=t.normalize;e.normalize=f,e.exactEquals=t.exactEquals,e.equals=t.equals,t=function(){var t=h.create(),e=h.fromValues(1,0,0),r=h.fromValues(0,1,0);return function(n,o,a){var s=h.dot(o,a);return-.999999>s?(h.cross(t,e,o),1e-6>h.len(t)&&h.cross(t,r,o),h.normalize(t,t),i(n,t,Math.PI),n):.999999<s?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(h.cross(t,o,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,f(n,n))}}(),e.rotationTo=t,t=function(){var t=n(),e=n();return function(r,n,i,o,s,u){return a(t,n,s,u),a(e,i,o,u),a(r,t,e,2*u*(1-u)),r}}(),e.sqlerp=t,t=function(){var t=l.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],f(e,s(e,t))}}(),e.setAxes=t}));r(se);var ue=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}function n(t,e,r){var n=.5*r[0],i=.5*r[1];r=.5*r[2];var o=e[0],a=e[1],s=e[2];return e=e[3],t[0]=o,t[1]=a,t[2]=s,t[3]=e,t[4]=n*e+i*s-r*a,t[5]=i*e+r*o-n*s,t[6]=r*e+n*a-i*o,t[7]=-n*o-i*a-r*s,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function o(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[4],u=r[5],l=r[6],h=r[7],c=e[4],f=e[5],p=e[6];e=e[7];var d=r[0],v=r[1],g=r[2];return r=r[3],t[0]=n*r+a*d+i*g-o*v,t[1]=i*r+a*v+o*d-n*g,t[2]=o*r+a*g+n*v-i*d,t[3]=a*r-n*d-i*v-o*g,t[4]=n*h+a*s+i*l-o*u+c*r+e*d+f*g-p*v,t[5]=i*h+a*u+o*s-n*l+f*r+e*v+p*d-c*g,t[6]=o*h+a*l+n*u-i*s+p*r+e*g+c*v-f*d,t[7]=a*h-n*s-i*u-o*l+e*r-c*d-f*v-p*g,t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,r,n,i,o,s,u){var l=new a.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=r,l[3]=n,l[4]=i,l[5]=o,l[6]=s,l[7]=u,l},e.fromRotationTranslationValues=function(t,e,r,n,i,o,s){var u=new a.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,i*=.5,o*=.5,s*=.5,u[4]=i*n+o*r-s*e,u[5]=o*n+s*t-i*r,u[6]=s*n+i*e-o*t,u[7]=-i*t-o*e-s*r,u},e.fromRotationTranslation=n,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var r=s.create();u.getRotation(r,e);var i=new a.ARRAY_TYPE(3);return u.getTranslation(i,e),n(t,r,i),t},e.copy=i,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,r,n,i,o,a,s,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var r=e[4],n=e[5],i=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2];return e=e[3],t[0]=2*(r*e+o*a+n*u-i*s),t[1]=2*(n*e+o*s+i*a-r*u),t[2]=2*(i*e+o*u+r*s-n*a),t},e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=.5*r[0],u=.5*r[1];r=.5*r[2];var l=e[4],h=e[5],c=e[6];return e=e[7],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*r-o*u+l,t[5]=a*u+o*s-n*r+h,t[6]=a*r+n*u-i*s+c,t[7]=-n*s-i*u-o*r+e,t},e.rotateX=function(t,e,r){var n=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*n+l*o-h*i,p=l*a+c*i+h*n-u*o,d=h*a+c*o+u*i-l*n;return u=c*a-u*n-l*i-h*o,s.rotateX(t,e,r),n=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*n+p*o-d*i,t[5]=p*a+u*i+d*n-f*o,t[6]=d*a+u*o+f*i-p*n,t[7]=u*a-f*n-p*i-d*o,t},e.rotateY=function(t,e,r){var n=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*n+l*o-h*i,p=l*a+c*i+h*n-u*o,d=h*a+c*o+u*i-l*n;return u=c*a-u*n-l*i-h*o,s.rotateY(t,e,r),n=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*n+p*o-d*i,t[5]=p*a+u*i+d*n-f*o,t[6]=d*a+u*o+f*i-p*n,t[7]=u*a-f*n-p*i-d*o,t},e.rotateZ=function(t,e,r){var n=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=u*a+c*n+l*o-h*i,p=l*a+c*i+h*n-u*o,d=h*a+c*o+u*i-l*n;return u=c*a-u*n-l*i-h*o,s.rotateZ(t,e,r),n=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+u*n+p*o-d*i,t[5]=p*a+u*i+d*n-f*o,t[6]=d*a+u*o+f*i-p*n,t[7]=u*a-f*n-p*i-d*o,t},e.rotateByQuatAppend=function(t,e,r){var n=r[0],i=r[1],o=r[2];r=r[3];var a=e[0],s=e[1],u=e[2],l=e[3];return t[0]=a*r+l*n+s*o-u*i,t[1]=s*r+l*i+u*n-a*o,t[2]=u*r+l*o+a*i-s*n,t[3]=l*r-a*n-s*i-u*o,a=e[4],s=e[5],u=e[6],l=e[7],t[4]=a*r+l*n+s*o-u*i,t[5]=s*r+l*i+u*n-a*o,t[6]=u*r+l*o+a*i-s*n,t[7]=l*r-a*n-s*i-u*o,t},e.rotateByQuatPrepend=function(t,e,r){var n=e[0],i=e[1],o=e[2];e=e[3];var a=r[0],s=r[1],u=r[2],l=r[3];return t[0]=n*l+e*a+i*u-o*s,t[1]=i*l+e*s+o*a-n*u,t[2]=o*l+e*u+n*s-i*a,t[3]=e*l-n*a-i*s-o*u,a=r[4],s=r[5],u=r[6],l=r[7],t[4]=n*l+e*a+i*u-o*s,t[5]=i*l+e*s+o*a-n*u,t[6]=o*l+e*u+n*s-i*a,t[7]=e*l-n*a-i*s-o*u,t},e.rotateAroundAxis=function(t,e,r,n){if(Math.abs(n)<a.EPSILON)return i(t,e);var o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);n*=.5;var s=Math.sin(n),u=s*r[0]/o,l=s*r[1]/o;r=s*r[2]/o,n=Math.cos(n),o=e[0],s=e[1];var h=e[2],c=e[3];return t[0]=o*n+c*u+s*r-h*l,t[1]=s*n+c*l+h*u-o*r,t[2]=h*n+c*r+o*l-s*u,t[3]=c*n-o*u-s*l-h*r,o=e[4],s=e[5],h=e[6],e=e[7],t[4]=o*n+e*u+s*r-h*l,t[5]=s*n+e*l+h*u-o*r,t[6]=h*n+e*r+o*l-s*u,t[7]=e*n-o*u-s*l-h*r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},e.multiply=o,e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},e.lerp=function(t,e,r,n){var i=1-n;return 0>l(e,r)&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t},e.invert=function(t,e){var r=h(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var r=h(e);if(0<r){r=Math.sqrt(r);var n=e[0]/r,i=e[1]/r,o=e[2]/r,a=e[3]/r,s=e[4],u=e[5],l=e[6],c=n*s+i*u+o*l+a*(e=e[7]);t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-n*c)/r,t[5]=(u-i*c)/r,t[6]=(l-o*c)/r,t[7]=(e-a*c)/r}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],u=t[5],l=t[6];t=t[7];var h=e[0],c=e[1],f=e[2],p=e[3],d=e[4],v=e[5],g=e[6];return e=e[7],Math.abs(r-h)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-f)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-d)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-v)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-g)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0;var a=r(te),s=r(se),u=r(ie);e.getReal=s.copy,e.setReal=s.copy,e.mul=o;var l=s.dot;e.dot=l,t=s.length,e.length=t,e.len=t;var h=s.squaredLength;e.squaredLength=h,e.sqrLen=h}));r(ue);var le=n((function(t,e){function r(){var t=new h.ARRAY_TYPE(2);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function n(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function i(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function o(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function a(t,e){var r=e[0]-t[0];return t=e[1]-t[1],Math.sqrt(r*r+t*t)}function s(t,e){var r=e[0]-t[0];return r*r+(t=e[1]-t[1])*t}function u(t){var e=t[0];return t=t[1],Math.sqrt(e*e+t*t)}function l(t){var e=t[0];return e*e+(t=t[1])*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new h.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var r=new h.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,r){return t[0]=e,t[1]=r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},e.subtract=n,e.multiply=i,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var r=e[0],n=e[1];return 0<(r=r*r+n*n)&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,r){return e=e[0]*r[1]-e[1]*r[0],t[0]=t[1]=0,t[2]=e,t},e.lerp=function(t,e,r,n){var i=e[0];return e=e[1],t[0]=i+n*(r[0]-i),t[1]=e+n*(r[1]-e),t},e.random=function(t,e){e=e||1;var r=2*h.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},e.transformMat2=function(t,e,r){var n=e[0];return e=e[1],t[0]=r[0]*n+r[2]*e,t[1]=r[1]*n+r[3]*e,t},e.transformMat2d=function(t,e,r){var n=e[0];return e=e[1],t[0]=r[0]*n+r[2]*e+r[4],t[1]=r[1]*n+r[3]*e+r[5],t},e.transformMat3=function(t,e,r){var n=e[0];return e=e[1],t[0]=r[0]*n+r[3]*e+r[6],t[1]=r[1]*n+r[4]*e+r[7],t},e.transformMat4=function(t,e,r){var n=e[0];return e=e[1],t[0]=r[0]*n+r[4]*e+r[12],t[1]=r[1]*n+r[5]*e+r[13],t},e.rotate=function(t,e,r,n){var i=e[0]-r[0];e=e[1]-r[1];var o=Math.sin(n);return n=Math.cos(n),t[0]=i*n-e*o+r[0],t[1]=i*o+e*n+r[1],t},e.angle=function(t,e){var r=t[0];t=t[1];var n=e[0];e=e[1];var i=r*r+t*t;0<i&&(i=1/Math.sqrt(i));var o=n*n+e*e;return 0<o&&(o=1/Math.sqrt(o)),1<(r=(r*n+t*e)*i*o)?0:-1>r?Math.PI:Math.acos(r)},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var r=t[0];t=t[1];var n=e[0];return e=e[1],Math.abs(r-n)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}(te);e.len=u,e.sub=n,e.mul=i,e.div=o,e.dist=a,e.sqrDist=s,e.sqrLen=l,t=function(){var t=r();return function(e,r,n,i,o,a){for(r||(r=2),n||(n=0),i=i?Math.min(i*r+n,e.length):e.length;n<i;n+=r)t[0]=e[n],t[1]=e[n+1],o(t,t,a),e[n]=t[0],e[n+1]=t[1];return e}}(),e.forEach=t}));r(le);var he=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0,t=r(te),e.glMatrix=t,t=r(ee),e.mat2=t,t=r(re),e.mat2d=t,t=r(ne),e.mat3=t,t=r(ie),e.mat4=t,t=r(se),e.quat=t,t=r(ue),e.quat2=t,t=r(le),e.vec2=t,t=r(oe),e.vec3=t,t=r(ae),e.vec4=t}));r(he);var ce=he.vec4,fe=he.vec3,pe=he.vec2,de=he.quat2,ve=he.quat,ge=he.mat4,me=he.mat3,ye=he.mat2d,be=he.mat2,xe=he.glMatrix;h(l,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(t,e){if(!t||!e)return 0;if(!(t=this.convertMC2LL(t)))return 0;var r=this.toRadians(t.lng);if(t=this.toRadians(t.lat),!(e=this.convertMC2LL(e)))return 0;var n=this.toRadians(e.lng);return e=this.toRadians(e.lat),this.getDistance(r,n,t,e)},getDistanceByLL:function(t,e){if(!t||!e)return 0;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74),e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74);var r=this.toRadians(t.lng),n=this.toRadians(t.lat);return t=this.toRadians(e.lng),e=this.toRadians(e.lat),this.getDistance(r,t,n,e)},convertMC2LL:function(t){if(null===t||void 0===t)return new c(0,0);for(var e=new c(Math.abs(t.lng),Math.abs(t.lat)),r=0;r<this.MCBAND.length;r++)if(e.lat>=this.MCBAND[r]){var n=this.MC2LL[r];break}return new c((t=this.convertor(t,n)).lng.toFixed(6),t.lat.toFixed(6))},convertLL2MC:function(t){if(null===t||void 0===t)return new c(0,0);if(180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return t;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74);for(var e=new c(t.lng,t.lat),r=0;r<this.LLBAND.length;r++)if(e.lat>=this.LLBAND[r]){var n=this.LL2MC[r];break}if(!n)for(r=0;r<this.LLBAND.length;r++)if(e.lat<=-this.LLBAND[r]){n=this.LL2MC[r];break}return t=this.convertor(t,n),new c(Number(t.lng.toFixed(2)),Number(t.lat.toFixed(2)))},convertor:function(t,e){if(t&&e){var r=e[0]+e[1]*Math.abs(t.lng),n=Math.abs(t.lat)/e[9];return e=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n,new c(r*=0>t.lng?-1:1,e*=0>t.lat?-1:1)}},getDistance:function(t,e,r,n){return this.EARTHRADIUS*Math.acos(Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos(e-t))},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,r){return null!=e&&(t=Math.max(t,e)),null!=r&&(t=Math.min(t,r)),t},getLoop:function(t,e,r){for(;t>r;)t-=r-e;for(;t<e;)t+=r-e;return t}}),h(l.prototype,{lngLatToMercator:function(t){return l.convertLL2MC(t)},lngLatToPoint:function(t){return new f((t=l.convertLL2MC(t)).lng,t.lat)},mercatorToLngLat:function(t){return l.convertMC2LL(t)},pointToLngLat:function(t){return t=new c(t.x,t.y),l.convertMC2LL(t)},pointToPixel:function(t,e,r,n,i){if(t)return t=this.lngLatToMercator(t,i),e=this.getZoomUnits(e),new f(Math.round((t.lng-r.lng)/e+n.width/2),Math.round((r.lat-t.lat)/e+n.height/2))},pixelToPoint:function(t,e,r,n,i){if(t)return e=this.getZoomUnits(e),t=new c(r.lng+e*(t.x-n.width/2),r.lat-e*(t.y-n.height/2)),this.mercatorToLngLat(t,i)},getZoomUnits:function(t){return Math.pow(2,18-t)}});var _e=function(t){return t[0]},we=function(t){return t[1]},Me=function(t,e,r,n,i){void 0===e&&(e=_e),void 0===r&&(r=we),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;var o=this.ids=new(65536>t.length?Uint16Array:Uint32Array)(t.length);i=this.coords=new i(2*t.length);for(var a=0;a<t.length;a++)o[a]=a,i[2*a]=e(t[a]),i[2*a+1]=r(t[a]);v(o,i,n,0,o.length-1,0)};Me.prototype.range=function(t,e,r,n){for(var i,o,a=this.ids,s=this.coords,u=this.nodeSize,l=[0,a.length-1,0],h=[];l.length;){var c=l.pop(),f=l.pop(),p=l.pop();if(f-p<=u)for(c=p;c<=f;c++)i=s[2*c],o=s[2*c+1],i>=t&&i<=r&&o>=e&&o<=n&&h.push(a[c]);else{var d=Math.floor((p+f)/2);i=s[2*d],o=s[2*d+1],i>=t&&i<=r&&o>=e&&o<=n&&h.push(a[d]);var v=(c+1)%2;(0===c?t<=i:e<=o)&&(l.push(p),l.push(d-1),l.push(v)),(0===c?r>=i:n>=o)&&(l.push(d+1),l.push(f),l.push(v))}}return h},Me.prototype.within=function(t,e,r){for(var n=this.ids,i=this.coords,o=this.nodeSize,a=[0,n.length-1,0],s=[],u=r*r;a.length;){var l=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(l=c;l<=h;l++){c=i[2*l]-t;var f=i[2*l+1]-e;c*c+f*f<=u&&s.push(n[l])}else{var p=i[2*(f=Math.floor((c+h)/2))],d=i[2*f+1],v=p-t,g=d-e;v*v+g*g<=u&&s.push(n[f]),v=(l+1)%2,(0===l?t-r<=p:e-r<=d)&&(a.push(c),a.push(f-1),a.push(v)),(0===l?t+r>=p:e+r>=d)&&(a.push(f+1),a.push(h),a.push(v))}}return s};var Ee={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},Te=function(t){this.options=w(Object.create(Ee),t),this.trees=Array(this.options.maxZoom+1)};Te.prototype.load=function(t){var e=this.options,r=e.minZoom,n=e.maxZoom;e=e.nodeSize,this.points=t;for(var i=[],o=0;o<t.length;o++)t[o].geometry&&i.push(y(t[o],o));for(this.trees[n+1]=new Me(i,M,E,e,Float32Array),t=n;t>=r;t--)i=this.generateCluster(i,t),this.trees[t]=new Me(i,M,E,e,Float32Array);return this},Te.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])r=-180,i=180;else if(r>i)return r=this.getClusters([r,n,180,o],e),n=this.getClusters([-180,n,i,o],e),r.concat(n);t=[];var a=0;for(n=(e=this.trees[this.limitZoom(e)]).range(r/360+.5,_(o),i/360+.5,_(n));a<n.length;a+=1)i=e.points[n[a]],t.push(i.numPoints?b(i):this.points[i.index]);return t},Te.prototype.getChildren=function(t){var e=t%32,r=this.trees[e];if(!r)throw Error("No cluster with the specified id.");var n=r.points[t>>5];if(!n)throw Error("No cluster with the specified id.");var i=[],o=0;for(e=r.within(n.x,n.y,this.options.radius/(this.options.extent*Math.pow(2,e-1)));o<e.length;o+=1)(n=r.points[e[o]]).parentId===t&&i.push(n.numPoints?b(n):this.points[n.index]);if(0===i.length)throw Error("No cluster with the specified id.");return i},Te.prototype.getLeaves=function(t,e,r){var n=[];return this.appendLeaves(n,t,e||10,r||0,0),n},Te.prototype.getTile=function(t,e,r){var n=this.trees[this.limitZoom(t)];t=Math.pow(2,t);var i=this.options,o=(r-(i=i.radius/i.extent))/t,a=(r+1+i)/t,s={features:[]};return this.addTileFeatures(n.range((e-i)/t,o,(e+1+i)/t,a),n.points,e,r,t,s),0===e&&this.addTileFeatures(n.range(1-i/t,o,1,a),n.points,t,r,t,s),e===t-1&&this.addTileFeatures(n.range(0,o,i/t,a),n.points,-1,r,t,s),s.features.length?s:null},Te.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom&&(e++,1===(t=this.getChildren(t)).length);)t=t[0].properties.clusterId;return e},Te.prototype.appendLeaves=function(t,e,r,n,i){var o=0;for(e=this.getChildren(e);o<e.length;o+=1){var a=e[o],s=a.properties;if(s&&s.cluster?i=i+s.pointCount<=n?i+s.pointCount:this.appendLeaves(t,s.clusterId,r,n,i):i<n?i++:t.push(a),t.length===r)break}return i},Te.prototype.addTileFeatures=function(t,e,r,n,i,o){for(var a=0;a<t.length;a+=1){var s=e[t[a]],u={type:1,geometry:[[Math.round(this.options.extent*(s.x*i-r)),Math.round(this.options.extent*(s.y*i-n))]],tags:s.numPoints?x(s):this.points[s.index].properties};void 0!==(s=s.numPoints?s.id:this.points[s.index].id)&&(u.id=s),o.features.push(u)}},Te.prototype.limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},Te.prototype.generateCluster=function(t,e){var r=[],n=this.options,i=n.reduce;n=n.radius/(n.extent*Math.pow(2,e));for(var o=0;o<t.length;o++){var a=t[o];if(!(a.zoom<=e)){a.zoom=e;for(var s=this.trees[e+1],u=s.within(a.x,a.y,n),l=a.numPoints||1,h=a.x*l,c=a.y*l,f=i&&1<l?this.handleMap(a,!0):null,p=(o<<5)+(e+1),d=0;d<u.length;d+=1){var v=s.points[u[d]];if(!(v.zoom<=e)){v.zoom=e;var g=v.numPoints||1;h+=v.x*g,c+=v.y*g,l+=g,v.parentId=p,i&&(f||(f=this.handleMap(a,!0)),i(f,this.handleMap(v)))}}1===l?r.push(a):(a.parentId=p,r.push({x:h/l,y:c/l,zoom:1/0,id:p,parentId:-1,numPoints:l,properties:f}))}}return r},Te.prototype.handleMap=function(t,e){if(t.numPoints)return e?w({},t.properties):t.properties;t=this.points[t.index].properties;var r=this.options.map(t);return e&&r===t?w({},r):r},T.prototype.setMax=function(t){this.max=t||100},T.prototype.setMin=function(t){this.min=t||0},T.prototype.setMaxSize=function(t){this.maxSize=t||35},T.prototype.setMinSize=function(t){this.minSize=t||0},T.prototype.initPalette=function(){var t=this.gradient,e=this.paletteCtx=new d(256,1).getContext("2d"),r=e.createLinearGradient(0,0,256,1);Object.keys(t).forEach((function(e){r.addColorStop(parseFloat(e),t[e])})),e.fillStyle=r,e.fillRect(0,0,256,1),e.imageData=e.getImageData(0,0,256,1).data},T.prototype.getColor=function(t){return"rgba("+(t=this.getImageData(t))[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},T.prototype.getImageData=function(t){var e=this.paletteCtx.imageData;if(void 0===t)return e;var r=this.max,n=this.min;return t>r&&(t=r),t<n&&(t=n),[e[t=4*Math.floor((t-n)/(r-n)*255)],e[t+1],e[t+2],e[t+3]]},T.prototype.getSize=function(t){var e=this.max,r=this.min,n=this.maxSize,i=this.minSize;return t>e&&(t=e),t<r&&(t=r),i+(t-r)/(e-r)*(n-i)},P.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},P.prototype.setOptions=function(t){this.options=t||{},this._initialize()},P.prototype.getPoints=function(t){void 0===t&&(t=20);for(var e=[],r=0;r<=t;r++)e.push(this._getPoint(r/t));return e},P.prototype._normalizaCoord=function(t){return t?[(t=l.convertLL2MC({lng:Number(t[0]),lat:Number(t[1])})).lng,t.lat]:[]},P.prototype._getControlPoint=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(Vt(this._getQuarter(t,e)),[this._getDistance(t,e)/r])},P.prototype._getQuarter=function(t,e){return[(3*t[0]+e[0])/4,(3*t[1]+e[1])/4]},P.prototype._getDistance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},P.prototype._getPoint=function(t){var e=[],r=this.v0,n=this.v1,i=this.v2,o=this.v3;return e.push(A(t,r[0],n[0],i[0],o[0]),A(t,r[1],n[1],i[1],o[1]),A(t,r[2],n[2],i[2],o[2])),e};var Pe=function(){function t(e){jt(this,t),this.options=this.getCommonDefaultOptions(),this.options=Object.assign(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=Object.assign(this.options,e),this.options.data&&(this.data=this.options.data)}return Nt(t,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(t,e){e=e||{},this.data=t,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData()),!1!==e.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(t){t=t||{},Object.assign(this.options,t),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions()),this.onChanged&&this.onChanged(this.getOptions(),this.getData()),t.data?this.setData(t.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"onChanged",value:function(t,e){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(t,e){}},{key:"setWebglLayer",value:function(t){this.webglLayer=t}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),t}(),Ae=function(){function t(e,r,n){jt(this,t),this.options=r,this.gl=e,n&&(this.map=n.map),n=this.getVertexShader(r.vertexShader);var i=this.getFragmentShader(r.fragmentShader);r=e.createShader(e.VERTEX_SHADER),e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?(n=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?(i=e.createProgram(),e.attachShader(i,r),e.attachShader(i,n),e.deleteShader(r),e.deleteShader(n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?r=i:(r="Shader program failed to link.  The error log is:"+e.getProgramInfoLog(i),console.error(r),r=-1)):(r="Fragment shader failed to compile.  The error log is:"+e.getShaderInfoLog(n),console.error(r),r=-1)):(r="Vertex shader failed to compile.  The error log is:"+e.getShaderInfoLog(r),console.error(r),r=-1),r=this.program=r,n={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(var o=0;o<i;o++){var a=e.getActiveAttrib(r,o);n[a.name]=e.getAttribLocation(r,a.name)}o={},a={};for(var s=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),u=0;u<s;u++){var l=e.getActiveUniform(r,u);o[l.name]=e.getUniformLocation(r,l.name),a[l.name]=l.type}this.parameter=e={attributes:n,numAttributes:i,uniformsType:a,uniforms:o},this.attributes=e.attributes,this.uniforms=e.uniforms,this.parameter=e}return Nt(t,[{key:"getVertexShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="uniform float log2FarDistance;uniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\ngl_Position.z=log2(max(1e-6,1.0+gl_Position.w))*log2FarDistance-1.0;gl_Position.z*=gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}",(t=(t=this.getDefines()+e+t).replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(t){return(t=(t=this.getDefines()+"precision highp float;uniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n}"+t).replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var t="",e=this.options.defines;if(e)for(var r=0;r<e.length;r++)t+="#define "+e[r]+"\n";return t}},{key:"use",value:function(t,e){this.gl=t,t.useProgram(this.program),this.map&&"cesium"===this.map.type&&this.setUniforms({log2FarDistance:this.map.map.scene.context._us.log2FarDistance}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[t.canvas.width,t.canvas.height]})}},{key:"setUniform",value:function(t,e){var r=this.gl,n=this.uniforms[t];if(n)switch(this.textureIndex=0,this.parameter.uniformsType[t]){case r.FLOAT:r.uniform1f(n,e);break;case r.FLOAT_VEC2:r.uniform2f(n,e[0],e[1]);break;case r.FLOAT_VEC3:r.uniform3f(n,e[0],e[1],e[2]);break;case r.FLOAT_VEC4:r.uniform4f(n,e[0],e[1],e[2],e[3]);break;case r.SAMPLER_2D:case r.SAMPLER_CUBE:r.activeTexture(r.TEXTURE0+this.textureIndex),r.uniform1i(n,this.textureIndex),r.bindTexture(r.TEXTURE_2D,e),this.textureIndex++;break;case r.INT:case r.BOOL:r.uniform1i(n,e);break;case r.INT_VEC2:case r.BOOL_VEC2:r.uniform2i(n,e[0],e[1]);break;case r.INT_VEC3:case r.BOOL_VEC3:r.uniform3i(n,e[0],e[1],e[2]);break;case r.INT_VEC4:case r.BOOL_VEC4:r.uniform4i(n,e[0],e[1],e[2],e[3]);break;case r.FLOAT_MAT2:r.uniformMatrix2fv(n,!1,e);break;case r.FLOAT_MAT3:r.uniformMatrix3fv(n,!1,e);break;case r.FLOAT_MAT4:r.uniformMatrix4fv(n,!1,e);break;default:console.error("Unrecognized uniform type: "+t)}else console.warn("Unrecognized uniform type: "+t)}},{key:"setUniforms",value:function(t){for(var e in t)this.setUniform(e,t[e])}}]),t}(),Se=function(){function t(e){jt(this,t),this.options=e,this.gl=e.gl,this.buffer=this.gl.createBuffer(),e.data&&this.updateData(e.data)}return Nt(t,[{key:"updateData",value:function(t){var e=this.options,r=this.gl;this.bind(),r.bufferData(r[e.target],t,r[e.usage])}},{key:"bind",value:function(t){(t=t||this.gl).bindBuffer(t[this.options.target],this.buffer)}},{key:"unBind",value:function(t){(t=t||this.gl).bindBuffer(t[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),t}(),Le={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},Oe=function(){function t(e){for(jt(this,t),this.options=e,this.attributes=e.attributes,this.gl=e.gl,this.program=e.program,e=this.stride=0;e<this.attributes.length;e++)this.stride+=Le[this.attributes[e].type]*this.attributes[e].size}return Nt(t,[{key:"setVertexAttribPointers",value:function(){for(var t=this.gl,e=this.program,r=0;r<this.attributes.length;r++){var n=this.attributes[r],i=e.attributes[n.name];void 0!==i&&(n.buffer.bind(t),t.vertexAttribPointer(i,n.size,t[n.type],n.normalize||!1,void 0!==n.stride?n.stride:this.stride,n.offset),t.enableVertexAttribArray(i))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),t}(),Re=function t(e,r,n){jt(this,t),r=r||e.canvas.width,n=n||e.canvas.height;var i=e.createFramebuffer(),o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i.texture=o;var a=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,n),i.depthBuffer=a,e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),r=e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE===r&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),this.framebuffer=i)},Ce=function(){function t(e){jt(this,t),this.options={},Object.assign(this.options,e),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return Nt(t,[{key:"getOptions",value:function(){return this.options}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var r=this.programSample;e.useProgram(r.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var i=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,0),e.drawArrays(e.TRIANGLES,0,i.length/3)}}]),t}(),ke=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new Oe({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var r=this.getProgram(e);r.use(e),this.vertexArray.bind(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,1),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(Ce),Be=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y);vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Re(t)),this.bloomBuffer||(this.bloomBuffer=new Re(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,r=t.texture;t=t.fbo;var n=this.getOptions();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.getProgram(e),o=i.programBright,a=i.programBloom;i=i.programResult;var s=this.getExtraFbo(e),u=s.collectBrightBuffer;s=s.bloomBuffer;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),l=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.aTextureCoord),e.vertexAttribPointer(i.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(o.uniforms.uSampler,1),e.uniform1f(o.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!0),e.uniform1f(a.uniforms.blurSize,n.blurSize||2),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!1),e.uniform1f(a.uniforms.blurSize,n.blurSize||2),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(i.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(i.uniforms.originalTexture,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(i.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(Ce),De=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y);vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Re(t)),this.bloomBuffer||(this.bloomBuffer=new Re(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,r=t.texture;t=t.fbo;var n=this.getOptions(),i="clarity"in n?n.clarity:1;i=Math.max(0,i),i=Math.min(1,i),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var o=this.getProgram(e),a=o.programBright,s=o.programBloom;o=o.programResult;var u=this.getExtraFbo(e),l=u.collectBrightBuffer;u=u.bloomBuffer;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aPos),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aTextureCoord),e.vertexAttribPointer(s.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(a.uniforms.uSampler,1),e.uniform1f(a.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!0),e.uniform1f(s.uniforms.blurSize,n.blurSize||2),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!1),e.uniform1f(s.uniforms.blurSize,n.blurSize||2),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(o.uniforms.originalTexture,1),e.uniform1f(o.uniforms.toneScale,i),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(o.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(Ce),Fe=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Ae(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var r=this.getProgram(e);e.useProgram(r.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,1),e.uniform2fv(r.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(Ce),ze=function(){function t(e){jt(this,t),this.gl=e,this.effects=[],this.initFbo()}return Nt(t,[{key:"addEffect",value:function(t){this.effects.push(t)}},{key:"removeEffect",value:function(t){}},{key:"setEffects",value:function(t){this.effects=t}},{key:"initFbo",value:function(){var t=this.gl;this.fbo=[new Re(t),new Re(t)]}},{key:"render",value:function(){var t=this.gl,e=this.effects;if(e&&0<e.length)for(var r={},n=0;n<e.length;n++){var i=this.fbo[n%2].framebuffer;n===e.length-1&&(i=null),t.bindFramebuffer(t.FRAMEBUFFER,i);var o=[0,0,0,0];t.clearColor(o[0],o[1],o[2],o[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e[n].render({isPickRender:!1,gl:t,texture:r.texture,fbo:i}),r=i}}}]),t}(),Ie=function(){function t(e,r){jt(this,t),this.map=e,this.options=r||{}}return Nt(t,[{key:"onResize",value:function(t){}},{key:"onUpdate",value:function(t){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5"}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5"}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5"}},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5"}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5"}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5"}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5"}},{key:"lnglatToMercator",value:function(t,e){return"gcj02"===this.options.coordinateSystem?(e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]):[(t=l.convertLL2MC({lng:t,lat:e})).lng,t.lat]}}]),t}(),Ue=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t)}},{key:"onMousemove",value:function(t){this.map.addEventListener("mousemove",(function(e){t({x:e.x,y:e.y})}))}},{key:"onClick",value:function(t){this.map.addEventListener("click",(function(e){t({x:e.x,y:e.y})}))}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t={lng:(t=this.map.lnglatToMercator(t.lng,t.lat))[0],lat:t[1]}),t}},{key:"lnglatToMercator",value:function(t,e){return this.map.lnglatToMercator(t,e)}}]),e}(Ie),je=function(t){function e(t){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t}return Ht(e,t),Nt(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t)}},{key:"onMousemove",value:function(t){this.map.addEventListener("mousemove",t)}},{key:"onClick",value:function(t){this.map.addEventListener("click",t)}},{key:"changeCanvas",value:function(){var t=this.map,e=t.getSize(),r=t.getCenter();t=t.pointToOverlayPixel(r),this.div.style.left=t.x-e.width/2+"px",this.div.style.top=t.y-e.height/2+"px"}},{key:"onUpdate",value:function(t){var e=this;this.map.addEventListener("moveend",(function(){e.changeCanvas(),t()})),this.map.addEventListener("moving",(function(){e.changeCanvas(),t()})),this.map.addEventListener("zoomend",(function(){e.changeCanvas(),t()}))}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}}]),e}(Ie),Ne=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),{lng:(t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]))[0],lat:t[1]}}},{key:"getMercator",value:function(t){var e=[];return e[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,e[1]=3189068.5*Math.log((1+Math.sin(t))/(1-Math.sin(t))),e}}]),e}(Ie),Ye=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(Ie),We=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t)}},{key:"onUpdate",value:function(t){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(Ie),He=function(){function t(e,r){jt(this,t),r=r||{},this.map="bmap"===r.mapType?new je(e,r):"blank"===r.mapType?new Ye(e,r):"cesium"===r.mapType?new Ne(e,r):"three"===r.mapType?new We(e,r):new Ue(e,r),this.map.type=r.mapType,this.options=r||{},this.renderArr=[],(e=r.canvas)||(e=document.createElement("canvas")),this.canvas=e,this.gl=r.gl?r.gl:S(e),this.changeSize(),this.projectionMatrix=ge.create(Float64Array),this.oMatrix=ge.create(Float64Array),this.matrix=ge.create(Float64Array),this.viewMatrix=ge.create(Float64Array),this.fovy=35,this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.pickFBO=new Re(this.gl),this.transferOptions={},this.bind()}return Nt(t,[{key:"bind",value:function(){var t=this,e=this.map;e.onResize((function(){t.changeSize(),t.render()})),e.onUpdate(this._update),e.onClick&&e.onClick((function(e){t.onClick&&t.onClick(e)})),e.onMousemove&&e.onMousemove((function(e){t.onMousemove&&t.onMousemove(e)})),this.options.canvas||e.getContainer().appendChild(this.canvas)}},{key:"setOptions",value:function(t){this.options=t}},{key:"onInitialize",value:function(t){t&&(this.transferOptions=t.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(t){var e=this.gl;t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var t=this.gl;this.preFramebuffer=t.getParameter(t.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(t){this.renderArr.push(t)}},{key:"changeSize",value:function(){var t=this.canvas;if(t){var e=t.style,r=this.map.getSize(),n=window.devicePixelRatio;t.width=r.width*n,t.height=r.height*n,e.cssText="position: absolute;left:0;top:0;width:"+r.width+"px;height:"+r.height+"px;z-index:2;","cesium"!==(r=this.options).mapType||r.canvas||(e.pointerEvents="none"),this.gl.viewport(0,0,t.width,t.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var t=this.options,e=this.projectionMatrix,r=this.viewMatrix;if("three"===t.mapType)e=(r=this.map.map.camera).projectionMatrix.elements,r=r.matrixWorldInverse.elements;else if("cesium"===t.mapType){var n=(r=this.map.map).camera.frustum.projectionMatrix;e=new Float32Array([n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]]),n=r.camera.viewMatrix,r=new Float32Array([n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]])}else this.updateProjectionMatrix(),this.updateModelViewMatrix();for(n=ge.multiply(this.matrix,e,r),Object.assign(this.transferOptions,{gl:this.gl,matrix:n,projectionMatrix:e,orthoMatrix:this.oMatrix,viewMatrix:r}),"three"!==t.mapType&&"cesium"!==t.mapType&&this.clear(),t=0;t<this.renderArr.length;t++)this.renderArr[t]&&this.renderArr[t].bind(this)(this.transferOptions)}}},{key:"clear",value:function(t){var e=this.gl,r=this.options.clearColor||[0,0,0,0];e.clearColor(r[0],r[1],r[2],r[3]),t&&(t instanceof Array||(t=o(t).unitArray()),e.clearColor(t[0],t[1],t[2],t[3])),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var t=this.gl.canvas.width/this.gl.canvas.height;ge.perspective(this.projectionMatrix,p(this.fovy),t,1,4e3),this.map.getSize(),ge.ortho(this.oMatrix,0,this.gl.canvas.width,0,this.gl.canvas.height,1,4e3)}},{key:"updateModelViewMatrix",value:function(){var t=this.map,e=this.viewMatrix;ge.identity(e);var r=t.getSize();r=Math.round(-r.height/(2*Math.tan(p(this.fovy)/2))),ge.translate(e,e,[0,0,r]),ge.rotate(e,e,p(t.getTilt()),[-1,0,0]),ge.rotate(e,e,p(t.getHeading()),[0,0,-1]),r=t.getCenter();var n=this.options.pointOffset||[0,0];t=t.getZoomUnits(),ge.translate(e,e,[(n[0]-r.lng)/t,(n[1]-r.lat)/t,0]),t=1/t,ge.scale(e,e,[t,t,t])}},{key:"destroy",value:function(){this.stopAnimation(),this.map.getContainer().removeChild(this.canvas),this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),t}(),qe=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"getCommonDefaultOptions",value:function(){return{enablePicked:!1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){this.pickedColor=[-1,-1,-1];var e=this.getOptions();this.gl=t,e.enablePicked&&(this.pickBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"normizedColor",value:function(t){var e=t;return t instanceof Array||(e=o(t).unitArray()),void 0===e[3]&&(e[3]=1),e}},{key:"normizedPoint",value:function(t){if(!t||!t[0]||!t[1])return[0,0,0];var e=[0,0],r=this.getOptions();this.webglLayer&&this.webglLayer.options.pointOffset?e=this.webglLayer.options.pointOffset:r.pointOffset&&(e=r.pointOffset),r=Number(t[0]);var n=Number(t[1]);-180<=r&&180>=r&&-90<=n&&90>=n&&(r=(n=this.webglLayer.map.lnglatToMercator(r,n))[0],n=n[1]);var i=Number(t[2])||0;return this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium&&(r=this.convertLngLat([r,n]),r=(i=window.Cesium.Cartesian3.fromDegrees(r[0],r[1],i)).x,n=i.y,i=i.z),3<t.length?[r-e[0],n-e[1],i].concat(Vt(t.slice(3))):[r-e[0],n-e[1],i]}},{key:"convertLngLat",value:function(t){return[t[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){return this.webglLayer&&this.webglLayer.options.pointOffset?this.webglLayer.options.pointOffset:[0,0]}},{key:"indexToRgb",value:function(t){t++;var e=Math.floor(t/65536);t-=65536*e;var r=Math.floor(t/256);return[t-256*r,r,e]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var e=this.getOptions(),r={};if(e.enablePicked){var n=e.autoSelect?this.pickedColor:this.indexToRgb(e.selectedIndex||-1);r=Object.assign(r,{uSelectedColor:this.normizedColor(e.selectedColor),uEnablePicked:e.enablePicked,uPickedColor:n.map((function(t){return t/255})),uIsPickRender:!!t})}return r}},{key:"pick",value:function(t,e){var r=this.gl;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:r,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix});var n=new Uint8Array(4);return r.readPixels(t*window.devicePixelRatio,r.canvas.height-e*window.devicePixelRatio,1,1,r.RGBA,r.UNSIGNED_BYTE,n),t=this.rgbToIndex(n),this.pickedColor=[n[0],n[1],n[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:this.data[t]}}},{key:"setState",value:function(t,e){!1===(e=e||{}).depthTest?t.disable(t.DEPTH_TEST):t.enable(t.DEPTH_TEST),!0===e.blend?t.enable(t.BlEND):t.disable(t.BlEND)}}]),e}(Pe),Ze="undefined"===typeof Symbol?"__target":Symbol(),Ve=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Xe=window.URL||window.webkitURL,Ge=window.Worker;if(Ge){var Je=C("self.onmessage = function () {}"),$e=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var Qe=new Ge(Je);Qe.postMessage($e,[$e.buffer])}catch(Gr){Ge=null}finally{Xe.revokeObjectURL(Je),Qe&&Qe.terminate()}}var Ke=new R("./worker.js",(function(t,e){function r(t){function e(e,n){for(var a=0;a<c;a++){var s=e*c+a,u=s-g,l=i.vertex.length-1,m=15*(s=o.data[4*s+3])+10;void 0!==t.vertexHeight&&("[object Function]"===Object.prototype.toString.call(t.vertexHeight)?m=t.vertexHeight({opacity:s}):-1!==t.vertexHeight&&(m=t.vertexHeight)),i.vertex[l].push(h[0]+p*a/c-v[0],h[1]-d*e/f-v[1],m),i.color[l].push(r[4*s]/255,r[4*s+1]/255,r[4*s+2]/255,s/255),a<c-1&&e<f-1&&!1!==n&&(i.index[l].push(u+c,u+1,u),i.index[l].push(u+1,u+c,u+c+1))}}var r=t.intensity;i=null,i={vertex:[[]],vertexBuffer:[],color:[[]],colorBuffer:[],index:[[]],indexBuffer:[]};var o=t.ctx,a=t.bound,s=t.canvasWidth,u=t.canvasHeight,l=t.zoomUnit,h=[a.minX,a.maxY],c=s,f=u,p=s/t.totalScale*l,d=u/t.totalScale*l,v=t.pointOffset||[0,0],g=0;for(a=0;a<f;a++)65536<i.vertex[i.vertex.length-1].length/3+2*c&&(g+=i.vertex[i.vertex.length-1].length/3,e(a,!1),i.vertex.push([]),i.color.push([]),i.index.push([])),e(a);for(a=0;a<i.vertex.length;a++)i.vertexBuffer[a]=new Float32Array(i.vertex[a]),i.colorBuffer[a]=new Float32Array(i.color[a]),i.indexBuffer[a]=new Uint16Array(i.index[a]);n.postMessage(i)}var n=this,i=null;n.addEventListener("message",(function(t){r(t.data)}),!1)}));k.prototype.scale=function(t,e){this.totalScale=t,this.canvasScale=e;var r=(t=this.canvas).style;this.map.getSize();var n=this.heatmapLayer.getBounds(),i=this.map.getZoomUnits(),o=(n.maxX-n.minX)/i;n=(n.maxY-n.minY)/i,o=o*e*this.totalScale,n=n*e*this.totalScale,t.width=o,t.height=n,r.cssText="background: white; position: absolute;left:0;top:0;width:"+o+"px;height:"+n+"px;z-index:3;",this.ctx=t.getContext("2d")},k.prototype.getImageData=function(){var t=this.ctx;return t.getImageData(0,0,t.canvas.width,t.canvas.height)},k.prototype.setData=function(t){this.data=t,this._update()},k.prototype.update=function(t){var e=this;this.clear(),this._draw&&clearTimeout(this._draw);var r=this;this._draw=setTimeout((function(){r._draw=null,e._update(),t&&t()}),500)},k.prototype.clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},k.prototype._update=function(){this.drawHeatmap(this.ctx)},k.prototype.drawHeatmap=function(t){var e=this.options;(t=this.ctx).clearRect(0,0,t.canvas.width,t.canvas.height),t.save(),e=e.scale||1,t.scale(e,e),this.drawGray(),t.restore()},k.prototype.drawGray=function(){var t=this.map,e=this.ctx,r=this.options,n=r.max||100,i=r.size||600,o=i/=this.map.getZoomUnits(),a=o/2,s=o+a,u=(i=new d(2*s,2*s)).getContext("2d");u.shadowBlur=a,u.shadowColor="black",u.shadowOffsetX=u.shadowOffsetY=1e4,u.beginPath(),u.arc(s-1e4,s-1e4,o,0,2*Math.PI,!0),u.closePath(),u.fill(),o=i.width/2,a=i.height/2,s=this.data,t=t.getZoomUnits();var l=(u=this.heatmapLayer.getBounds()).minX,h=u.maxY,c=100*t;if(s)for(var f=this.heatmapLayer.getPointOffset(),p=0;p<s.length;p++){var v=s[p];if(v.geometry){var g=this.heatmapLayer.normizedPoint(v.geometry.coordinates);if(g[0]+=f[0],g[1]+=f[1],!(~~g[0]<u.minX-c||~~g[0]>u.maxX+c||~~g[1]>u.maxY+c||~~g[1]<u.minY-c)){var m=void 0===v.count?1:v.count;"properties"in v&&"count"in v.properties&&(m=v.properties.count),v=Math.min(1,m/n),e.globalAlpha=void 0!==r.globalAlpha?r.globalAlpha:v,v=(g[0]-l)/t,g=(h-g[1])/t,0<i.width&&0<i.height&&e.drawImage(i,v-o,g-a)}}}},k.prototype.destroy=function(){this.canvas=null},B.prototype.initWorker=function(){var t=this;this.worker=new Ke;var e=this.gl;this.worker.onmessage=function(r){for(t.output=r.data,r=0;r<t.output.vertex.length;r++){var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t.output.vertexBuffer[r],e.STATIC_DRAW),t.output.vertexBuffer[r]=n,e.bindBuffer(e.ARRAY_BUFFER,null),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t.output.colorBuffer[r],e.STATIC_DRAW),t.output.colorBuffer[r]=n,e.bindBuffer(e.ARRAY_BUFFER,null),n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.output.indexBuffer[r],e.STATIC_DRAW),t.output.indexBuffer[r]=n,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}t.layer.webglLayer.render()}},B.prototype.getData=function(){return this.output};var tr=function(t){function e(t){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).totalScale=1/3,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{scale:1/3,size:600,max:40,gradient:{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}}},{key:"initialize",value:function(t){var e=this.map;this.intensity=new T({gradient:this.options.gradient}),this._canvasScale=1.1,this._isShow=!0,this.canvasLayer=new k(e,this.options,this),this.canvasLayer.scale(this.totalScale,this._canvasScale),this._update=this.update.bind(this),e.map.addEventListener("update",this._update),this.gl=t,this.dataMgr=new B(this,this.map,this.gl),this.program=new Ae(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;uniform mat4 u_matrix;varying vec4 vColor;void main(void){gl_Position=u_matrix*vec4(aPos,1);gl_PointSize=10.0;vColor=aColor;}",fragmentShader:"precision highp float;varying vec4 vColor;void main(void){gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(t,e){this.intensity=new T({gradient:t.gradient}),this.canvasLayer.setData(e),this.updateHeatmapModel()}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.lineWidth(100),e.enable(e.BLEND),e.disable(e.CULL_FACE),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),r=this.dataMgr.getData())for(var n=0;n<r.vertexBuffer.length;n++)e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer[n]),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attributes.aPos),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,r.colorBuffer[n]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attributes.aColor),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indexBuffer[n]),e.drawElements(e.TRIANGLES,r.index[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null);e.disable(e.BLEND)}},{key:"update",value:function(t){var e=this;e._isShow?(e.canvasLayer.scale(e.totalScale,e._canvasScale),e.canvasLayer.update((function(){e.updateHeatmapModel()})),e.webglLayer.render()):e.webglLayer.clear()}},{key:"destroy",value:function(){this.setData([]),this.map.map.removeEventListener("update",this._update),this.canvasLayer.destroy()}},{key:"updateHeatmapModel",value:function(){var t=this.getOptions(),e=this.canvasLayer.ctx;if(!(0>=e.canvas.width||0>=e.canvas.height)){var r=this.map;this.dataMgr.worker.postMessage({intensity:this.intensity.getImageData(),vertexHeight:t.vertexHeight,ctx:e.getImageData(0,0,e.canvas.width,e.canvas.height),totalScale:this.totalScale,canvasScale:this._canvasScale,canvasWidth:e.canvas.width,pointOffset:this.webglLayer.options.pointOffset||[0,0],canvasHeight:e.canvas.height,bound:this.getBounds(),mapSize:r.getSize(),center:r.getCenter(),zoomUnit:r.getZoomUnits()}),this.webglLayer.render()}}},{key:"getBounds",value:function(){var t=this.map.map.getBounds(),e=t.getNorthEast();return t=t.getSouthWest(),-180<e.lng&&180>e.lat&&(t=l.convertLL2MC({lng:t.lng,lat:t.lat}),e=l.convertLL2MC({lng:e.lng,lat:e.lat})),{minX:t.lng,minY:t.lat,maxX:e.lng,maxY:e.lat}}}]),e}(qe),er=new R("./worker.js",(function(t,e){function r(t){this.canvasScale=1.1,this.options=t||{};var e=new OffscreenCanvas(100,1);this.data=[],this.canvas=e,this.ctx=e.getContext("2d"),this.circleSize=t.size||600}var n=this;r.prototype.setSize=function(t){var e=this.canvas;e.width=t.width,e.height=t.height},r.prototype.getImageData=function(){var t=this.ctx;return t.getImageData(0,0,t.canvas.width,t.canvas.height)},r.prototype.setData=function(t){this.data=t},r.prototype.update=function(){this.clear(),this._update()},r.prototype.clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},r.prototype._update=function(){this.drawHeatmap(this.ctx)},r.prototype.drawHeatmap=function(t){var e=this.options;(t=this.ctx).clearRect(0,0,t.canvas.width,t.canvas.height),t.save(),e=e.scale||1,t.scale(e,e),this.drawGray(),t.restore()},r.prototype.drawGray=function(){var t=this.ctx,e=this.circleSize,r=e/2,n=e+r,i=new OffscreenCanvas(2*n,2*n),o=i.getContext("2d");if(o.shadowBlur=r,o.shadowColor="black",o.shadowOffsetX=o.shadowOffsetY=1e4,o.beginPath(),o.arc(n-1e4,n-1e4,e,0,2*Math.PI,!0),o.closePath(),o.fill(),e=this.data)for(r=0;r<e.length;r++)n=e[r],t.globalAlpha=n.alpha,0<i.width&&0<i.height&&t.drawImage(i,n.x,n.y)},r.prototype.destroy=function(){this.canvas=null};var i,o=null;n.addEventListener("message",(function(t){"updateHeatmapModel"===(t=t.data).type?function(t){function e(e,n){for(var i=0;i<f;i++){var a=e*f+i,u=a-m,l=o.vertex.length-1,h=15*(a=s.data[4*a+3])+10;void 0!==t.vertexHeight&&("[object Function]"===Object.prototype.toString.call(t.vertexHeight)?h=t.vertexHeight({opacity:a}):-1!==t.vertexHeight&&(h=t.vertexHeight)),o.vertex[l].push(c[0]+d*i/f-g[0],c[1]-v*e/p-g[1],h),o.color[l].push(r[4*a]/255,r[4*a+1]/255,r[4*a+2]/255,a/255),i<f-1&&e<p-1&&!1!==n&&(o.index[l].push(u+f,u+1,u),o.index[l].push(u+1,u+f,u+f+1))}}if(i){i.circleSize=t.canvasData.circleSize,i.setSize(t.canvasSize),i.setData(t.canvasData.data),i.update();var r=t.intensity;o=null,o={vertex:[[]],vertexBuffer:[],color:[[]],colorBuffer:[],index:[[]],indexBuffer:[]};var a=i.ctx,s=a.getImageData(0,0,a.canvas.width,a.canvas.height),u=t.bound,l=a.canvas.width;a=a.canvas.height;var h=t.zoomUnit,c=[u.minX,u.maxY],f=l,p=a,d=l/t.totalScale*h,v=a/t.totalScale*h,g=t.pointOffset||[0,0],m=0;for(u=0;u<p;u++)65536<o.vertex[o.vertex.length-1].length/3+2*f&&(m+=o.vertex[o.vertex.length-1].length/3,e(u,!1),o.vertex.push([]),o.color.push([]),o.index.push([])),e(u);for(u=0;u<o.vertex.length;u++)o.vertexBuffer[u]=new Float32Array(o.vertex[u]),o.colorBuffer[u]=new Float32Array(o.color[u]),o.indexBuffer[u]=new Uint16Array(o.index[u]);n.postMessage(o)}}(t):"initialize"===t.type&&(i=new r(t.options)).setSize(t.canvasSize)}),!1)}));D.prototype.initWorker=function(){var t=this;this.worker=new er;var e=this.gl;this.worker.onmessage=function(r){for(t.output=r.data,r=0;r<t.output.vertex.length;r++){var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t.output.vertexBuffer[r],e.STATIC_DRAW),t.output.vertexBuffer[r]=n,e.bindBuffer(e.ARRAY_BUFFER,null),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t.output.colorBuffer[r],e.STATIC_DRAW),t.output.colorBuffer[r]=n,e.bindBuffer(e.ARRAY_BUFFER,null),n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.output.indexBuffer[r],e.STATIC_DRAW),t.output.indexBuffer[r]=n,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}t.layer.webglLayer.render()}},D.prototype.getData=function(){return this.output};var rr=function(t){function e(t){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).canvasScale=1.1,t.totalScale=1/3,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{scale:1/3,size:600,max:40,gradient:{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}}},{key:"initialize",value:function(t){var e=this.map;this.intensity=new T({gradient:this.options.gradient}),this._isShow=!0,this._update=this.update.bind(this),e.map.addEventListener("update",this._update),this.gl=t,this.dataMgr=new D(this,this.map,this.gl),this.dataMgr.worker.postMessage({type:"initialize",canvasSize:this.getCanvasSize(),options:this.options}),this.program=new Ae(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;uniform mat4 u_matrix;varying vec4 vColor;void main(void){gl_Position=u_matrix*vec4(aPos,1);gl_PointSize=10.0;vColor=aColor;}",fragmentShader:"precision highp float;varying vec4 vColor;void main(void){gl_FragColor=vColor;}"})}},{key:"getCanvasSize",value:function(){var t=this.getBounds(),e=this.map.getZoomUnits();this.map.getSize();var r=(t.maxX-t.minX)/e;return t=(t.maxY-t.minY)/e,{width:r=r*this.canvasScale*this.totalScale,height:t=t*this.canvasScale*this.totalScale}}},{key:"getCanvasData",value:function(t,e){var r=[],n=this.map.getZoomUnits(),i=this.getBounds(),o=this.getPointOffset(),a=i.minX,s=i.maxY,u=t.size||600,l=u/=this.map.getZoomUnits(),h=3*u;u*=3;for(var c=t.max||100,f=100*n,p=0;p<e.length;p++){var d=e[p];if(d.geometry){var v=this.normizedPoint(d.geometry.coordinates);if(v[0]+=o[0],v[1]+=o[1],!(~~v[0]<i.minX-f||~~v[0]>i.maxX+f||~~v[1]>i.maxY+f||~~v[1]<i.minY-f)){var g=void 0===d.count?1:d.count;"properties"in d&&"count"in d.properties&&(g=d.properties.count),d=Math.min(1,g/c),r.push({x:(v[0]-a)/n-h,y:(s-v[1])/n-u,alpha:void 0!==t.globalAlpha?t.globalAlpha:d})}}}return{circleSize:l,data:r}}},{key:"onChanged",value:function(t,e){this.intensity=new T({gradient:t.gradient})}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.lineWidth(100),e.enable(e.BLEND),e.disable(e.CULL_FACE),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),r=this.dataMgr.getData())for(var n=0;n<r.vertexBuffer.length;n++)e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer[n]),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attributes.aPos),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,r.colorBuffer[n]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t.attributes.aColor),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indexBuffer[n]),e.drawElements(e.TRIANGLES,r.index[n].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null);e.disable(e.BLEND)}},{key:"update",value:function(t){var e=this;this._isShow?(this.canvasUpdate((function(){e.updateHeatmapModel()})),this.webglLayer.render()):this.webglLayer.clear()}},{key:"canvasUpdate",value:function(t){this._draw&&clearTimeout(this._draw),this._draw=setTimeout((function(){t&&t()}),500)}},{key:"destroy",value:function(){this.setData([]),this.map.map.removeEventListener("update",this._update)}},{key:"updateHeatmapModel",value:function(){var t=this.getOptions(),e=this.map;this.dataMgr.worker.postMessage({type:"updateHeatmapModel",intensity:this.intensity.getImageData(),canvasData:this.getCanvasData(this.options,this.getData()),canvasSize:this.getCanvasSize(),vertexHeight:t.vertexHeight,totalScale:this.totalScale,canvasScale:this.canvasScale,pointOffset:this.webglLayer.options.pointOffset||[0,0],bound:this.getBounds(),mapSize:e.getSize(),center:e.getCenter(),zoomUnit:e.getZoomUnits()}),this.webglLayer.render()}},{key:"getBounds",value:function(){var t=this.map.map.getBounds(),e=t.getNorthEast();return t=t.getSouthWest(),-180<e.lng&&180>e.lat&&(t=l.convertLL2MC({lng:t.lng,lat:t.lat}),e=l.convertLL2MC({lng:e.lng,lat:e.lat})),{minX:t.lng,minY:t.lat,maxX:e.lng,maxY:e.lat}}}]),e}(qe);F.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(K(t,0,i?e[0]*r:t.length,r));if(i){i=0;for(var a=e.length;i<a;i++)o-=Math.abs(K(t,e[i]*r,i<a-1?e[i+1]*r:t.length,r))}for(i=e=0;i<n.length;i+=3){a=n[i]*r;var s=n[i+1]*r,u=n[i+2]*r;e+=Math.abs((t[a]-t[u])*(t[s+1]-t[a+1])-(t[a]-t[s])*(t[u+1]-t[a+1]))}return 0===o&&0===e?0:Math.abs((e-o)/o)},F.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);0<i&&(n+=t[i-1].length,r.holes.push(n))}return r},F.default=F;var nr=new R("./worker.js",(function(t,e){})),ir={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},or=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)))._isShow=!0,("windowAnimation"===(r=t.getOptions()).style||"ripple"===r.style||0<r.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,isTextureFull:!1,topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.dataMgr=new tt(this,this.gl),this.texture=null,this.isUseTexture=!1,this.program=new Ae(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec3 a_color;attribute vec3 a_pre_color;attribute float a_height;attribute float a_pre_height;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec3 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;if(u_use_texture){v_texture_coord=a_texture_coord;}vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec3 icolor=a_color;if(mapvIsPicked()){icolor=uSelectedColor.rgb;}if(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color=icolor+icolor*light_color*lambert+icolor*light_color_2*lambert_2+icolor*point_color*lambert_point;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec3 vLightWeighting;vLightWeighting=uAmbientColor+uDirectionalColor*directionalLightWeighting;v_color=vLightWeighting;}}else{v_color=icolor;}}",fragmentShader:"precision highp float;varying vec3 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec2 u_resolution;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color,alpha);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/u_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/u_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor.rgb*v_color*1.1,textureColor.a);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:["PICK"]},this),this.vertexBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Se({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var r=60;e.texture&&(r=68);var n=[{name:"a_pos",buffer:this.vertexBuffer,stride:r,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:r,type:"FLOAT",offset:16},{name:"a_color",buffer:this.vertexBuffer,size:3,stride:r,type:"FLOAT",offset:28},{name:"a_pre_color",buffer:this.vertexBuffer,size:3,stride:r,type:"FLOAT",offset:40},{name:"a_height",buffer:this.vertexBuffer,size:1,stride:r,type:"FLOAT",offset:52},{name:"a_pre_height",buffer:this.vertexBuffer,size:1,stride:r,type:"FLOAT",offset:56}];e.texture&&n.push({name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:r,type:"FLOAT",offset:60}),n=n.concat(this.getCommonAttributes()),this.vertexArray=new Oe({gl:t,program:this.program,attributes:n}),this.initializeTime=new Date,this.normalMatrix=ge.create()}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.dataMgr.parseData(e),r.dataTime=new Date,r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix,n=t.viewMatrix;if(this._isShow){var i=this.getData();if(i&&!(0>=i.length)){i=this.getOptions();var o=this.program;if(o.use(e),!i.texture||this.texture){e.enable(e.DEPTH_TEST),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,1);var a=e.isEnabled(e.BLEND),s=e.isEnabled(e.CULL_FACE);e.disable(e.CULL_FACE),i.blend&&(e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE),e.blendEquation(e.FUNC_ADD));var u=0;i.style&&ir[i.style]&&(u=ir[i.style]),"gradual"===i.style?(e.depthMask(!1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)):e.depthMask(!0);var l=this.normizedColor(i.topColor);if("ripple"===i.style&&i.rippleLayer&&i.rippleLayer.data&&i.rippleLayer.data[0]){var h=this.normizedPoint(i.rippleLayer.data[0].geometry.coordinates);o.setUniforms({u_ripple_center:[h[0],h[1],0],u_radius:i.rippleLayer.options.size*i.rippleLayer.currentScale})}h=fe.fromValues(0,-1,2),i.lightDir&&(h=fe.fromValues(i.lightDir[0],i.lightDir[1],i.lightDir[2]));var c=this.normalMatrix;ge.invert(c,n),ge.transpose(c,c),o.setUniforms(Object.assign(this.getCommonUniforms(t),{u_normal_matrix:c,u_sampler:this.texture,u_resolution:[e.canvas.width,e.canvas.height],u_proj_matrix:r,u_mv_matrix:n,style:u,top_color:l,u_use_lighting:i.useLight,u_use_texture:this.isUseTexture,alpha:void 0===i.opacity?.8:parseFloat(i.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:i.riseTime,u_side_light_dir:h})),0<(t=this.dataMgr.getData()).vertex.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,t.index.length,e.UNSIGNED_INT,0)),i.blend&&!1===a&&e.disable(e.BLEND),s&&e.enable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.depthMask(!0),e.disable(e.POLYGON_OFFSET_FILL)}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?(this.isUseTexture=!0,O(this.gl,r.texture,(function(r,n){e.image=n,e.texture=r,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(qe);tt.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],index:[]}},tt.prototype.getData=function(){return this.outBuilding3d},tt.prototype.initWorker=function(){this.worker=new nr,this.worker.onmessage=function(t){}},tt.prototype.parseData=function(t){var e=this;this.initData();for(var r=this.shapeLayer.getOptions(),n=0;n<t.length;n++){var i=t[n],o=i.height||0;"properties"in i&&"height"in i.properties&&(o=i.properties.height),o*=1;var a=i.color||r.color;"properties"in i&&"color"in i.properties&&(a=i.properties.color),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(i)),a=this.shapeLayer.normizedColor(a);var s=void 0;r.enablePicked&&(s=this.shapeLayer.indexToRgb(n));var u=void 0,l=void 0;if(r.riseTime&&(l=i.preColor,"properties"in i&&"preColor"in i.properties&&(l=i.properties.preColor),u=i.preHeight,"properties"in i&&"preHeight"in i.properties&&(u=i.properties.preHeight),void 0===u&&(u=0)),i.geometry.coordinates)if("MultiPolygon"===i.geometry.type)for(var h=i.geometry.coordinates,c=function(t){var r=[],n=[];i.geometry.coordinates[t][0].forEach((function(t){t=e.shapeLayer.normizedPoint(t),r.push(t[0],t[1]),n.push(t[2])})),e.parseBuilding3d(r,n,u,o,l,a,s,e.outBuilding3d)},f=0;f<h.length;f++)c(f);else!function(){var t=[],r=[];i.geometry.coordinates[0].forEach((function(n){n=e.shapeLayer.normizedPoint(n),t.push(n[0],n[1]),r.push(n[2])})),e.parseBuilding3d(t,r,u,o,l,a,s,e.outBuilding3d)}()}for(t=[],n=this.outBuilding3d.vertex.length,h=[],f=0;f<n;f++){c=this.outBuilding3d.vertex[f].length,t.push(this.outBuilding3d.vertex[f][0]),t.push(this.outBuilding3d.vertex[f][1]);for(var p=2;p<c;p++)t.push(this.outBuilding3d.vertex[f][p]);r.enablePicked&&(h.push(this.outBuilding3d.pickColorVertex[f][0]/255),h.push(this.outBuilding3d.pickColorVertex[f][1]/255),h.push(this.outBuilding3d.pickColorVertex[f][2]/255))}this.shapeLayer.vertexBuffer.updateData(new Float32Array(t)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),r.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(h))},tt.prototype.getBounds=function(t){for(var e=t[0],r=t[1],n=t[0],i=t[1],o=0;o<t.length;o+=2)e=Math.min(t[o],e),r=Math.min(t[o+1],r),n=Math.max(t[o],n),i=Math.max(t[o+1],i);return{minX:e,minY:r,maxX:n,maxY:i,width:n-e,height:i-r}},tt.prototype.parseBuilding3d=function(t,e,r,n,i,o,a,s){void 0===r&&(r=n);var u=this.shapeLayer.options,l=s.vertex,h=s.pickColorVertex;s=s.index,o=o||[.328125,.51953125,.8125],void 0===i&&(i=o);var c=0,f=0;if(this.shapeLayer.image&&(c=this.shapeLayer.image.width*u.textureScale,f=this.shapeLayer.image.height*u.textureScale),"gradual"!=u.style){var p=F(t),d=p[0],v=p[1],g=p[2];d=[t[2*d],t[2*d+1],1],v=[t[2*v],t[2*v+1],1];var m=[t[2*g],t[2*g+1],1];if(g=[],fe.cross(g,[m[0]-v[0],m[1]-v[1],m[2]-v[2]],[d[0]-v[0],d[1]-v[1],d[2]-v[2]]),v=l.length,u.texture)var y=this.getBounds(t);d=u.isTextureFull,m=0;for(var b=t.length;m<b;m+=2){var x=[t[m],t[m+1],e[m/2],1,g[0],g[1],g[2],o[0],o[1],o[2],i[0],i[1],i[2]];x.push(n),x.push(r),u.texture&&(d?(x.push((t[m]-y.minX)/y.width),x.push((t[m+1]-y.minY)/y.height)):(x.push((t[m]-y.minX)/c),x.push((t[m+1]-y.minY)/f))),l.push(x),a&&h.push(a)}for(y=0,g=p.length;y<g;y++)s.push(p[y]+v)}if(!(n===r&&0>=n))for(p=0,y=t.length;p<y;p+=2){g=[b=t[p],x=t[p+1],e[p/2],0],v=[b,x,e[p/2],1],m=p+2;var _=p+3;p===y-2&&(m=0,_=1),m=t[m],_=t[_],x=Math.sqrt(Math.pow(m-b,2),Math.pow(_-x,2)),b=[m,_,e[p/2],0],m=[m,_,e[p/2],1],_=[],fe.cross(_,[b[0]-g[0],b[1]-g[1],b[2]-g[2]],[v[0]-g[0],v[1]-g[1],v[2]-g[2]]),g.push(_[0],_[1],_[2]),v.push(_[0],_[1],_[2]),b.push(_[0],_[1],_[2]),m.push(_[0],_[1],_[2]),g.push(o[0],o[1],o[2]),g.push(i[0],i[1],i[2]),v.push(o[0],o[1],o[2]),v.push(i[0],i[1],i[2]),b.push(o[0],o[1],o[2]),b.push(i[0],i[1],i[2]),m.push(o[0],o[1],o[2]),m.push(i[0],i[1],i[2]),g.push(n),g.push(r),v.push(n),v.push(r),b.push(n),b.push(r),m.push(n),m.push(r),u.texture&&(d?(g.push(0,0),v.push(0,1),b.push(1,0),m.push(1,1)):(g.push(0,0),v.push(0,n/f),b.push(x/c,0),m.push(x/c,n/f))),x=l.length,l.push(g),l.push(v),l.push(b),l.push(m),a&&(h.push(a),h.push(a),h.push(a),h.push(a)),s.push(x,x+2,x+3,x,x+3,x+1)}};var ar=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).preHeightMapper={},t.preColorMapper={},t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return Object.assign(Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,e){var r=e.gridSize,n=[],i={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates);s=~~((s[0]+o[0])/r)+"_"+~~((s[1]+o[1])/r),void 0===i[s]&&(i[s]=0);var u=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(u=~~t[a].properties.count),i[s]+=u}return Object.keys(i).forEach((function(t){var e=t.split("_");n.push([e[0]*r+r/2,e[1]*r+r/2,i[t]])})),n}},{key:"onChanged",value:function(t,r){r=this.processData(r),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onChanged",this).call(this,t,r)}},{key:"getGridDataRange",value:function(){var t=this.gridData,e=void 0,r=void 0;t[0]&&(e=t[0][2],r=t[0][2]);for(var n=t.length,i=0;i<n;i++){var o=t[i];e=Math.max(o[2],e),r=Math.min(o[2],r)}return{max:e/2,min:r}}},{key:"processData",value:function(t){var e=this.getOptions(),r=e.style,n=e.gridSize,i=[];if(this.gridData=i,"normal"===r){r=this.getPointOffset();for(var a=0;a<t.length;a++){var s=this.normizedPoint(t[a].geometry.coordinates),u=s[0]+r[0];s=s[1]+r[1];var l=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(l=~~t[a].properties.count);var h=t[a].color;"properties"in t[a]&&"color"in t[a].properties&&(h=~~t[a].properties.color),i.push([u,s,l,h])}}else i=this.generateGrid(t,e);for(t=[],this._preHeightMapper={},this._preColorMapper={},r=0;r<i.length;r++)(a=i[r])[0]=a[0],a[1]=a[1],u=a[2],e.height&&(u="function"===typeof e.height?e.height({count:a[2]}):e.height),s=n/2-5,l=a[3],e.color&&(l="function"===typeof e.color?e.color({count:a[2],color:a[3]}):o(l).unitArray()),h="p"+a[0]+a[1],t.push({geometry:{type:"Polygon",coordinates:[[[a[0]-s,a[1]-s],[a[0]-s,a[1]+s],[a[0]+s,a[1]+s],[a[0]+s,a[1]-s]]]},color:l,preHeight:this.preHeightMapper[h],preColor:this.preColorMapper[h],height:u}),this._preHeightMapper[h]=u,this._preColorMapper[h]=l;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,t}}]),e}(or),sr=function(t){function e(t){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ht(e,t),Nt(e,[{key:"initialize",value:function(t){var e=this;this.children&&this.children.forEach((function(r){r.setWebglLayer(e.getWebglLayer()),r.initialize&&r.initialize(t)}))}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"isRequestAnimation",this).call(this);for(var t=!1,r=0;r<this.children.length;r++)if(this.children[r].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach((function(e){e.render(t)}))}}]),e}(Pe),ur=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).gridLayer=new ar(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return Ht(e,t),Nt(e,[{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),e=t.max,r=t.min;void 0===e&&(e=(r=this.gridLayer.getGridDataRange()).max,r=r.min);var n=new T({max:e,min:r,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(t){var e=n.getSize(t.count);return"properties"in t&&"count"in t.properties&&(e=n.getSize(t.properties.count)),e},t.color=function(t){var e=n.getImageData(t.count);return"properties"in t&&"count"in t.properties&&(e=n.getImageData(t.properties.count)),[e[0]/255,e[1]/255,e[2]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),e}(sr),lr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferData=[],t}return Ht(e,t),Nt(e,[{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:e.useDash?["DASH"]:""},this),this.buffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Oe({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){var n=[],i=function(t,e){if(t)for(var i=0;i<t.length-1;i++){var o=r.normizedPoint(t[i]);n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(e[0],e[1],e[2],e[3]),o=r.normizedPoint(t[i+1]),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(e[0],e[1],e[2],e[3])}};t=t.color;for(var o=0;o<e.length;o++){var a=e[o].color||t;"properties"in e[o]&&"color"in e[o].properties&&(a=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(e[o])),a=this.normizedColor(a);var s=e[o].geometry,u=s.coordinates;if("MultiPolygon"===s.type){if(u)for(s=0;s<u.length;s++)i(u[s][0],a)}else if("Polygon"===s.type)u&&i(u[0],a);else if("MultiLineString"===s.type){if(u)for(s=0;s<u.length;s++)i(u[s],a)}else i(u,a)}this.bufferData=n,this.buffer.updateData(new Float32Array(n))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var r=this.program;r.use(e),this.vertexArray.bind(),r.setUniforms({u_matrix:t}),t=this.getOptions().blend,e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.LINES,0,this.bufferData.length/7),e.disable(e.BLEND),e.disable(e.DEPTH_TEST)}}}]),e}(qe),hr="undefined"!==typeof t?t:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},cr=[],fr=[],pr="undefined"!==typeof Uint8Array?Uint8Array:Array,dr=!1,vr={}.toString,gr=Array.isArray||function(t){return"[object Array]"==vr.call(t)};st.TYPED_ARRAY_SUPPORT=void 0===hr.TYPED_ARRAY_SUPPORT||hr.TYPED_ARRAY_SUPPORT,st.poolSize=8192,st._augment=function(t){return t.__proto__=st.prototype,t},st.from=function(t,e,r){return ut(null,t,e,r)},st.TYPED_ARRAY_SUPPORT&&(st.prototype.__proto__=Uint8Array.prototype,st.__proto__=Uint8Array),st.alloc=function(t,e,r){return lt(t),t=0>=t?at(null,t):void 0!==e?"string"===typeof r?at(null,t).fill(e,r):at(null,t).fill(e):at(null,t)},st.allocUnsafe=function(t){return ht(null,t)},st.allocUnsafeSlow=function(t){return ht(null,t)},st.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Rt(t)||"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&Rt(t.slice(0,0)))},st.compare=function(t,e){if(!pt(t)||!pt(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},st.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},st.concat=function(t,e){if(!gr(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return st.alloc(0);var r;if(void 0===e)for(r=e=0;r<t.length;++r)e+=t[r].length;e=st.allocUnsafe(e);var n=0;for(r=0;r<t.length;++r){var i=t[r];if(!pt(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(e,n),n+=i.length}return e},st.byteLength=dt,st.prototype._isBuffer=!0,st.prototype.swap16=function(){var t=this.length;if(0!==t%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)gt(this,e,e+1);return this},st.prototype.swap32=function(){var t=this.length;if(0!==t%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)gt(this,e,e+3),gt(this,e+1,e+2);return this},st.prototype.swap64=function(){var t=this.length;if(0!==t%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)gt(this,e,e+7),gt(this,e+1,e+6),gt(this,e+2,e+5),gt(this,e+3,e+4);return this},st.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?bt(this,0,t):vt.apply(this,arguments)},st.prototype.equals=function(t){if(!pt(t))throw new TypeError("Argument must be a Buffer");return this===t||0===st.compare(this,t)},st.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},st.prototype.compare=function(t,e,r,n,i){if(!pt(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),0>e||r>t.length||0>n||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a);for(n=this.slice(n,i),t=t.slice(e,r),e=0;e<s;++e)if(n[e]!==t[e]){o=n[e],a=t[e];break}return o<a?-1:a<o?1:0},st.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},st.prototype.indexOf=function(t,e,r){return mt(this,t,e,r,!0)},st.prototype.lastIndexOf=function(t,e,r){return mt(this,t,e,r,!1)},st.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"===typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),0<t.length&&(0>r||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");for(n||(n="utf8"),i=!1;;)switch(n){case"hex":t:{if(e=Number(e)||0,n=this.length-e,r?(r=Number(r))>n&&(r=n):r=n,0!==(n=t.length)%2)throw new TypeError("Invalid hex string");for(r>n/2&&(r=n/2),n=0;n<r;++n){if(i=parseInt(t.substr(2*n,2),16),isNaN(i)){t=n;break t}this[e+n]=i}t=n}return t;case"utf8":case"utf-8":return Ot(At(t,this.length-e),this,e,r);case"ascii":return Ot(St(t),this,e,r);case"latin1":case"binary":return Ot(St(t),this,e,r);case"base64":return Ot(Lt(t),this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=t,i=this.length-e;for(var o=[],a=0;a<n.length&&!(0>(i-=2));++a){var s=n.charCodeAt(a);t=s>>8,s%=256,o.push(s),o.push(t)}return Ot(o,this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},st.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var mr=4096;st.prototype.slice=function(t,e){var r=this.length;if(0>(t=~~t)?0>(t+=r)&&(t=0):t>r&&(t=r),0>(e=void 0===e?r:~~e)?0>(e+=r)&&(e=0):e>r&&(e=r),e<t&&(e=t),st.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,e)).__proto__=st.prototype;else{e=new st(r=e-t,void 0);for(var n=0;n<r;++n)e[n]=this[n+t]}return e},st.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||xt(t,e,this.length),r=this[t];for(var n=1,i=0;++i<e&&(n*=256);)r+=this[t+i]*n;return r},st.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||xt(t,e,this.length),r=this[t+--e];for(var n=1;0<e&&(n*=256);)r+=this[t+--e]*n;return r},st.prototype.readUInt8=function(t,e){return e||xt(t,1,this.length),this[t]},st.prototype.readUInt16LE=function(t,e){return e||xt(t,2,this.length),this[t]|this[t+1]<<8},st.prototype.readUInt16BE=function(t,e){return e||xt(t,2,this.length),this[t]<<8|this[t+1]},st.prototype.readUInt32LE=function(t,e){return e||xt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},st.prototype.readUInt32BE=function(t,e){return e||xt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},st.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||xt(t,e,this.length),r=this[t];for(var n=1,i=0;++i<e&&(n*=256);)r+=this[t+i]*n;return r>=128*n&&(r-=Math.pow(2,8*e)),r},st.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||xt(t,e,this.length),r=e;for(var n=1,i=this[t+--r];0<r&&(n*=256);)i+=this[t+--r]*n;return i>=128*n&&(i-=Math.pow(2,8*e)),i},st.prototype.readInt8=function(t,e){return e||xt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},st.prototype.readInt16LE=function(t,e){return e||xt(t,2,this.length),32768&(t=this[t]|this[t+1]<<8)?4294901760|t:t},st.prototype.readInt16BE=function(t,e){return e||xt(t,2,this.length),32768&(t=this[t+1]|this[t]<<8)?4294901760|t:t},st.prototype.readInt32LE=function(t,e){return e||xt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},st.prototype.readInt32BE=function(t,e){return e||xt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},st.prototype.readFloatLE=function(t,e){return e||xt(t,4,this.length),it(this,t,!0,23,4)},st.prototype.readFloatBE=function(t,e){return e||xt(t,4,this.length),it(this,t,!1,23,4)},st.prototype.readDoubleLE=function(t,e){return e||xt(t,8,this.length),it(this,t,!0,52,8)},st.prototype.readDoubleBE=function(t,e){return e||xt(t,8,this.length),it(this,t,!1,52,8)},st.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||_t(this,t,e,r,Math.pow(2,8*r)-1,0),n=1;var i=0;for(this[e]=255&t;++i<r&&(n*=256);)this[e+i]=t/n&255;return e+r},st.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||_t(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1;for(this[e+(n=r-1)]=255&t;0<=--n&&(i*=256);)this[e+n]=t/i&255;return e+r},st.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,1,255,0),st.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},st.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,2,65535,0),st.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):wt(this,t,e,!0),e+2},st.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,2,65535,0),st.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):wt(this,t,e,!1),e+2},st.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,4,4294967295,0),st.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Mt(this,t,e,!0),e+4},st.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,4,4294967295,0),st.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Mt(this,t,e,!1),e+4},st.prototype.writeIntLE=function(t,e,r,n){t=+t,e|=0,n||_t(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n),n=0;var i=1,o=0;for(this[e]=255&t;++n<r&&(i*=256);)0>t&&0===o&&0!==this[e+n-1]&&(o=1),this[e+n]=(t/i>>0)-o&255;return e+r},st.prototype.writeIntBE=function(t,e,r,n){t=+t,e|=0,n||_t(this,t,e,r,(n=Math.pow(2,8*r-1))-1,-n);var i=1,o=0;for(this[e+(n=r-1)]=255&t;0<=--n&&(i*=256);)0>t&&0===o&&0!==this[e+n+1]&&(o=1),this[e+n]=(t/i>>0)-o&255;return e+r},st.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,1,127,-128),st.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=255&t,e+1},st.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,2,32767,-32768),st.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):wt(this,t,e,!0),e+2},st.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,2,32767,-32768),st.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):wt(this,t,e,!1),e+2},st.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,4,2147483647,-2147483648),st.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Mt(this,t,e,!0),e+4},st.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||_t(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),st.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Mt(this,t,e,!1),e+4},st.prototype.writeFloatLE=function(t,e,r){return Tt(this,t,e,!0,r)},st.prototype.writeFloatBE=function(t,e,r){return Tt(this,t,e,!1,r)},st.prototype.writeDoubleLE=function(t,e,r){return Pt(this,t,e,!0,r)},st.prototype.writeDoubleBE=function(t,e,r){return Pt(this,t,e,!1,r)},st.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),0<n&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;if(this===t&&r<e&&e<n)for(n=i-1;0<=n;--n)t[n+e]=this[n+r];else if(1e3>i||!st.TYPED_ARRAY_SUPPORT)for(n=0;n<i;++n)t[n+e]=this[n+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+i),e);return i},st.prototype.fill=function(t,e,r,n){if("string"===typeof t){if("string"===typeof e?(n=e,e=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);256>i&&(t=i)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!st.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof t&&(t&=255);if(0>e||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"===typeof t)for(n=e;n<r;++n)this[n]=t;else for(i=(t=pt(t)?t:At(new st(t,n).toString())).length,n=0;n<r-e;++n)this[n+e]=t[n%i];return this};var yr,br,xr=/[^+\/0-9A-Za-z-_]/g,_r=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).initData(),t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:4,lineJoin:"miter"}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[]}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform vec2 resolution;uniform float thickness;uniform int miter;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;varying vec4 vColor;void main(){float aspect=resolution.x/resolution.y;vec2 aspectVec=vec2(aspect,1.0);vec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=currentProjected.xy/currentProjected.w*aspectVec;vec2 previousScreen=previousProjected.xy/previousProjected.w*aspectVec;vec2 nextScreen=nextProjected.xy/nextProjected.w*aspectVec;float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(abs(previousScreen.x-currentScreen.x)<=0.000001&&abs(previousScreen.y-currentScreen.y)<=0.000001){dir=normalize(nextScreen-currentScreen);}else if(abs(nextScreen.x-currentScreen.x)<=0.000001&&abs(nextScreen.y-currentScreen.y)<=0.000001){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);normal*=len/2.0;normal.x/=aspect;vec4 offset=vec4(normal*orientation,0.0,1.0);vColor=aColor;gl_Position=currentProjected+offset;}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"},this),this.prevBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Se({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Oe({gl:t,program:this.program,attributes:[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}]})}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){this.initData(),t=t.color;for(var n=0;n<e.length;n++){var i=[],o=e[n].geometry.coordinates;o&&0<o.length&&(i="Polygon"===e[n].geometry.type?o[0].map((function(t){return r.normizedPoint(t)})):o.map((function(t){return r.normizedPoint(t)}))),o=e[n].color||t,"properties"in e[n]&&"color"in e[n].properties&&(o=e[n].properties.color),"[object Function]"===Object.prototype.toString.call(o)&&(o=o(e[n])),o=this.normizedColor(o),this.processData(this.dataMgr,i,o)}this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index))}}},{key:"processData",value:function(t,e,r){var n,i,o,a,s,u,l=e.length,h=t.position.length/6,c=Ct(e.map((function(t){return 1})),!0),f=Ct(e),p=Ct(e.map(kt(-1))),d=Ct(e.map(kt(1)));e=Ct(e.map((function(t){return r}))),l=function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=[],n=0;n<t-1;n++){var i=2*(n+e);r.push(i,i+1,i+2),r.push(i+2,i+1,i+3)}return r}(l,h),(n=t.position).push.apply(n,Vt(Bt(f))),(i=t.prev).push.apply(i,Vt(Bt(p))),(o=t.next).push.apply(o,Vt(Bt(d))),(a=t.direction).push.apply(a,Vt(c)),(s=t.color).push.apply(s,Vt(Bt(e))),(u=t.index).push.apply(u,Vt(l))}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var r=this.dataMgr;if(r&&!(0>=r.index.length)){var n=this.getOptions(),i=this.program;i.use(e),i.setUniforms({u_matrix:t,miter:1,thickness:n.width,resolution:[e.canvas.width,e.canvas.height]}),e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.blendEquation(e.FUNC_ADD),n.blend&&"lighter"===n.blend?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,r.index.length,e.UNSIGNED_INT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST)}}}]),e}(qe),wr=function(){function t(e,r){jt(this,t),this.layer=e,this.gl=r,this.initData()}return Nt(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var r=t.color,n=t.height,i=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||r,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),i||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(i?i[0]:s),s=this.layer.normizedColor(i?i[1]:s),l=e[o].height||n,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(r=[],n=this.outWall3d.vertex[e].length,i=0;i<n;i++)r.push.apply(r,Vt(this.outWall3d.vertex[e][i]));n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=n,t.bindBuffer(t.ARRAY_BUFFER,null),n=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=n,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,n,i){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;(!o||65536<=o.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t);for(var u=t=0;u<s;u++){var l=[],h=[],c=e[u];l.push(c[0],c[1]),l.push(c[2]?Number(c[2])+i:i),l.push(c[3]?Number(c[3]):u),l.push(t),l.push(r[0],r[1],r[2],r[3]),h.push(c[0],c[1]),h.push(c[2]?Number(c[2]):0),h.push(c[3]?Number(c[3]):u),h.push(t),h.push(n[0],n[1],n[2],n[3]),c=o.length,o.push(l,h),a.push(c,c+1),u<s-1&&(t+=this.getDistance(e[u],e[u+1]))}}},{key:"getDistance",value:function(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}}]),t}(),Mr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new wr(this,this.gl),this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),i=this.program;for(e.useProgram(i.program),e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aDistance),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,r),e.uniform1f(i.uniforms.currentTime,this.time),e.uniform1f(i.uniforms.trailLength,n.trailLength),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var o=t.vertex[r],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(i.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aDistance,1,e.FLOAT,!1,o,4*a),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,5*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),e.disable(e.DEPTH_TEST),this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}}]),e}(qe),Er=(Yt(yr={},1,1),Yt(yr,2,1),Yt(yr,3,1),yr),Tr=(Yt(br={},1,1),Yt(br,2,1),Yt(br,3,1),br),Pr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferMap={},t.bufferData=[],t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.updateUniformsFromOptions(e),this.program=new Ae(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;uniform float uSize;uniform mat4 u_matrix;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;varying float vAddOpacity;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float percent=mod(uElapsedSteps,aLength)/aLength;if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}gl_PointSize=uSize;}",fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;varying float vAddOpacity;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,e,r,n){var i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),r=new Float32Array(r),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.bufferMap[e]={buffer:i,data:r,elementSize:n}}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){Array.isArray(e)||(e=[]),this.updateUniformsFromOptions(t);var n=[],i=[],o=[],a=[],s=[];t=t.minLineLength;for(var u=0;u<e.length;u++){var l=e[u].geometry.coordinates,h=l.length;if(!(h<t)){for(var c=0;c<h;++c){var f=this.normizedPoint(l[c]);n.push(f[0]),n.push(f[1]),n.push(f[2]||0),3!==this.animationType&&(i.push(c),a.push(h))}if(1!==this.animationType){for(f=n.length-3*h+3,c=n.length,l=f;l<c;++l)s.push(n[l]);if(n.splice(c-3,3),2===this.animationType)i.pop(),a.pop();else if(3===this.animationType){f-=3,c=n.length-3,l=0,h=[];for(var p=f;p<=c;p+=3)l+=f=Math.sqrt(Math.pow(s[p]-n[p],2)+Math.pow(s[p+1]-n[p+1],2)+Math.pow(s[p+2]-n[p+2],2)),h.push(f);i.push(0),p=c=0;for(var d=h.length-1;p<d;++p)f=(c+=h[p])/l,i.push(f),o.push(f),a.push(l);o.push(1),a.push(l)}}}}this.bindAttributeBufferData(r,"aPos",n,3),this.bindAttributeBufferData(r,"aIndex",i,1),this.bindAttributeBufferData(r,"aLength",a,1),1!==this.animationType&&(this.bindAttributeBufferData(r,"aNextPos",s,3),3===this.animationType&&this.bindAttributeBufferData(r,"aNextIndex",o,1)),this.vertCount=n.length/3}}},{key:"updateUniformsFromOptions",value:function(t){this.color=this.normizedColor(t.color),this.startTime=(new Date).getTime(),Er[t.animationType]||(t.animationType=2),Tr[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,e,r){if(void 0!==e.attributes[r]){var n=this.bufferMap[r];n&&(t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.enableVertexAttribArray(e.attributes[r]),t.vertexAttribPointer(e.attributes[r],n.elementSize,t.FLOAT,!1,n.data.BYTES_PER_ELEMENT*n.elementSize,0))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var r=this.program;e.useProgram(r.program),this.renderAttributeArr(e,r,"aPos"),this.renderAttributeArr(e,r,"aIndex"),this.renderAttributeArr(e,r,"aLength"),1!==this.animationType&&(this.renderAttributeArr(e,r,"aNextPos"),3===this.animationType&&this.renderAttributeArr(e,r,"aNextIndex"));var n=(new Date).getTime()-this.startTime;n=1===this.animationType?Math.round(n/1e3*this.options.speed*20):3===this.animationType?n/1e3*this.options.speed*1e3:n/1e3*this.options.speed,e.uniformMatrix4fv(r.uniforms.u_matrix,!1,t),e.uniform4f(r.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]),e.uniform1f(r.uniforms.uSize,this.options.size),e.uniform1f(r.uniforms.uElapsedSteps,n),e.uniform1i(r.uniforms.uAnimationType,this.animationType),e.uniform1i(r.uniforms.ushapeType,this.options.shapeType),e.uniform1i(r.uniforms.uPointFade,this.options.pointFade?1:0),e.uniform1f(r.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),t=this.options.blend,r=this.options.depthTest,e.enable(e.BLEND),r&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.POINTS,0,this.vertCount),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.useProgram(null)}}}]),e}(qe);Pr.ANIMATION_TYPE_LEAP=1,Pr.ANIMATION_TYPE_SMOOTH=2,Pr.ANIMATION_TYPE_UNIFORM_SPEED=3,Pr.SHAPE_TYPE_SQUARE=1,Pr.SHAPE_TYPE_CIRCLE=2,Pr.SHAPE_TYPE_CIRCLE_GRADIENT=3;var Ar=function(){function t(e,r){jt(this,t),this.layer=e,this.gl=r,this.initData()}return Nt(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(t,e){this.initData();for(var r=t.color,n=t.height,i=t.gradient,o=t.enablePreciseMap,a=this.gl,s=0;s<e.length;s++){for(var u=e[s].geometry.coordinates,l=u.length,h=[],c=[],f=0,p=0;p<l;p++){var d=this.layer.normizedPoint(u[p]);if(0<p&&o){var v=this.layer.normizedPoint(u[p-1]);f+=Math.sqrt(Math.pow(d[0]-v[0],2),Math.pow(d[1]-v[1],2))}h.push(d),c.push(f)}l=e[s].color||r,"properties"in e[s]&&"color"in e[s].properties&&(l=e[s].properties.color),i||"[object Function]"!==Object.prototype.toString.call(l)||(l=l(e[s])),u=this.layer.normizedColor(i?i[0]:l),l=this.layer.normizedColor(i?i[1]:l),f=e[s].height||n,"properties"in e[s]&&"height"in e[s].properties&&(f=e[s].properties.height),"[object Function]"===Object.prototype.toString.call(f)&&(f=f(e[s])),this.processData(this.outWall3d,t,h,c,u,l,f)}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],r=this.outWall3d.vertex[t].length,n=0;n<r;n++)e.push.apply(e,Vt(this.outWall3d.vertex[t][n]));r=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,r),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=r,a.bindBuffer(a.ARRAY_BUFFER,null),r=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),a.STATIC_DRAW),this.outWall3d.indexBuffer[t]=r,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,n,i,o,a){var s=n[n.length-1],u=t.vertex[t.vertex.length-1],l=t.index[t.index.length-1],h=r.length;for((!u||65536<=u.length+2*h+2)&&(u=[],l=[],t.vertex.push(u),t.index.push(l)),(t=u.length)&&l.push(t-1,t),t=0;t<h;t++){var c=[],f=[],p=r[t];c.push(p[0],p[1],a),c.push(i[0],i[1],i[2],i[3]),f.push(p[0],p[1],0),f.push(o[0],o[1],o[2],o[3]),e.texture&&(p=n[t],e.enablePreciseMap?(c.push(p/s,1),f.push(p/s,0)):(c.push(t/(h-1),1),f.push(t/(h-1),0))),p=u.length,u.push(c,f),l.push(p,p+1)}}}]),t}(),Sr=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Ar(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.dataMgr.onLayerChange(t,e),r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),i=this.program;if(e.useProgram(i.program),e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),n.texture){if(!this.texture)return;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(i.uniforms.uSampler,0),e.depthMask(!0),e.depthFunc(e.LESS)}else e.depthMask(!1),e.depthFunc(e.LEQUAL);for(n.texture?e.enableVertexAttribArray(i.attributes.aTextureCoords):e.disableVertexAttribArray(i.attributes.aTextureCoords),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,r),e.uniform1i(i.uniforms.uUseTexture,this.isUseTexture),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var o=t.vertex[r],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,3*a),n.texture&&e.vertexAttribPointer(i.attributes.aTextureCoords,2,e.FLOAT,!1,o,7*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.useProgram(null)}}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?(this.isUseTexture=!0,O(this.gl,r.texture,(function(r,n){e.image=n,e.texture=r,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(qe),Lr=function(){function t(e,r){jt(this,t),this.layer=e,this.gl=r,this.initData()}return Nt(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var r=t.color,n=t.height,i=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||r,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),i||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(i?i[0]:s),s=this.layer.normizedColor(i?i[1]:s),l=e[o].height||n,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(r=[],n=this.outWall3d.vertex[e].length,i=0;i<n;i++)r.push.apply(r,Vt(this.outWall3d.vertex[e][i]));n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=n,t.bindBuffer(t.ARRAY_BUFFER,null),n=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=n,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,n,i){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;for((!o||65536<=o.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t),t=0;t<s;t++){var u=[],l=[],h=e[t];u.push(h[0],h[1]),u.push(h[2]?Number(h[2])+i:i),u.push(h[3]?Number(h[3]):t),u.push(r[0],r[1],r[2],r[3]),l.push(h[0],h[1]),l.push(h[2]?Number(h[2]):0),l.push(h[3]?Number(h[3]):t),l.push(n[0],n[1],n[2],n[3]),h=o.length,o.push(u,l),a.push(h,h+1)}}}]),t}(),Or=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Lr(this,this.gl),this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),i=this.program;for(e.useProgram(i.program),e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enableVertexAttribArray(i.attributes.aPos),e.enableVertexAttribArray(i.attributes.aColor),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,r),e.uniform1f(i.uniforms.currentTime,this.time),e.uniform1f(i.uniforms.trailLength,n.trailLength),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var o=t.vertex[r],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(i.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,o,4*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),e.disable(e.DEPTH_TEST),this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}}]),e}(qe),Rr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).simpleLineLayer=new lr(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),e=t.max,r=t.min;void 0===e&&(e=(r=this.getDataRange()).max,r=r.min);var n=new T({max:e,min:r,gradient:t.gradient});return t.color=function(t){var e=~~t.count||1;return"properties"in t&&"count"in t.properties&&(e=~~t.properties.count),[(t=n.getImageData(e))[0]/255,t[1]/255,t[2]/255,t[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),e=0,r=0;t[0]&&(e=~~t[0].count||1,r=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(e=~~t[0].properties.count,r=~~t[0].properties.count);for(var n=t.length,i=0;i<n;i++){var o=~~t[i].count||1;"properties"in t[i]&&"count"in t[i].properties&&(o=~~t[i].properties.count),e=Math.max(o,e),r=Math.min(o,r)}return{max:e/2,min:r}}}]),e}(sr),Cr={circle:1,square:2},kr=function(t){function e(t){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).bufferData=[],t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ae(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;varying vec4 vColor;uniform vec4 uSelectedColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;uniform int uShape;void main(void){if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vColor;}}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}]).concat(this.getCommonAttributes()),this.vertexArray=new Oe({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){if(this.gl){for(var r=[],n=t.color,i=t.size,o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=e[o].color||n;"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(s)&&(s=s(e[o])),s=this.normizedColor(s),a=this.normizedPoint(a);var u=i;u="[object Function]"===Object.prototype.toString.call(u)?u(e[o]):Number(u),r.push(a[0],a[1],Number(a[2]||0)),r.push(s[0],s[1],s[2],s[3]),r.push(u*window.devicePixelRatio)}this.bufferData=r,this.buffer.updateData(new Float32Array(r)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),r=[];if(e.enablePicked)for(var n=0;n<t.length;n++){var i=this.indexToRgb(n);r.push(i[0]/255,i[1]/255,i[2]/255)}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(r))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){this.getOptions();var i=this.program;i.use(e),this.vertexArray.bind();var o=1;this.options.shape&&Cr[this.options.shape]&&(o=Cr[this.options.shape]),t=this.getCommonUniforms(t),t=Object.assign(t,{uShape:o,uMatrix:r}),i.setUniforms(t),r=this.options.blend,e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),n?e.disable(e.BLEND):(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),r&&"lighter"===r?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),e}(qe),Br=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r&&(this.currentScale=this.opacity=1,(this.data=e)&&e.length)){var n=t.color,i=t.segs;t=t.size;for(var o=360/i,a=0;a<e.length;a++){var s=[],u=[],l=this.normizedPoint(e[a].geometry.coordinates),h=e[a].color||n;"properties"in e[a]&&"color"in e[a].properties&&(h=e[a].properties.color),h=this.normizedColor(h);var c="[object Function]"===Object.prototype.toString.call(t)?t(e[a]):Number(t),f=l[0],p=l[1];s.push(0,0,-.5),s.push(h[0],h[1],h[2],0);for(var d=1,v=0;d<=i;d++,v+=o)s.push(l[0]-f+Math.cos(Math.PI/180*v)*c,l[1]-p+Math.sin(Math.PI/180*v)*c,-.5),s.push(h[0],h[1],h[2],this.opacity),d===i?u.push(0,0+d,1):u.push(0,0+d,0+d+1);h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,new Float32Array(s),r.STATIC_DRAW),this.vertexBuffer[a]=h,this.bufferDataArr[a]=s,r.bindBuffer(r.ARRAY_BUFFER,null),s=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),r.STATIC_DRAW),this.indexBuffer[a]=s,this.indexDataArr[a]=u,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),this.position[a]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix,n=t.viewMatrix;for(t=this.program,e.useProgram(t.program),e.enable(e.DEPTH_TEST),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(-1,-1),e.depthFunc(e.LEQUAL),e.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,r),e.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,n),r=this.opacity,void 0!==this.options.opacity&&(r=this.options.opacity),e.uniform1f(t.uniforms.u_opacity,r),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA),e.blendEquation(e.FUNC_ADD),e.enableVertexAttribArray(t.attributes.aPos),e.enableVertexAttribArray(t.attributes.aColor),r=0;r<this.bufferDataArr.length;r++)if(!(0>=this.bufferDataArr[r].length)){n=new Float32Array(this.bufferDataArr[r]).BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer[r]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,7*n,3*n),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,7*n,0),n=this.position[r];var i=ge.create(),o=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(o=this.map.getZoomUnits(),o=[this.currentScale*o,this.currentScale*o,this.currentScale]),ge.identity(i),ge.translate(i,i,[n[0],n[1],0]),ge.scale(i,i,o),e.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,i),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer[r]),e.drawElements(e.TRIANGLES,this.indexDataArr[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),t=(r=this.getOptions()).scale,r=r.step,this.opacity-=r/10,this.currentScale+=t*r,0>this.opacity&&(this.currentScale=this.opacity=1),e.useProgram(null)}}]),e}(qe),Dr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.segs=t.options.segs||10,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var n=[],i=t.height,o=0;o<e.length;o++)for(var a=e[o].geometry.coordinates,s="[object Function]"===Object.prototype.toString.call(i)?i(e[o]):Number(i),u=0,l=0;l<this.segs;l++){var h=this.normizedPoint(a);n.push(h[0],h[1],u),void 0===a[2]?n.push(l):n.push(Number(a[2])),u+=s/this.segs,n.push(h[0],h[1],u),void 0===a[2]?n.push(l+1):n.push(Number(a[2]))}void 0===t.endTime&&(this.endTime=this.segs),this.bufferData=n,r.bufferData(r.ARRAY_BUFFER,new Float32Array(n),r.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,0,0),r=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,r[0],r[1],r[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),e.enable(e.BLEND),e.enable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.polygonOffset(2,1),e.blendFunc(e.SRC_ALPHA,e.ONE),e.blendEquation(e.FUNC_ADD),e.drawArrays(e.LINES,0,this.bufferData.length/4),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),this.time+=this.options.step,this.time>1.5*this.endTime&&(this.time=this.startTime),e.useProgram(null)}}]),e}(qe),Fr=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return Object.assign(Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getDefaultOptions",this).call(this),{gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,e){!this.gl||1>e.length||(this.supercluster=new Te({maxZoom:t.maxZoom||19,radius:t.clusterRadius||100}),this.supercluster.load(e),this.refreshCluster(),t.enablePicked&&this.parsePickData(e))}},{key:"refreshCluster",value:function(){for(var t=this.data=this.getClusterData(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options),e=[],r=0;r<t.length;r++){var n=t[r],i=n.coordinates,o=n.color;n=n.size,o=this.normizedColor(o),i=this.normizedPoint(i),e.push(i[0],i[1],Number(i[2]||0)),e.push(o[0],o[1],o[2],o[3]),e.push(n*window.devicePixelRatio)}this.bufferData=e,this.buffer.updateData(new Float32Array(e))}},{key:"getClusterData",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=this.map.map;if(!this.sw||!this.ne){var r=e.getBounds(),n=r.getNorthEast();r=r.getSouthWest(),this.ne=e.mercatorToLnglat(n.lng,n.lat),this.sw=e.mercatorToLnglat(r.lng,r.lat)}return this.zoom=Math.round(this.map.map.getZoom()),e=this.supercluster.getClusters(this.sw.concat(this.ne),this.zoom),this.processData(e,t)}},{key:"processData",value:function(t,e){var r=e.maxSize||0,n=e.minSize||0;t.forEach((function(t){t=t.properties&&t.properties.pointCount||0,r=Math.max(r,t),n=Math.min(n,t)}));var i=new T({max:~~r,min:n,minSize:e.minSize||8,maxSize:e.maxSize||30,gradient:e.gradient});return t.map((function(t){var r=e.size,n=e.fillStyle,o=1;return t.properties&&t.properties.pointCount&&(o=t.properties.pointCount,r=i.getSize(o)||r,n=i.getColor(o)),{coordinates:t.geometry.coordinates,count:o,size:r,color:n}}))}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map.map;if(this.zoom!==Math.round(t.getZoom()))return!0;var e=t.getBounds(),r=e.getNorthEast();return e=e.getSouthWest(),r=t.mercatorToLnglat(r.lng,r.lat),e=t.mercatorToLnglat(e.lng,e.lat),this.ne.lng!==r.lng||this.ne.lat!==r.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat?(this.ne=r,this.sw=e,!0):void 0}},{key:"render",value:function(t){this.shouldUpdate()&&this.refreshCluster(),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this,t)}}]),e}(kr),zr=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return Object.assign(Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,r){this.gl&&(r=this.processData(r,t),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onChanged",this).call(this,t,r))}},{key:"generateGrid",value:function(t,e){var r=e.gridSize,n=[],i={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates);s=~~((s[0]+o[0])/r)+"_"+~~((s[1]+o[1])/r),void 0===i[s]&&(i[s]=0);var u=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(u=~~t[a].properties.count),i[s]+=u}return Object.keys(i).forEach((function(t){var e=t.split("_");n.push([e[0]*r+r/2,e[1]*r+r/2,i[t]])})),n}},{key:"processData",value:function(t,e){var r=[];if("normal"===e.style)for(var n=this.getPointOffset(),i=0;i<t.length;i++){var o=this.normizedPoint(t[i].geometry.coordinates);r.push([o[0]+n[0],o[1]+n[1],~~t[i].count||1])}else r=this.generateGrid(t,e);if(n=t=0,void 0!==e.max&&void 0!==e.min)t=e.max,n=e.min;else{for(r[0]&&(t=r[0][2],n=r[0][2]),i=r.length,o=0;o<i;o++){var a=r[o];t=Math.max(a[2],t),n=Math.min(a[2],n)}t/=2}for(e=new T({max:~~t,min:n,gradient:e.gradient}),t=[],n=0;n<r.length;n++)(i=r[n])[0]=i[0],i[1]=i[1],o=e.getImageData(i[2]),t.push({geometry:{type:"Point",coordinates:[i[0],i[1]]},color:[o[0]/255,o[1]/255,o[2]/255,o[3]/255]});return t}}]),e}(kr),Ir=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferData=[],t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,e){if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var r=[],n=0;20>n;n++)for(var i=5*n,o=0;o<e.length;o++)for(var a=e[o].geometry.coordinates,s=0;s<a.length-1;s++){var u=this.normizedPoint(a[s]);r.push(u[0]),r.push(u[1]),r.push(Number(i)),u=this.normizedPoint(a[s+1]),r.push(u[0]),r.push(u[1]),r.push(Number(i))}t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.bufferData=r,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var r=this.program;e.useProgram(r.program);var n=this.normizedColor(this.options.color);e.uniform4f(r.uniforms.uFragColor,n[0],n[1],n[2],n[3]),e.enable(e.DEPTH_TEST),e.uniformMatrix4fv(r.uniforms.uMatrix,!1,t),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE),e.drawArrays(e.LINES,0,this.bufferData.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.DEPTH_TEST)}}]),e}(qe),Ur={circle:1,square:2},jr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var n=[],i=t.color||[.1,.1,.9,1],o=t.size||5,a=0;a<e.length;a++){var s=e[a].geometry.coordinates,u=e[a].color||i;"[object Function]"===Object.prototype.toString.call(u)&&(u=u(e[a])),"properties"in e[a]&&"color"in e[a].properties&&(u=e[a].properties.color),u=this.normizedColor(u);var l=this.normizedPoint(s),h=o;h="[object Function]"===Object.prototype.toString.call(h)?h(e[a]):Number(h);var c=e[a].time||a;"properties"in e[a]&&"time"in e[a].properties&&(c=e[a].properties.time),n.push(l[0],l[1],Number(s[2]||0),c),n.push(u[0],u[1],u[2],u[3]),n.push(h*window.devicePixelRatio)}void 0===t.endTime&&(this.endTime=e.length),this.bufferData=n,this.f32BufferData=new Float32Array(n),r.bufferData(r.ARRAY_BUFFER,this.f32BufferData,r.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;0>=this.bufferData.length||(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),r=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,9*r,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,9*r,4*r),e.enableVertexAttribArray(t.attributes.aSize),e.vertexAttribPointer(t.attributes.aSize,1,e.FLOAT,!1,9*r,8*r),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),r=1,this.options.shape&&Ur[this.options.shape]&&(r=Ur[this.options.shape]),e.uniform1i(t.uniforms.uShape,r),t=this.options.blend,e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.blendEquation(e.FUNC_ADD),t&&"lighter"===t?e.blendFunc(e.SRC_ALPHA,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.POINTS,0,this.bufferData.length/9),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST),e.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),e}(qe),Nr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ae(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var n=[],i=0,o=this.options.color,a=0;a<e.length;a++){var s=e[a].geometry.coordinates;e[a].color&&(o=e[a].color),"properties"in e[a]&&"color"in e[a].properties&&(o=e[a].properties.color),"[object Function]"===Object.prototype.toString.call(o)&&(o=o(e[a])),o=this.normizedColor(o),s.length>i&&(i=s.length);for(var u=0;u<s.length-1;u++){var l=this.normizedPoint(s[u]);n.push(l[0]),n.push(l[1]),n.push(l[2]),void 0===s[u][3]?n.push(u):n.push(Number(s[u][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3]),l=this.normizedPoint(s[u+1]),n.push(l[0]),n.push(l[1]),n.push(l[2]),void 0===s[u+1][3]?n.push(u+1):n.push(Number(s[u+1][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3])}}void 0===t.endTime&&(this.endTime=i),this.bufferData=n,this.f32BufferData=new Float32Array(n),r.bufferData(r.ARRAY_BUFFER,this.f32BufferData,r.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;(t=this.program).use(e),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),r=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,8*r,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,8*r,4*r),r=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,r[0],r[1],r[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),e.enable(e.BLEND),e.enable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.polygonOffset(2,1),"lighter"===this.options.blend?e.blendFunc(e.ONE,e.ONE):e.blendFunc(e.SRC_ALPHA,e.ONE),e.blendEquation(e.FUNC_ADD),e.drawArrays(e.LINES,0,this.bufferData.length/8),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.disable(e.DEPTH_TEST),this.time+=this.options.step,this.time>this.endTime&&(this.time=this.startTime),e.useProgram(null)}}]),e}(qe),Yr=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Ae(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:e.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Se({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Oe({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.parseData(e),r.dataTime=new Date,r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix;t=t.viewMatrix;var n=this.getOptions(),i=this.program,o=i.uniforms;i.use(e),this.texture&&(e.activeTexture(e.TEXTURE0),e.uniform1i(o.uTile,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE1),e.uniform1i(o.uTerrain,1),e.bindTexture(e.TEXTURE_2D,this.terrainSampler),e.enable(e.DEPTH_TEST),e.disable(e.CULL_FACE),i.setUniforms({u_proj_matrix:r,uUseFilter:!!n.filterColor,uFilterColor:this.normizedColor(n.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.tile?r.terrain?O(this.gl,r.terrain,(function(n,i){e.terrainSampler=n,O(e.gl,r.tile,(function(r,n){e.texture=r,t&&t(),e.webglLayer.render()}))}),{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):O(this.gl,r.tile,(function(r,n){e.texture=r,t&&t(),e.webglLayer.render()})):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this,r=[],n=[];if(t&&t[0]){var i=t[0].geometry.coordinates[0];t=(i=i.map((function(t){return e.normizedPoint(t)})))[0][0];var o=i[0][1],a=i[0][2],s=(i[2][0]-t)/16;i=(i[2][1]-o)/16;for(var u=0;16>=u;u++)for(var l=0;16>=l;l++)if(r.push(t+s*l,o+i*u,a),r.push(l/16,u/16),16>l&&16>u){var h=17*u+l,c=17*(u+1)+l;n.push(h,c+1,h+1),n.push(h,c,c+1)}}this.index=n,this.vertexBuffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(n))}}]),e}(qe),Wr=function(t){function e(t,r){return jt(this,e),qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Ae(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform vec2 u_size;uniform vec2 u_offset;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);position.xyz=position.xyz/position.w;position.w=1.0;position.x=position.x+a_texture_coord.x*u_size.x/2.0/MAPV_resolution.x-u_offset.x/MAPV_resolution.x;position.y=position.y+a_texture_coord.y*u_size.y/2.0/MAPV_resolution.y-u_offset.y/MAPV_resolution.y;gl_Position=position;}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=vec4(1.0,1.0,1.0,1.0);vec2 textureCoord=v_texture_coord;textureCoord=(textureCoord+1.0)/2.0;textureColor=texture2D(u_icon,vec2(textureCoord.s,textureCoord.t));if(textureColor.a==0.0){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=uSelectedColor;}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Se({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]).concat(this.getCommonAttributes()),this.vertexArray=new Oe({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.parseData(e),r.dataTime=new Date,r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix,n=t.viewMatrix,i=this.getOptions(),o=this.program;if(o.use(e),this.texture){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);var a=i.width||this.image.width,s=i.height||this.image.height;a*=window.devicePixelRatio,s*=window.devicePixelRatio;var u=0,l=0;i.offset&&(u=i.offset[0]*window.devicePixelRatio,l=i.offset[1]*window.devicePixelRatio),o.setUniforms(Object.assign(this.getCommonUniforms(t),{u_icon:this.texture,u_proj_matrix:r,u_mv_matrix:n,u_size:[a,s],u_offset:[u,l]})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.icon?O(this.gl,r.icon,(function(r,n){e.image=n,e.texture=r,t&&t(),e.webglLayer.render()})):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){for(var e=this.getOptions(),r=[],n=[],i=[],o=0;o<t.length;o++){var a=this.normizedPoint(t[o].geometry.coordinates);r.push(a[0],a[1],a[2]),r.push(-1,-1),r.push(a[0],a[1],a[2]),r.push(-1,1),r.push(a[0],a[1],a[2]),r.push(1,1),r.push(a[0],a[1],a[2]),r.push(1,-1),n.push(4*o,4*o+1,4*o+2),n.push(4*o,4*o+2,4*o+3),e.enablePicked&&(a=this.indexToRgb(o),i.push(a[0]/255,a[1]/255,a[2]/255),i.push(a[0]/255,a[1]/255,a[2]/255),i.push(a[0]/255,a[1]/255,a[2]/255),i.push(a[0]/255,a[1]/255,a[2]/255))}this.index=n,this.vertexBuffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(n)),e.enablePicked&&this.pickBuffer.updateData(new Float32Array(i))}}]),e}(qe),Hr=function(t){function e(t,r){return jt(this,e),(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).shapeLayer=new or,t.lineLayer=new _r,t.children=[t.shapeLayer,t.lineLayer],t}return Ht(e,t),Nt(e,[{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1}),this.lineLayer.setOptions({color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin})}},{key:"onDataChanged",value:function(t){this.shapeLayer.setData(t),this.lineLayer.setData(t)}},{key:"getDefaultOptions",value:function(){return{lineColor:"rgba(250, 250, 25, 1)",lineWidth:4,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]),e}(sr),qr=n((function(t,e){t.exports=function(){function t(r,n,i,o,a){for(;o>i;){if(600<o-i){var s=o-i+1,u=n-i+1,l=Math.log(s),h=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*h*(s-h)/s)*(0>u-s/2?-1:1),t(r,n,Math.max(i,Math.floor(n-u*h/s+l)),Math.min(o,Math.floor(n+(s-u)*h/s+l)),a)}for(s=r[n],u=i,h=o,e(r,i,n),0<a(r[o],s)&&e(r,i,o);u<h;){for(e(r,u,h),u++,h--;0>a(r[u],s);)u++;for(;0<a(r[h],s);)h--}0===a(r[i],s)?e(r,i,h):e(r,++h,o),h<=n&&(i=h+1),n<=h&&(o=h-1)}}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}function n(t,e){i(t,0,t.children.length,e,t)}function i(t,e,r,n,i){for(i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;e<r;e++){var a=t.children[e];o(i,t.leaf?n(a):a)}return i}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(e,n,i,o,a){for(var s=[n,i];s.length;)if(!((i=s.pop())-(n=s.pop())<=o)){var u=n+Math.ceil((i-n)/o/2)*o;t(e,u,n||0,i||e.length-1,a||r),s.push(n,u,u,i)}}var d=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return d.prototype.all=function(){return this._all(this.data,[])},d.prototype.search=function(t){var e=this.data,r=[];if(!c(t,e))return r;for(var n=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?n(a):a;c(t,s)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):i.push(a))}e=i.pop()}return r},d.prototype.collides=function(t){var e=this.data;if(!c(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var i=e.children[n],o=e.leaf?this.toBBox(i):i;if(c(t,o)){if(e.leaf||h(t,o))return!0;r.push(i)}}e=r.pop()}return!1},d.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}return t=this._build(t.slice(),0,t.length-1,0),this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(e=this.data,this.data=t,t=e),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this},d.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},d.prototype.clear=function(){return this.data=f([]),this},d.prototype.remove=function(t,e){if(!t)return this;for(var r,n,i,o=this.data,a=this.toBBox(t),s=[],u=[];o||s.length;){if(o||(o=s.pop(),n=s[s.length-1],r=u.pop(),i=!0),o.leaf){t:{var l=t,c=o.children,f=e;if(f){for(var p=0;p<c.length;p++)if(f(l,c[p])){l=p;break t}l=-1}else l=c.indexOf(l)}if(-1!==l){o.children.splice(l,1),s.push(o),this._condense(s);break}}i||o.leaf||!h(o,a)?n?(r++,o=n.children[r],i=!1):o=null:(s.push(o),u.push(r),r=0,n=o,o=o.children[0])}return this},d.prototype.toBBox=function(t){return t},d.prototype.compareMinX=function(t,e){return t.minX-e.minX},d.prototype.compareMinY=function(t,e){return t.minY-e.minY},d.prototype.toJSON=function(){return this.data},d.prototype.fromJSON=function(t){return this.data=t,this},d.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},d.prototype._build=function(t,e,r,i){var o=r-e+1,a=this._maxEntries;if(o<=a){var s=f(t.slice(e,r+1));return n(s,this.toBBox),s}for(i||(i=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,i-1))),(s=f([])).leaf=!1,s.height=i,p(t,e,r,a=(o=Math.ceil(o/a))*Math.ceil(Math.sqrt(a)),this.compareMinX);e<=r;e+=a){var u=Math.min(e+a-1,r);p(t,e,u,o,this.compareMinY);for(var l=e;l<=u;l+=o)s.children.push(this._build(t,l,Math.min(l+o-1,u),i-1))}return n(s,this.toBBox),s},d.prototype._chooseSubtree=function(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],h=u(l),c=(Math.max(l.maxX,t.maxX)-Math.min(l.minX,t.minX))*(Math.max(l.maxY,t.maxY)-Math.min(l.minY,t.minY))-h;c<o?(o=c,i=h<i?h:i,a=l):c===o&&h<i&&(i=h,a=l)}e=a||e.children[0]}return e},d.prototype._insert=function(t,e,r){r=r?t:this.toBBox(t);var n=[],i=this._chooseSubtree(r,this.data,e,n);for(i.children.push(t),o(i,r);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},d.prototype._split=function(t,e){var r=t[e],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i),i=this._chooseSplitIndex(r,o,i),(i=f(r.children.splice(i,r.children.length-i))).height=r.height,i.leaf=r.leaf,n(r,this.toBBox),n(i,this.toBBox),e?t[e-1].children.push(i):this._splitRoot(r,i)},d.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},d.prototype._chooseSplitIndex=function(t,e,r){for(var n,o=1/0,a=1/0,s=e;s<=r-e;s++){var l=i(t,0,s,this.toBBox),h=i(t,s,r,this.toBBox),c=Math.max(0,Math.min(l.maxX,h.maxX)-Math.max(l.minX,h.minX))*Math.max(0,Math.min(l.maxY,h.maxY)-Math.max(l.minY,h.minY));l=u(l)+u(h),c<o?(o=c,n=s,a=l<a?l:a):c===o&&l<a&&(a=l,n=s)}return n||r-e},d.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:a,i=t.leaf?this.compareMinY:s;this._allDistMargin(t,e,r,n)<(e=this._allDistMargin(t,e,r,i))&&t.children.sort(n)},d.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var a=i(t,0,e,n=this.toBBox),s=i(t,r-e,r,n),u=l(a)+l(s),h=e;h<r-e;h++){var c=t.children[h];o(a,t.leaf?n(c):c),u+=l(a)}for(r=r-e-1;r>=e;r--)a=t.children[r],o(s,t.leaf?n(a):a),u+=l(s);return u},d.prototype._adjustParentBBoxes=function(t,e,r){for(;0<=r;r--)o(e[r],t)},d.prototype._condense=function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():n(t[r],this.toBBox)},d}()})),Zr=function(t){function e(t,r){return jt(this,e),(r=(t=qt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).canvas=document.createElement("canvas")).style.cssText="position: absolute; zIndex: 111; top: 10px; left: 10px; background: #000;",(r=t.ctx=r.getContext("2d")).textAlign="start",r.textBaseline="bottom",t}return Ht(e,t),Nt(e,[{key:"getDefaultOptions",value:function(){return{color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,lying:!1,collides:!0,padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t,this.texture=null,this.program=new Ae(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform float positionOffsetX;uniform float positionOffsetY;uniform float zoomUnits;uniform bool lying;uniform vec2 resolution;attribute vec3 position;attribute float pIndex;attribute vec2 wh;attribute vec2 uv;varying vec2 vUv;void main(){float x=position.x;float y=position.y;vUv=uv;if(lying){float hw=wh.x*0.5*zoomUnits;float hh=wh.y*0.5*zoomUnits;if(pIndex==1.0){x-=hw;y+=hh;}else if(pIndex==2.0){x+=hw;y+=hh;}else if(pIndex==3.0){x+=hw;y-=hh;}else{x-=hw;y-=hh;}gl_Position=matrix*vec4(x+positionOffsetX*zoomUnits,y+positionOffsetY*zoomUnits,position.z,1.0);}else{gl_Position=matrix*vec4(x+positionOffsetX*zoomUnits,y+positionOffsetY*zoomUnits,position.z,1.0);gl_Position/=gl_Position.w;float hw=wh.x/resolution.x;float hh=wh.y/resolution.y;if(pIndex==1.0){gl_Position.x-=hw;gl_Position.y+=hh;}else if(pIndex==2.0){gl_Position.x+=hw;gl_Position.y+=hh;}else if(pIndex==3.0){gl_Position.x+=hw;gl_Position.y-=hh;}else{gl_Position.x-=hw;gl_Position.y-=hh;}}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;varying vec2 vUv;void main(){gl_FragColor=texture2D(textureImage,vec2(vUv.x,1.0-vUv.y));}"},this),this.positionBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.pindexBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.whBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Se({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Se({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{name:"position",buffer:this.positionBuffer,stride:12,size:3,type:"FLOAT",offset:0},{name:"pIndex",buffer:this.pindexBuffer,size:1,stride:4,type:"FLOAT",offset:0},{name:"wh",buffer:this.whBuffer,size:2,stride:8,type:"FLOAT",offset:0},{name:"uv",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new Oe({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&this.parseData(e)}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,r=t.matrix,n=this.getOptions(),i=this.program;i.use(e),this.drawText(t),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);var o=this.map.getZoomUnits();i.setUniforms(Object.assign(this.getCommonUniforms(t),{matrix:r,textureImage:this.texture,lying:n.lying,resolution:[e.canvas.width,e.canvas.height],positionOffsetX:0,positionOffsetY:0,zoomUnits:o})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"loadTexture",value:function(){var t=this;this.canvas?O(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}},{key:"parseData",value:function(t){this.cachedData=[];for(var e=0;e<t.length;e++){var r=this.normizedPoint(t[e].geometry.coordinates),n=t[e].text||"";"properties"in t[e]&&"text"in t[e].properties&&(n=t[e].properties.text),r&&n&&this.cachedData.push({point:r,text:n})}}},{key:"drawText",value:function(t){var e=t.gl,r=t.matrix,n=(t=this.getOptions()).color,i=t.fontSize,o=t.fontFamily,a=t.padding,s=t.collides,u=e.canvas.width,l=e.canvas.height,h=this.canvas;(e=this.ctx).save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font=i+"px "+o;var c=new qr;t=[];for(var f=0;f<this.cachedData.length;f++){var p=this.cachedData[f],d=p.point;p=p.text;var v=Zt(d,3);v=ce.clone([v[0],v[1],v[2],1]),ce.transformMat4(v,v,r),ce.scale(v,v,1/v[3]);var g=(v[0]+1)/2*u,m=(1-v[1])/2*l,y=i,b=(v=e.measureText(p).width)+2*a[0],x=i+2*a[1];if(x=(m-=x/2)+x,!(0>(b=(g-=b/2)+b)||0>x||g>u||m>l)){if(s){if(x={minX:g,minY:m,maxX:b,maxY:x},c.collides(x))continue;c.insert(x)}t.push({w:v,h:y,point:d,text:p})}}for(e.restore(),a=function(t){var e=0,r=0,n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;e+=u.w*u.h,r=Math.max(r,u.w)}}catch(v){i=!0,o=v}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}t.sort((function(t,e){return e.h-t.h})),r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],i=n=0,o=!0,s=!1,a=void 0;try{for(var l,h=t[Symbol.iterator]();!(o=(l=h.next()).done);o=!0)for(var c=l.value,f=r.length-1;0<=f;f--){var p=r[f];if(!(c.w>p.w||c.h>p.h)){if(c.x=p.x,c.y=p.y,i=Math.max(i,c.y+c.h),n=Math.max(n,c.x+c.w),c.w===p.w&&c.h===p.h){var d=r.pop();f<r.length&&(r[f]=d)}else c.h===p.h?(p.x+=c.w,p.w-=c.w):(c.w!==p.w&&r.push({x:p.x+c.w,y:p.y,w:p.w-c.w,h:c.h}),p.y+=c.h,p.h-=c.h);break}}}catch(v){s=!0,a=v}finally{try{!o&&h.return&&h.return()}finally{if(s)throw a}}return{w:n,h:i,fill:e/(n*i)||0}}(t),r=a.w,a=a.h,h.width=r*window.devicePixelRatio,h.height=a*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.fillStyle=n,e.font=i+"px "+o,n=[],i=[],o=[],h=[],s=[],u=0,l=t.length;u<l;++u)c=t[u],e.fillText(c.text,c.x,c.y),f=(p=Zt(c.point,3))[0],d=p[1],p=p[2],n.push(f,d,p,f,d,p,f,d,p,f,d,p),o.push(0,1,2,3),s.push(c.w,c.h,c.w,c.h,c.w,c.h,c.w,c.h),f=4*u,h.push(f,f+2,f+1,f,f+3,f+2),f=c.x/r,d=(c.x+c.w)/r,p=(c.y+c.h)/a,c=c.y/a,i.push(f,p,f,c,d,c,d,p);e.restore(),this.loadTexture(),this.index=h,this.positionBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(i)),this.whBuffer.updateData(new Float32Array(s)),this.pindexBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(h))}}]),e}(qe);e.HeatmapLayer=tr,"OffscreenCanvas"in window&&(e.HeatmapLayer=rr);var Vr=function(){function t(e){jt(this,t),this.layers=[],this.options=e,this.webglLayer=e.webglLayer}return Nt(t,[{key:"addLayer",value:function(t){for(var e=!1,r=0;r<this.layers.length;r++)if(this.layers[r]===t){e=!0;break}e||(t.map=this.webglLayer.map,"threeLayer"===t.layerType?(t.setWebglLayer(this.webglLayer),e=t.getThreeLayer(),this.addLayer(e),t.initialize&&t.initialize(e)):(t.setWebglLayer(this.webglLayer),t.commonInitialize&&t.commonInitialize(this.webglLayer.gl),t.initialize&&t.initialize(this.webglLayer.gl),t.onOptionsChanged(t.getOptions()),t.onDataChanged(t.getData()),t.onChanged(t.getOptions(),t.getData())),this.layers.push(t)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&(t.destroy&&t.destroy(),this.layers.splice(e,1));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];e.destroy&&e.destroy(),this.layers.splice(t,1)}this.webglLayer.render()}},{key:"isRequestAnimation",value:function(){for(var t=!1,e=0;e<this.layers.length;e++)if(this.layers[e].isRequestAnimation()){t=!0;break}return t}},{key:"beforeRender",value:function(t){(t=t.gl)&&(this.preBlendState=t.isEnabled(t.BLEND),this.preDepthState=t.isEnabled(t.DEPTH_TEST),this.preCullFaceState=t.isEnabled(t.CULL_FACE),t.enable(t.BLEND))}},{key:"afterRender",value:function(t){(t=t.gl)&&(!1===this.preBlendState?t.disable(t.BLEND):t.enable(t.BLEND),!1===this.preDepthState?t.disable(t.DEPTH_TEST):t.enable(t.DEPTH_TEST),!1===this.preCullFaceState?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE))}},{key:"renderGLLayers",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];"threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType&&(this.beforeRender(t),t.gl.enable(t.gl.DEPTH_TEST),t.gl.disable(t.gl.BLEND),r.render(t),this.afterRender(t))}}},{key:"renderThreeLayer",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];"ThreeLayer"===r.layerType&&r.render(t)}}},{key:"renderThreeLayers",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];"threeLayer"===r.layerType&&(this.beforeRender(t),r.render(t),this.afterRender(t))}}},{key:"onClick",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if("threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType&&r.options.enablePicked&&r.options.onClick){var n=r.pick(t.x,t.y);r.options.onClick(n)}}}},{key:"onMousemove",value:function(t){for(var e=!1,r=0;r<this.layers.length;r++){var n=this.layers[r];"threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType&&n.options.enablePicked&&n.options.autoSelect&&(e=!0,n.pick(t.x,t.y))}e&&(this.webglLayer.isAnimation||this.webglLayer.render())}}]),t}(),Xr=function(){function t(e){var r=this;jt(this,t),this.options={autoUpdate:!0},Object.assign(this.options,e);var n=e.pointOffset;this.webglLayer=e.webglLayer||new He(e.map,this.options),this.layerManager=new Vr({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new ze(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender((function(t){r._render(t)})),this.webglLayer.onClick=function(t){r.layerManager.onClick(t)},this.webglLayer.onMousemove=function(t){r.layerManager.onMousemove(t)},n||"cesium"===this.webglLayer.options.mapType||(n=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[n.lng,n.lat]),this.webglLayer.map.onResize((function(){r.effectManager.initFbo()})),(this.postProcessing=e.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),e=this.postProcessing.getThreeLayer(),this.addLayer(e),this.postProcessing.initialize(e),e.postProcessing=this.postProcessing)}return Nt(t,[{key:"renderCanvas",value:function(t){var e=this;this.postProcessing?(this.postProcessing.addRender((function(){e.renderGLLayers(t)})),this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t)):(this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t),this.layerManager.renderGLLayers(t))}},{key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(t){var e=this,r=this.options.effects;r&&0<r.length?(this.webglRender.render=function(){e.renderCanvas(t)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(t),this.webglLayer.restoreFramebuffer())}},{key:"onRender",value:function(t){this.webglLayer.onRender(t)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.removeAllLayers(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"addLayer",value:function(t){this.layerManager.addLayer(t)}},{key:"removeLayer",value:function(t){this.layerManager.removeLayer(t)}}]),t}();window._hmt=window._hmt||[],function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),e.View=Xr,e.GridLayer=ar,e.HeatGridLayer=ur,e.ShapeLayer=or,e.SimpleLineLayer=lr,e.LineLayer=_r,e.WallSpriteLayer=Mr,e.LinePointLayer=Pr,e.WallLayer=Sr,e.WallTripLayer=Or,e.HeatLineLayer=Rr,e.WebglLayer=He,e.PointLayer=kr,e.RippleLayer=Br,e.SparkLayer=Dr,e.ClusterPointLayer=Fr,e.HeatPointLayer=zr,e.ShapeLineLayer=Ir,e.PointTripLayer=jr,e.LineTripLayer=Nr,e.TileLayer=Yr,e.IconLayer=Wr,e.PolygonLayer=Hr,e.Layer=qe,e.TextLayer=Zr,e.BlurEffect=ke,e.BloomEffect=Be,e.BrightEffect=De,e.DepthEffect=Fe,e.EffectManager=ze,e.getContext=S,e.createTexture=L,e.loadTextureImage=O,e.FrameBufferObject=Re,e.Program=Ae,e.Buffer=Se,e.VertexArray=Oe,e.CommonLayer=Pe,e.MercatorProjection=l,e.toRadian=p,e.Canvas=d,e.Supercluster=Te,e.Intensity=T,e.BezierCurve=P,e.__moduleExports=he,e.vec4=ce,e.vec3=fe,e.vec2=pe,e.quat2=de,e.quat=ve,e.mat4=ge,e.mat3=me,e.mat2d=ye,e.mat2=be,e.glMatrix=xe,Object.defineProperty(e,"__esModule",{value:!0})}(e)}).call(this,r(61))}}]);
//# sourceMappingURL=10.cffcd7fe.chunk.js.map